:root {
  --xk-font-scale: 1;
  --xk-font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  --xk-mono-font-scale: 1;
  --xk-mono-font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  /* Scale for helper/description texts inside cards (Layout tweaks). */
  --xk-card-desc-scale: 1;
  --sem-success: #22c55e;
  --sem-info: #93c5fd;
  --sem-warning: #fbbf24;
  --sem-error: #f87171;
  --sem-debug: #a1a1aa;

  /* Xray logs highlight (token colors) — dark defaults */
  --log-ts: #94a3b8;
  --log-ip: #fde68a;
  --log-domain: #6ee7b7;
  --log-route-tproxy-vless: #22c55e;
  --log-route-redirect-vless: #38bdf8;
  --log-route-redirect-direct: #a855f7;
  --log-route-reject: #f97373;

  /* Theme-aware modal / floating surfaces (used by tooltips, menus, etc.) */
  --modal-bg: rgba(15, 23, 42, 0.95);
  --modal-text: #e5e7eb;
  --modal-border: rgba(51, 65, 85, 0.85);
  --shadow-rgb: 0, 0, 0;
  --shadow: 0.35;

  /* Unified button variables (so semantic .btn-secondary stays readable in light theme too) */
  --editor-btn-bg: rgba(255,255,255,0.04);
  --editor-btn-border: rgba(51,65,85,0.9);
  --editor-btn-text: #e5e7eb;
  --editor-btn-hover-bg: rgba(255,255,255,0.08);
  --editor-btn-hover-border: rgba(71,85,105,0.85);

  /* Tooltip surface (portal renderer) */
  --xk-tooltip-bg: rgba(15, 23, 42, 0.95);
  --xk-tooltip-text: #e5e7eb;
  --xk-tooltip-border: rgba(148, 163, 184, 0.25);
  --xk-tooltip-shadow: rgba(0, 0, 0, 0.55);

  /* Tooltip blur ("macOS style") for light theme. Disabled by default. */
  --xk-tooltip-backdrop: none;

}

/* Semantic colors: light theme defaults */
html[data-theme="light"] {
  --sem-success: #16a34a;
  --sem-info: #2563eb;
  --sem-warning: #b45309;
  --sem-error: #dc2626;
  --sem-debug: #6b7280;

  /* Xray logs highlight (token colors) — light defaults */
  --log-ts: #64748b;
  --log-ip: #a16207;
  --log-domain: #047857;
  --log-route-tproxy-vless: #16a34a;
  --log-route-redirect-vless: #0284c7;
  --log-route-redirect-direct: #7c3aed;
  --log-route-reject: #dc2626;

  /* Theme-aware modal / floating surfaces */
  --modal-bg: #ffffff;
  --modal-text: #111827;
  --modal-border: rgba(15, 23, 42, 0.15);
  --shadow-rgb: 15, 23, 42;
  --shadow: 0.14;

  /* Unified button variables */
  --editor-btn-bg: #ffffff;
  --editor-btn-border: rgba(15, 23, 42, 0.18);
  --editor-btn-text: #111827;
  --editor-btn-hover-bg: rgba(15, 23, 42, 0.06);
  --editor-btn-hover-border: rgba(15, 23, 42, 0.22);

  /* File manager buttons: keep contrast in light theme */
  --fm-btn-text: #111827;
  --fm-btn-hover-text: #111827;

  /* File manager toggle ("Скрытые") */
  --fm-toggle-knob-bg: rgba(255, 255, 255, 0.96);
  --fm-toggle-knob-border: rgba(15, 23, 42, 0.10);

  /* Tooltip surface (portal renderer) */
  /* "macOS style" (milky + blur) */
  --xk-tooltip-bg: rgba(255, 255, 255, 0.72);
  --xk-tooltip-text: #111827;
  --xk-tooltip-border: rgba(15, 23, 42, 0.10);
  --xk-tooltip-shadow: rgba(15, 23, 42, 0.14);
  --xk-tooltip-backdrop: blur(18px) saturate(180%);
}


body {
  margin: 0;
  font-family: var(--xk-font-family);
  font-size: calc(16px * var(--xk-font-scale));
  background: #0f172a;
  color: #e5e7eb;
}


body.modal-open {
  overflow: hidden;
}

/* Typography prefs (set in DevTools; stored in browser localStorage) */
button, input, select, textarea {
  font-family: var(--xk-font-family);
}

code, pre, kbd, samp {
  font-family: var(--xk-mono-font-family);
}

/* Editors / terminals (override vendor CSS to allow scaling) */
.CodeMirror {
  font-family: var(--xk-mono-font-family);
  font-size: calc(14px * var(--xk-mono-font-scale));
}

.xterm {
  font-family: var(--xk-mono-font-family);
  font-size: calc(14px * var(--xk-mono-font-scale));
}

/* Generic utility class (used across UI): hide any element. */
.hidden { display: none !important; }


a {
  color: #60a5fa;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px;
}

/* DevTools (and other wide pages): use most of the screen width */
.container-wide {
  max-width: var(--xk-container-max-width, min(1600px, 96vw));
}

/* --------------------------------------------------------------
   Layout preferences (stored in localStorage via js/ui/layout.js)
   -------------------------------------------------------------- */

/* Compact mode: tighter spacing */
html[data-xk-compact="1"] .container { padding: 16px; }
html[data-xk-compact="1"] header { margin-bottom: 16px; }
html[data-xk-compact="1"] .card {
  padding: 12px 12px 14px;
  margin-bottom: 12px;
}
html[data-xk-compact="1"] .card h2 { margin-bottom: 6px; }
html[data-xk-compact="1"] .card p { margin-bottom: 8px; }
html[data-xk-compact="1"] .actions { gap: 8px; }

/* Hide hints/descriptions (keep statuses/errors visible) */
html[data-xk-hide-hints="1"] header p { display: none !important; }
html[data-xk-hide-hints="1"] .small { display: none !important; }
html[data-xk-hide-hints="1"] #routing-help-line { display: none !important; }

/* File Manager: hide the bottom hotkeys hints line */
html[data-xk-hide-fm-hotkeys="1"] .fm-hints { display: none !important; }

/* Hide helper/description texts inside cards (Layout tweaks) */
html[data-xk-hide-card-desc="1"] .card .xk-card-desc { display: none !important; }
html[data-xk-hide-card-desc="1"] .card .mode-item small { display: none !important; }
/* Also hide common description blocks that are not explicitly marked. */
html[data-xk-hide-card-desc="1"] .card p { display: none !important; }
html[data-xk-hide-card-desc="1"] .card .hint { display: none !important; }

/* Favorites marker for pinned tabs */
.top-tab-btn.xk-tab-fav::after {
  content: "★";
  margin-left: 6px;
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.85;
}

/* Drag&drop UX for top tabs */
.top-tab-btn.xk-tab-dragging { opacity: 0.6; }
.top-tab-btn.xk-tab-drop-target,
.top-tab-btn.xk-tab-drop { outline: 2px dashed color-mix(in srgb, var(--accent, #60a5fa) 55%, transparent); outline-offset: 2px; }


header {
  margin-bottom: 24px;
}

header h1 {
  margin: 0 0 4px;
  font-size: calc(28px * var(--xk-font-scale));
}


header p {
  margin: 0;
  color: #9ca3af;
}

.header-main {
  /* 3 зоны: слева заголовок, по центру выбор ядра, справа действия */
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  column-gap: 12px;
  row-gap: 10px;
}

.header-title-group { justify-self: start; }
.header-center { justify-self: center; }
.header-right { justify-self: end; }

/* Allow grid items in the header to shrink without overflowing the container */
.header-title-group,
.header-center,
.header-right {
  min-width: 0;
}

@media (max-width: 900px) {
  .header-main {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  .header-center {
    order: 3;
    width: 100%;
    display: flex;
    justify-content: center;
  }
}

/* Правая группа в шапке: версия/ядро + действия (выйти + тема) */
.header-right {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  max-width: 100%;
}

/* Держим «Выйти» и переключатель темы рядом (как единый блок) */
.header-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.theme-toggle-header {
  /* в шапке кнопка не плавающая */
  position: static;
  top: auto;
  right: auto;
}

.header-title-group {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

/* Optional branding logo in header (configured in DevTools) */
.xk-brand-logo {
  width: 28px;
  height: 28px;
  max-width: 28px;
  max-height: 28px;
  object-fit: contain;
  border-radius: 8px;
  background: rgba(148, 163, 184, 0.12);
  padding: 2px;
  flex: 0 0 auto;
}


.service-status-text {
  display: none; /* текст статуса убран, остаётся только всплывающая подсказка на лампочке */
}

.service-status-lamp {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 9999px;
  background: #6b7280;
  box-shadow: none;
  cursor: help;
  transition:
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.15s ease;
}


/* Сервис запущен */
.service-status-lamp[data-state="running"] {
  background: var(--sem-success, #22c55e);
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.7);
  animation: service-status-pulse 1s infinite;
}

/* Остановлен */
.service-status-lamp[data-state="stopped"] {
  background: #ef4444;
  box-shadow: 0 0 4px rgba(248, 113, 113, 0.7);
}

/* Проверка / ожидание */
.service-status-lamp[data-state="pending"] {
  background: #f59e0b;
  box-shadow: 0 0 6px rgba(245, 158, 11, 0.7);
  animation: service-status-pulse 1s infinite;
}

/* Ошибка / неизвестно */
.service-status-lamp[data-state="error"] {
  background: var(--sem-warning, #f97316);
  box-shadow: 0 0 6px rgba(249, 115, 22, 0.7);
  box-shadow: 0 0 6px color-mix(in srgb, var(--sem-warning, #f97316) 70%, transparent);
}

@keyframes service-status-pulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.25);
    opacity: 0.7;
  }
}



.service-core-text {
  font-size: calc(12px * var(--xk-font-scale));
  padding: 4px 12px;
  border-radius: 999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  white-space: nowrap;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.service-core-text.has-core {
  border-color: var(--accent, #2563eb);
  background: color-mix(in srgb, var(--accent, #2563eb) 12%, var(--header-btn-bg, #020617) 88%);
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent, #2563eb) 35%, transparent);
}

.last-load-badge {
  margin-left: 16px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid var(--border, #1f2937);
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  white-space: nowrap;
  align-self: center;
  background: color-mix(in srgb, var(--bg, #0f172a) 70%, var(--card-bg, #020617) 30%);
}

/* Когда бейдж стоит рядом с кнопками управления — используем gap вместо margin */
.xkeen-ctrl-row .last-load-badge {
  margin-left: 0;
}

.last-load-badge.last-load-loaded {
  border-color: color-mix(in srgb, var(--sem-success, #22c55e) 55%, transparent);
  color: color-mix(in srgb, var(--sem-success, #22c55e) 55%, var(--text, #e5e7eb) 45%);
}

.last-load-badge.last-load-saved {
  border-color: color-mix(in srgb, var(--sem-info, #93c5fd) 55%, transparent);
  color: color-mix(in srgb, var(--sem-info, #93c5fd) 55%, var(--text, #e5e7eb) 45%);
}

.last-load-badge.last-load-error {
  border-color: color-mix(in srgb, var(--sem-error, #f87171) 55%, transparent);
  color: color-mix(in srgb, var(--sem-error, #f87171) 55%, var(--text, #e5e7eb) 45%);
}


.service-core-text.has-core:hover {
  text-decoration: underline;
}

.core-select-row {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.core-option {
  padding: 4px 12px;
  font-size: calc(12px * var(--xk-font-scale));
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

.core-option:hover {
  background: linear-gradient(135deg, var(--editor-btn-active-from, #1d4ed8), var(--editor-btn-active-to, #2563eb));
  border-color: var(--editor-btn-active-to, #2563eb);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--editor-btn-active-to, #2563eb) 45%, transparent);
  transform: translateY(-1px);
}

.core-option.active {
  background: linear-gradient(135deg, color-mix(in srgb, var(--sem-success, #22c55e) 70%, var(--card-bg, #020617) 30%), var(--sem-success, #22c55e));
  border-color: var(--sem-success, #22c55e);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--sem-success, #22c55e) 45%, transparent);
}

.core-option[disabled] {
  opacity: 0.6;
  cursor: default;
  box-shadow: none;
  background: var(--header-btn-bg, #020617);
}




.card {
  background: #020617;
  border-radius: 12px;
  padding: 16px 16px 20px;
  margin-bottom: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  border: 1px solid #1f2937;
}

.card h2 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: calc(20px * var(--xk-font-scale));
}

.card p {
  margin-top: 0;
  margin-bottom: 12px;
  color: #9ca3af;
  /* Card descriptions should respect the "Размер описаний" layout tweak. */
  font-size: calc(1em * var(--xk-card-desc-scale, 1));
  line-height: 1.4;
}

textarea#routing-editor {
  width: 100%;
  min-height: 260px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  /* +1 for readability */
  font-size: calc(16px * var(--xk-font-scale));
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  resize: vertical;
  box-sizing: border-box;
}


.xkeen-textarea {
  width: 100%;
  min-height: 200px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  /* +1 for readability */
  font-size: calc(16px * var(--xk-font-scale));
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  resize: vertical;
  box-sizing: border-box;
}

.CodeMirror {
  border-radius: 8px;
  border: 1px solid #111827;
  background: #020617;
  /* Let CodeMirror grow with content; avoid conflicting manual resize */
  height: auto;
  min-height: 300px;
  font-family: "JetBrains Mono", "Fira Code", Menlo, Monaco, Consolas,
    "Liberation Mono", "Courier New", monospace;
box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);

  /* +1 for readability */
  font-size: calc(16px * var(--xk-font-scale));
  line-height: 1.45;
}

/* Make editor lines a bit taller for readability */
.CodeMirror pre {
  line-height: 1.45;
}

/* Make scrolling predictable and avoid white gaps */
.CodeMirror-scroll {
  max-height: 76vh;
  background-color: #020617;

  /* Keep scrolling predictable */
  overflow: auto !important;
}

/* Routing Xray: make the main editor noticeably larger on wide screens */
#routing-body .CodeMirror {
  min-height: clamp(360px, 60vh, 900px);
}

#routing-body .CodeMirror-scroll {
  max-height: 78vh;
}

/*
  IMPORTANT (auto-height CodeMirror)
  ---------------------------------
  Our UI uses `height: auto` on the `.CodeMirror` wrapper + `max-height` on
  `.CodeMirror-scroll`.

  CodeMirror 5 default CSS uses `margin-bottom: -50px` on `.CodeMirror-scroll`
  as part of its scrollbar layout hack. When the wrapper height is auto, that
  negative margin makes the wrapper shorter and the last visible line gets
  clipped in some editors.

  Fix: neutralize the negative bottom margin for our editors and keep a small
  bottom padding so the last line is always fully visible.
*/
.xkeen-cm .CodeMirror-scroll {
  margin-bottom: 0 !important;
  padding-bottom: 12px !important;
}

.xkeen-cm .CodeMirror-gutter {
  margin-bottom: 0 !important;
}


/*
  Fullscreen (CodeMirror addon/display/fullscreen)
  ------------------------------------------------
  We intentionally cap editor height in normal mode via `max-height: 70vh`.
  But in fullscreen CodeMirror only adds `.CodeMirror-fullscreen` on the
  wrapper; without overrides the scroll area stays capped, so fullscreen looks
  "crooked" (big empty space below/aside).
*/
.CodeMirror.CodeMirror-fullscreen {
  /* Make sure the editor overlays the whole UI (sidebar/header, etc.) */
  z-index: 10000;
  border-radius: 0;
}

.CodeMirror.CodeMirror-fullscreen .CodeMirror-scroll {
  max-height: none !important;
  height: 100% !important;
}

.cm-error-line {
  background: rgba(220, 38, 38, 0.15);
}

.actions {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.actions button {
  flex: 1 1 210px;
  text-align: center;
  white-space: normal;
}

/*
  В шапке некоторых страниц используется контейнер .actions (для кнопки "Назад" + действий справа).
  Общие правила .actions button растягивают кнопки до flex-basis 210px, из-за чего переключатель темы
  становится огромным и переносит DevTools/Выйти на следующую строку.
  Для блока .header-actions (правый угол) отключаем это поведение.
*/
.actions .header-actions button {
  flex: 0 0 auto;
  white-space: nowrap;
}


button {
  border-radius: 9999px;
  padding: 6px 14px;
  font-size: calc(14px * var(--xk-font-scale));
  cursor: pointer;
  background: var(--editor-btn-bg, #020617);
  border: 1px solid var(--editor-btn-border, #1f2937);
  color: var(--editor-btn-text, #e5e7eb);
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

button:hover {
  background: var(--editor-btn-hover-bg, var(--editor-btn-bg, #020617));
  border-color: var(
    --editor-btn-hover-border,
    var(--editor-btn-border-hover, var(--editor-btn-border, #1f2937))
  );
  color: var(--editor-btn-hover-text, var(--editor-btn-text, #e5e7eb));
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
  transform: translateY(-1px);
}

button:active {
  background: linear-gradient(
    135deg,
    var(--editor-btn-active-from, #1d4ed8),
    var(--editor-btn-active-to, #2563eb)
  );
  border-color: var(--editor-btn-active-to, #2563eb);
  transform: translateY(1px) scale(0.99);
  /* fallback */
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
  /* prefer theme-aware shadow when supported */
  box-shadow: 0 6px 16px color-mix(in srgb, var(--editor-btn-active-to, #2563eb) 45%, transparent);
}

button:disabled {
  opacity: 0.5;
  cursor: default;
  box-shadow: none;
}

/*
  Tooltips (описания на кнопках)
  --------------------------------
  Используется атрибут: data-tooltip="..."
*/

/*
  IMPORTANT:
  Для мест с overflow:hidden/scroll (модалки, тулбары, шапки) псевдо-элементы
  ::before/::after могут обрезаться по границам контейнера.
  Поэтому по умолчанию включён "портальный" тултип (JS рендерит его в <body>
  с position:fixed). Если он активен – отключаем CSS-псевдо-рендеринг,
  чтобы не было дубля.
*/
.xk-tooltip-portal [data-tooltip]::after,
.xk-tooltip-portal [data-tooltip]::before {
  display: none !important;
}

/* Portal tooltip (fixed-position, not clipped by containers) */
#xk-tooltip-portal {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 2147483646;
  pointer-events: none;
  transform: translate3d(-9999px, -9999px, 0);
  opacity: 0;
  transition: opacity 0.08s ease;
}

#xk-tooltip-portal[hidden] {
  display: none;
}

#xk-tooltip-portal .xk-tooltip-bubble {
  position: relative;
  padding: 8px 10px;
  border-radius: 12px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.25;
  text-align: center;
  width: max-content;
  max-width: 320px;
  white-space: normal;

  background: var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));
  -webkit-backdrop-filter: var(--xk-tooltip-backdrop, none);
  backdrop-filter: var(--xk-tooltip-backdrop, none);
  border: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.25));
  color: var(--xk-tooltip-text, #e5e7eb);
  box-shadow: 0 10px 30px var(--xk-tooltip-shadow, rgba(0, 0, 0, 0.55));
}

#xk-tooltip-portal .xk-tooltip-arrow {
  position: absolute;
  width: 12px;
  height: 12px;
  background: inherit;
  -webkit-backdrop-filter: var(--xk-tooltip-backdrop, none);
  backdrop-filter: var(--xk-tooltip-backdrop, none);
  border-left: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.25));
  border-top: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.25));
  transform: rotate(45deg);
}

#xk-tooltip-portal[data-pos="top"] .xk-tooltip-arrow {
  bottom: -6px;
}

#xk-tooltip-portal[data-pos="bottom"] .xk-tooltip-arrow {
  top: -6px;
  transform: rotate(225deg);
}
button[data-tooltip] {
  position: relative;
}

button[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  bottom: calc(100% + 12px);
  transform: translateX(-50%);

  opacity: 0;
  pointer-events: none;

  padding: 8px 10px;
  border-radius: 12px;
  background: var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));
  -webkit-backdrop-filter: var(--xk-tooltip-backdrop, none);
  backdrop-filter: var(--xk-tooltip-backdrop, none);
  border: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.25));
  color: var(--xk-tooltip-text, #e5e7eb);

  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.25;
  text-align: center;

  width: max-content;
  max-width: 320px;
  white-space: normal;

  box-shadow: 0 10px 30px var(--xk-tooltip-shadow, rgba(0, 0, 0, 0.55));
  z-index: 9999;
}

button[data-tooltip]::before {
  content: "";
  position: absolute;
  left: 50%;
  bottom: calc(100% + 6px);
  transform: translateX(-50%);

  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));

  opacity: 0;
  pointer-events: none;
  z-index: 10000;
}

button[data-tooltip]:hover::after,
button[data-tooltip]:hover::before,
button[data-tooltip]:focus-visible::after,
button[data-tooltip]:focus-visible::before {
  opacity: 1;
}

@media (hover: none) {
  button[data-tooltip]::after,
  button[data-tooltip]::before {
    display: none;
  }
}

/* Themed tooltip for any non-button element with data-tooltip */
[data-tooltip]:not(button):not(input):not(textarea):not(select) {
  position: relative;
}

[data-tooltip]:not(button):not(input):not(textarea):not(select)::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  bottom: calc(100% + 12px);
  transform: translateX(-50%);

  opacity: 0;
  pointer-events: none;

  padding: 8px 10px;
  border-radius: 12px;
  background: var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));
  -webkit-backdrop-filter: var(--xk-tooltip-backdrop, none);
  backdrop-filter: var(--xk-tooltip-backdrop, none);
  border: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.25));
  color: var(--xk-tooltip-text, #e5e7eb);

  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.25;
  text-align: center;

  width: max-content;
  max-width: 320px;
  white-space: normal;

  box-shadow: 0 10px 30px var(--xk-tooltip-shadow, rgba(0, 0, 0, 0.55));
  z-index: 9999;
}

[data-tooltip]:not(button):not(input):not(textarea):not(select)::before {
  content: "";
  position: absolute;
  left: 50%;
  bottom: calc(100% + 6px);
  transform: translateX(-50%);

  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));

  opacity: 0;
  pointer-events: none;
  z-index: 10000;
}

[data-tooltip]:not(button):not(input):not(textarea):not(select):hover::after,
[data-tooltip]:not(button):not(input):not(textarea):not(select):hover::before,
[data-tooltip]:not(button):not(input):not(textarea):not(select):focus-visible::after,
[data-tooltip]:not(button):not(input):not(textarea):not(select):focus-visible::before {
  opacity: 1;
}

@media (hover: none) {
  [data-tooltip]:not(button):not(input):not(textarea):not(select)::after,
  [data-tooltip]:not(button):not(input):not(textarea):not(select)::before {
    display: none;
  }
}

.status {
  margin-top: 8px;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
}


.error {
  margin-top: 6px;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--sem-error, #fca5a5);
}


.inbounds-modes {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mode-item {
  display: flex;
  gap: 8px;
  padding: 8px;
  border-radius: 8px;
  background: var(--card-bg, #020617);
  border: 1px solid var(--border, #1f2937);
}

.mode-item input {
  margin-top: 4px;
}

.mode-item strong {
  color: var(--text, #e5e7eb);
}

.mode-item small {
  color: var(--muted, #9ca3af);
  font-size: calc(12px * var(--xk-font-scale) * var(--xk-card-desc-scale, 1));
  line-height: 1.35;
}

/* Generic card description helper text (used on some <p>/<small> elements in templates)
   NOTE: include a more specific selector to override generic ".card p" sizing. */
.xk-card-desc,
.card .xk-card-desc {
  color: var(--muted, #9ca3af);
  font-size: calc(13px * var(--xk-font-scale) * var(--xk-card-desc-scale, 1));
  line-height: 1.4;
}

.toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: calc(14px * var(--xk-font-scale));
  margin-top: 10px;
  color: var(--muted, #9ca3af);
}

.toggle input {
  width: 16px;
  height: 16px;
}

#outbounds-url {
  width: 100%;
  box-sizing: border-box;
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  padding: 8px 12px;
  font-size: calc(14px * var(--xk-font-scale));
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

#outbounds-url:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 1px #3b82f6;
}

/* Outbounds: parsed preview + validation */
.outbounds-parse-box {
  margin-top: 10px;
  border: 1px solid var(--border, #374151);
  border-radius: 16px;
  padding: 10px 12px;
  background: rgba(2, 6, 23, 0.55);
}

#outbounds-url.xk-invalid {
  border-color: #ef4444;
  box-shadow: 0 0 0 1px #ef4444;
}

.outbounds-parse-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

.outbounds-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 2px 8px;
  border-radius: 9999px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.4;
  border: 1px solid var(--border, #374151);
  color: var(--text, #e5e7eb);
  background: rgba(2, 6, 23, 0.35);
}

.outbounds-badge-ok {
  border-color: rgba(34, 197, 94, 0.65);
  background: rgba(34, 197, 94, 0.12);
}

.outbounds-badge-bad {
  border-color: rgba(239, 68, 68, 0.75);
  background: rgba(239, 68, 68, 0.10);
}

.outbounds-parse-msg {
  margin-top: 8px;
  font-size: calc(12px * var(--xk-font-scale) * var(--xk-card-desc-scale, 1));
  line-height: 1.35;
}

.outbounds-parse-error {
  color: #fecaca;
}

.outbounds-parse-warn {
  color: #fde68a;
}

.outbounds-parse-kv {
  margin-top: 10px;
  display: grid;
  grid-template-columns: 1fr;
  gap: 6px;
}

.outbounds-kv-row {
  display: grid;
  grid-template-columns: minmax(120px, 1fr) 2fr;
  gap: 10px;
  padding: 6px 8px;
  border-radius: 12px;
  background: rgba(2, 6, 23, 0.35);
  border: 1px solid rgba(55, 65, 81, 0.5);
}

.outbounds-kv-row .k {
  color: var(--muted, #9ca3af);
  font-size: calc(12px * var(--xk-font-scale));
}

.outbounds-kv-row .v {
  color: var(--text, #e5e7eb);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: calc(12px * var(--xk-font-scale));
  overflow-wrap: anywhere;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: calc(14px * var(--xk-font-scale));
}

thead {
  background: #020617;
}

th, td {
  padding: 6px 8px;
  border-bottom: 1px solid #1f2937;
  text-align: left;
}

th {
  font-weight: 600;
  color: #9ca3af;
}

tbody tr:hover {
  background: #020617;
}
#backups-table .backups-empty-row:hover {
  background: transparent;
}


.hint {
  margin-top: 8px;
  font-size: calc(12px * var(--xk-font-scale) * var(--xk-card-desc-scale, 1));
  color: #9ca3af;
}

footer {
  margin-top: 16px;
  text-align: right;
  color: #6b7280;
  font-size: calc(11px * var(--xk-font-scale));
}

.btn-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 9999px;
  padding: 4px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  text-decoration: none;
  cursor: pointer;

  /* Header pill style (editable via DevTools → Theme & CSS variables → "Кнопки шапка") */
  border: 1px solid var(--header-btn-border, rgba(148, 163, 184, 0.35));
  background: var(--header-btn-bg, rgba(2, 6, 23, 0.6));
  color: var(--header-btn-text, #e5e7eb);
}

.btn-link:hover {
  text-decoration: none;
  background: var(--header-btn-hover-bg, rgba(17, 24, 39, 0.85));
  border-color: var(--header-btn-hover-border, var(--header-btn-border, rgba(148, 163, 184, 0.35)));
  color: var(--header-btn-hover-text, var(--header-btn-text, #e5e7eb));
}

.btn-link:active {
  transform: translateY(1px);
}

.btn-link:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent, #60a5fa) 55%, transparent);
  outline-offset: 2px;
}

/* Light theme defaults for header-style pills */
html[data-theme="light"] .btn-link {
  background: var(--header-btn-bg, rgba(248, 250, 252, 0.9));
  color: var(--fm-btn-text, var(--header-btn-text, #111827));
  border-color: var(--header-btn-border, rgba(15, 23, 42, 0.16));
}

html[data-theme="light"] .btn-link:hover {
  background: var(--header-btn-hover-bg, rgba(226, 232, 240, 0.9));
  border-color: var(--header-btn-hover-border, var(--header-btn-border, rgba(15, 23, 42, 0.16)));
  color: var(--header-btn-hover-text, var(--header-btn-text, #111827));
}

.links {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.links li {
  margin-bottom: 4px;
}

.log-block {
  background: #020617;
  box-sizing: border-box;
  display: block;
  border-radius: 8px;
  border: 1px solid #1f2937;
  padding: 8px;
  font-size: calc(12px * var(--xk-font-scale));
  max-height: 260px;
  overflow: auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: pre-wrap;
}
.log-tag-info {
  color: var(--sem-info, #60a5fa);
  font-weight: 500;
}

.log-tag-warn {
  color: var(--sem-warning, #facc15);
  font-weight: 500;
}

.log-tag-error {
  color: var(--sem-error, #f97373);
  font-weight: 600;
}



/* Two-column main layout */
.layout-2col {
  display: grid;
  grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
  gap: 16px;
  align-items: flex-start;
}

/* Routing view: prioritize the main CodeMirror editor width */
.layout-2col.routing-layout {
  grid-template-columns: minmax(0, 3fr) minmax(0, 1.2fr);
}

/* DevTools: Tools tab uses a compact left column and a wide ENV editor on the right */
.dt-tools-layout {
  grid-template-columns: minmax(260px, 420px) minmax(0, 1fr);
}

.dt-tools-left {
  min-width: 0;
}

.dt-tools-right {
  min-width: 0;
}

.layout-main {
  min-width: 0;
}

.layout-side {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.layout-side .card {
  margin-top: 0;
}

@media (max-width: 1024px) {
  .layout-2col {
    grid-template-columns: minmax(0, 1fr);
  }

  .layout-2col.routing-layout {
    grid-template-columns: minmax(0, 1fr);
  }

  /* On smaller screens: keep DevTools readable */
  .dt-tools-layout {
    grid-template-columns: minmax(0, 1fr);
  }
}

/* Log controls */
.log-card {
  margin-top: 16px;
}

/* Live логи Xray: fullscreen (card-level) */
.log-card.is-fullscreen{
  position: fixed !important;
  /* Use inset instead of 100vw/100vh to avoid scrollbar-related clipping */
  inset: 8px !important;
  width: auto !important;
  height: auto !important;
  margin: 0 !important;
  max-width: none !important;
  max-height: none !important;
  z-index: 45;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.log-card.is-fullscreen .xray-log-block{
  /* Important: don't let the log <pre> size itself by content in flex layout */
  flex: 1 1 0 !important;
  min-height: 0 !important;
  height: 0 !important;
  resize: none !important;
}

.log-card.is-fullscreen #xray-log-status{
  flex: 0 0 auto;
}

.log-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 8px;
}

.log-header-row h2 {
  margin: 0;
}

.log-header-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  overflow-x: auto;
  scrollbar-width: none; /* Firefox */
}

/* Hide horizontal scrollbar but keep scrollability */
.log-header-actions::-webkit-scrollbar {
  display: none;
}

.log-btn {
  font-size: calc(11px * var(--xk-font-scale));
  padding-inline: 10px;
}

/* XKeen commands block */
.commands-card {
  margin-top: 16px;
}

/* Commands: groups grid + clearer group outline.
   Some custom themes make borders too low-contrast, so we enforce a visible outline here.
*/
/*
  Commands layout: masonry-like columns to avoid large empty gaps that appear
  with a regular grid when blocks have different heights.

  NOTE: CSS Grid doesn't provide a widely-supported masonry mode, so we use
  multi-column layout here.
*/
#view-commands #commands-body{
  column-count: 3;
  column-gap: 12px;
}

#view-commands #commands-body .command-group{
  /*
    Multi-column "masonry".
    IMPORTANT: on some browsers, percentage widths inside multi-columns can be
    resolved against the full container width (not the column width), which
    causes items to overlap across columns. Поэтому здесь НЕ задаём width:100%
    и оставляем элементы блочными.
  */
  display: block;
  width: auto;
  margin: 0 0 12px;
  break-inside: avoid-column;
  -webkit-column-break-inside: avoid;
  page-break-inside: avoid;
  box-sizing: border-box;

  padding: 10px 10px 12px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
  border: 1px solid rgba(148, 163, 184, 0.18);
  box-shadow: 0 0 0 1px rgba(0,0,0,0.35) inset;
}

/* Disable the old "stacked list" separators for the commands view (grid layout). */
#view-commands #commands-body .command-group + .command-group{
  margin-top: 0;
  padding-top: 0;
  border-top: none;
}

@media (max-width: 900px) {
  #view-commands #commands-body{ column-count: 2; }
}

@media (max-width: 640px) {
  #view-commands #commands-body{ column-count: 1; }
}

html[data-theme="light"] #view-commands #commands-body .command-group{
  background: linear-gradient(180deg, rgba(15,23,42,0.03), rgba(15,23,42,0.015));
  border-color: rgba(15, 23, 42, 0.14);
  box-shadow: 0 0 0 1px rgba(255,255,255,0.65) inset;
}

.commands-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.commands-header h2 {
  margin: 0;
  font-size: calc(14px * var(--xk-font-scale));
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #c7d2fe;
}

#commands-arrow {
  font-size: calc(14px * var(--xk-font-scale));
  opacity: 0.8;
}

.command-group + .command-group {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #1f2937;
}

.command-group-title {
  font-size: calc(12px * var(--xk-font-scale));
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #9ca3af;
  margin-bottom: 4px;
}


.command-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  grid-auto-rows: auto;
  column-gap: 6px;
  row-gap: 6px;
}

/* Wrapper <li> used when command item is rendered as a real <button> */
.command-item-wrap {
  margin: 0;
  padding: 0;
}


@media (max-width: 900px) {
  .command-list {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 640px) {
  .command-list {
    grid-template-columns: 1fr;
  }
}


.command-item {
  position: relative;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 10px;
  background: var(--card-bg, #020617);
  border: 1px solid var(--border, #1f2937);
  font-size: calc(12px * var(--xk-font-scale));
  cursor: pointer;
  transition: border-color 0.12s ease, background 0.12s ease, transform 0.1s ease;
  width: 100%;
  white-space: nowrap;
  user-select: none;
}

/* Make the label compact and consistent inside pill-buttons. */
.command-item code {
  background: transparent;
  border: none;
  padding: 0;
  color: inherit;
  font-size: inherit;
}
.command-item.loading {
  opacity: 0.7;
  cursor: wait;
}

.command-item.loading::after {
  content: '';
  position: absolute;
  right: 8px;
  top: 50%;
  width: 12px;
  height: 12px;
  margin-top: -6px;
  border-radius: 999px;
  border: 2px solid rgba(148, 163, 184, 0.5);
  border-top-color: #e5e7eb;
  animation: xkeen-spinner 0.8s linear infinite;
}


.command-item:hover {
  border-color: #60a5fa;
  background: #0b1220;
  transform: translateY(-1px);
}

.command-item-top {
  display: flex;
  align-items: center;
  gap: 8px;
}

.command-item-icon {
  font-size: calc(10px * var(--xk-font-scale));
  opacity: 0.85;
}

.command-item-code code {
  background: transparent;
  border-radius: 999px;
  border: 1px solid rgba(30, 64, 175, 0.9);
  padding: 2px 8px;
  font-size: calc(12px * var(--xk-font-scale));
}

.command-item-desc {
  color: #9ca3af;
  font-size: calc(11px * var(--xk-font-scale));
  line-height: 1.4;
}

.layout-single {
  max-width: 960px;
  margin: 0 auto;
}

/* XKeen editors: make CodeMirror text brighter and comments более заметными */
.cm-s-material-darker.CodeMirror {
  color: #e5e7eb;
}

/* Комментарии: приглушённые серо-синие в тёмной теме */
.cm-s-material-darker .cm-comment {
  color: #64748b;
  font-style: italic;
}

/* Ключи JSON/YAML (названия полей) */
.cm-s-material-darker .cm-property {
  color: #60a5fa;
}

/* Строки (пути, значения) */
.cm-s-material-darker .cm-string {
  color: #a3e635;
}

/* Числа */
.cm-s-material-darker .cm-number {
  color: #f97316;
}

/* true / false / null и прочие атомы */
.cm-s-material-darker .cm-atom {
  color: #22d3ee;
}

/* Скобки, запятые, двоеточия */
.cm-s-material-darker .cm-punctuation,
.cm-s-material-darker .cm-bracket {
  color: #9ca3af;
}

/* Ключевые слова */
.cm-s-material-darker .cm-keyword {
  color: #facc15;
}

/* Имена и переменные */
.cm-s-material-darker .cm-def,
.cm-s-material-darker .cm-variable,
.cm-s-material-darker .cm-variable-2 {
  color: #e5e7eb;
}

/* Цвет номера строки и курсор */
.cm-s-material-darker .CodeMirror-linenumber {
  color: #4b5563;
}

.cm-s-material-darker .CodeMirror-cursor {
  border-left: 2px solid #facc15;
}

/* Более заметное, но НЕ "грязное" выделение текста в редакторах CodeMirror.
   Цель — как на скриншоте: мягкая синяя подложка с прозрачностью.
   (Если включена DevTools → CodeMirror тема, её CSS имеет более высокий приоритет.) */
.cm-s-material-darker .CodeMirror-selected,
.cm-s-material-darker .CodeMirror-line::selection,
.cm-s-material-darker .CodeMirror-line > span::selection,
.cm-s-material-darker .CodeMirror-line > span > span::selection,
.xkeen-cm .CodeMirror-selected,
.xkeen-cm .CodeMirror-line::selection,
.xkeen-cm .CodeMirror-line > span::selection,
.xkeen-cm .CodeMirror-line > span > span::selection {
  background: rgba(96, 165, 250, 0.22) !important; /* мягкий светло‑синий */
}

/* На случай, если браузер использует общий ::selection внутри оболочки редактора */
.xkeen-cm ::selection {
  background: rgba(96, 165, 250, 0.22) !important;
}

/* === CodeMirror cosmetics (enabled addons need CSS to be visible) ===
   - match-highlighter: .cm-matchhighlight
   - trailing-space:    .cm-trailingspace
   - rulers:            .CodeMirror-ruler (.CodeMirror-rulers wrapper)
*/
.cm-s-material-darker .cm-matchhighlight,
.xkeen-cm .cm-matchhighlight {
  background: rgba(34, 211, 238, 0.18);
  border-radius: 2px;
}

.cm-s-material-darker .cm-trailingspace,
.xkeen-cm .cm-trailingspace {
  background: rgba(248, 113, 113, 0.28);
}

/* === CodeMirror: clickable links (Ctrl/Cmd + click) === */
.xkeen-cm .cm-link.cm-xk-url,
.xkeen-cm .cm-xk-url {
  /* Many CM themes underline `.cm-link` by default.
     We want the underline *only on hover*, like in the reference screenshot. */
  text-decoration: none !important;
}

.xkeen-cm .cm-link.cm-xk-url:hover,
.xkeen-cm .cm-xk-url:hover {
  text-decoration: underline !important;
  text-underline-offset: 2px;
  text-decoration-thickness: 1px;
  /* Subtle hover highlight (keeps syntax color from theme). */
  background: rgba(96, 165, 250, 0.14);
  border-radius: 2px;
}

/* Show pointer only when the modifier is held (script toggles the class). */
.xkeen-cm-links.xkeen-cm-link-armed .cm-xk-url {
  cursor: pointer;
}

.xkeen-cm-linktip {
  position: absolute;
  z-index: 99999;
  padding: 6px 10px;
  font-size: 12px;
  line-height: 1.2;
  border-radius: 10px;
  background: var(--modal-bg, rgba(0, 0, 0, 0.85));
  color: var(--modal-text, #e5e7eb);
  border: 1px solid var(--modal-body-border, rgba(255, 255, 255, 0.12));
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.35);
  pointer-events: none;
  white-space: nowrap;
  user-select: none;
}

.cm-s-material-darker .CodeMirror-rulers,
.xkeen-cm .CodeMirror-rulers {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
}

.cm-s-material-darker .CodeMirror-ruler,
.xkeen-cm .CodeMirror-ruler {
  /* Hide CodeMirror rulers (thin vertical guide line) */
  border-left: 0 !important;
}





.xkeen-cm {
  /* CodeMirror wrapper */
  min-height: 160px;
}


/* --- CodeMirror mouse toolbar (overlay) --- */
.xkeen-cm-toolbar {
  /* Toolbar sits above the editor (outside CodeMirror) */
  position: relative;
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin: 0 0 6px 0;
  padding-right: 6px;
  /* Ensure tooltips and the toolbar itself can overlap the editor */
  z-index: 50;
  overflow: visible;
}

/* When editor is in fullscreen, keep toolbar visible */
.xkeen-cm-toolbar.is-fullscreen {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 10050;
}


.xkeen-cm-tool {
  position: relative;
  width: 30px;
  height: 28px;
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.22);
  background: rgba(2, 6, 23, 0.72);
  color: rgba(226, 232, 240, 0.95);
  cursor: pointer;
  /*
    Reset generic <button> styles (padding/line-height/appearance) so SVG icons
    are centered *exactly* inside fixed-size square buttons.
  */
  appearance: none;
  -webkit-appearance: none;
  padding: 0;
  line-height: 0;
  font-size: 0;
  box-sizing: border-box;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}

.xkeen-cm-tool svg {
  width: 16px;
  height: 16px;
  display: block;
  flex: 0 0 auto;
  pointer-events: none;
}

.xkeen-cm-tool:hover {
  border-color: rgba(148, 163, 184, 0.45);
  background: rgba(2, 6, 23, 0.88);
}

/* Disabled state (e.g. replace/comment in readOnly mode) */
.xkeen-cm-tool:disabled,
.xkeen-cm-tool.is-disabled {
  opacity: 0.45;
  cursor: not-allowed;
  border-color: rgba(148, 163, 184, 0.18);
  background: rgba(2, 6, 23, 0.50);
}

.xkeen-cm-tool:disabled:hover,
.xkeen-cm-tool.is-disabled:hover {
  border-color: rgba(148, 163, 184, 0.18);
  background: rgba(2, 6, 23, 0.50);
}

.xkeen-cm-tool:disabled:active,
.xkeen-cm-tool.is-disabled:active {
  transform: none;
}

.xkeen-cm-tool:active {
  transform: translateY(1px);
}

.xkeen-cm-tool:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.75);
  outline-offset: 2px;
}

/* Red "?" help button */
.xkeen-cm-tool.is-help {
  color: rgba(239, 68, 68, 0.98);
}

.xkeen-cm-tool.is-help:hover {
  border-color: rgba(239, 68, 68, 0.55);
}

/* Tooltip (hover + keyboard focus) */
.xkeen-cm-tool[data-tip]::after {
  content: attr(data-tip);
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  z-index: 9999;
  white-space: nowrap;
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px solid var(--xk-tooltip-border, rgba(148, 163, 184, 0.22));
  background: var(--xk-tooltip-bg, rgba(15, 23, 42, 0.95));
  -webkit-backdrop-filter: var(--xk-tooltip-backdrop, none);
  backdrop-filter: var(--xk-tooltip-backdrop, none);
  color: var(--xk-tooltip-text, rgba(226, 232, 240, 0.98));
  box-shadow: 0 10px 30px var(--xk-tooltip-shadow, rgba(0, 0, 0, 0.55));
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0;
  transform: translateY(-2px);
  pointer-events: none;
  transition: opacity 0.12s ease, transform 0.12s ease;
}

/* When the portal tooltip system is enabled, hide legacy CodeMirror tooltips
   that rely on data-tip + pseudo-elements (avoid double tooltips). */
.xk-tooltip-portal .xkeen-cm-tool[data-tip]::after {
  display: none !important;
}

.xkeen-cm-tool[data-tip]:hover::after,
.xkeen-cm-tool[data-tip]:focus-visible::after {
  opacity: 1;
  transform: translateY(0);
}

/* Light theme */
html[data-theme="light"] .xkeen-cm-tool {
  background: rgba(255, 255, 255, 0.85);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.18);
}

html[data-theme="light"] .xkeen-cm-tool:disabled,
html[data-theme="light"] .xkeen-cm-tool.is-disabled {
  background: rgba(255, 255, 255, 0.65);
  border-color: rgba(15, 23, 42, 0.10);
}

html[data-theme="light"] .xkeen-cm-tool.is-help {
  color: rgba(220, 38, 38, 0.98);
}

html[data-theme="light"] .xkeen-cm-tool[data-tip]::after {
  background: rgba(255, 255, 255, 0.98);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.18);
}

/* --- CodeMirror help drawer (slides in from the right) --- */
.xkeen-cm-help-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.55);
  z-index: 10040;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.16s ease;
}

.xkeen-cm-help-overlay.is-open {
  opacity: 1;
  pointer-events: auto;
}

.xkeen-cm-help-drawer {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  width: min(460px, 92vw);
  z-index: 10041;
  transform: translateX(100%);
  transition: transform 0.18s ease;
  border-left: 1px solid rgba(148, 163, 184, 0.18);
  background: rgba(2, 6, 23, 0.98);
  color: rgba(226, 232, 240, 0.95);
  box-shadow: -24px 0 48px rgba(0, 0, 0, 0.35);
  display: flex;
  flex-direction: column;
}

.xkeen-cm-help-drawer.is-open {
  transform: translateX(0);
}

.xkeen-cm-help-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 14px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.16);
}

.xkeen-cm-help-title {
  font-weight: 700;
  font-size: calc(14px * var(--xk-font-scale));
  letter-spacing: 0.2px;
}

.xkeen-cm-help-close {
  width: 34px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  background: rgba(15, 23, 42, 0.65);
  color: rgba(226, 232, 240, 0.95);
  cursor: pointer;
}

.xkeen-cm-help-close:hover {
  background: rgba(15, 23, 42, 0.9);
}

.xkeen-cm-help-body {
  padding: 12px 14px 18px;
  overflow: auto;
}

.xkeen-cm-help-section {
  padding: 10px 10px;
  margin: 0 0 10px 0;
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.14);
  background: rgba(15, 23, 42, 0.35);
}

.xkeen-cm-help-section h3 {
  margin: 0 0 6px 0;
  font-size: calc(13px * var(--xk-font-scale));
}

.xkeen-cm-help-section p {
  margin: 6px 0;
  font-size: calc(13px * var(--xk-font-scale));
  line-height: 1.35;
}

.xkeen-cm-help-section ul {
  margin: 8px 0 0 18px;
  padding: 0;
  font-size: calc(13px * var(--xk-font-scale));
  line-height: 1.35;
}

html[data-theme="light"] .xkeen-cm-help-overlay {
  background: rgba(15, 23, 42, 0.35);
}

html[data-theme="light"] .xkeen-cm-help-drawer {
  background: rgba(255, 255, 255, 0.98);
  color: rgba(15, 23, 42, 0.95);
  border-left-color: rgba(15, 23, 42, 0.12);
  box-shadow: -24px 0 48px rgba(0, 0, 0, 0.18);
}

html[data-theme="light"] .xkeen-cm-help-head {
  border-bottom-color: rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] .xkeen-cm-help-close {
  background: rgba(255, 255, 255, 0.9);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.16);
}

html[data-theme="light"] .xkeen-cm-help-section {
  background: rgba(248, 250, 252, 0.8);
  border-color: rgba(15, 23, 42, 0.12);
}

/* Мини-терминал XKeen */
.terminal-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: var(--modal-overlay, rgba(15, 23, 42, 0.75));
  z-index: 50;
}

.terminal-window {
  width: 520px;
  height: 360px;

  min-width: 360px;
  min-height: 240px;

  max-width: 95vw;
  max-height: 90vh;

  background: var(--modal-bg, #020617);
  border-radius: 12px;
  border: 1px solid var(--modal-border, #334155);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
  box-shadow: 0 20px 40px color-mix(in srgb, rgba(0,0,0,0.75) 70%, transparent);
  padding: 12px 14px;
  font-size: calc(14px * var(--xk-font-scale));

  /* resizable + layout */
  display: flex;
  flex-direction: column;
  resize: both;
  overflow: hidden;
  position: relative;

  /* Allow the underlying page to scroll while the terminal is open,
     but prevent "scroll chaining" from the terminal buffer to the page. */
  overscroll-behavior: contain;
}

/* Prevent wheel/touch scroll from leaking to the page when the xterm viewport
   hits the top/bottom of its scrollback buffer (especially on trackpads). */
.terminal-window .xterm-viewport {
  overscroll-behavior: contain;
}

.terminal-window::after {
  /* визуальная "ручка" в правом нижнем углу */
  content: "";
  position: absolute;
  right: 8px;
  bottom: 8px;
  width: 14px;
  height: 14px;
  border-right: 2px solid rgba(148, 163, 184, 0.35);
  border-bottom: 2px solid rgba(148, 163, 184, 0.35);
  pointer-events: none;
  border-radius: 2px;
}

.terminal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;

  /* drag handle */
  cursor: move;
  user-select: none;
}

.terminal-header-left {
  display: flex;
  align-items: center;
  min-width: 0;
}

.terminal-conn-lamp {
  margin-left: 10px;
}

.terminal-uptime {
  margin-left: 8px;
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: nowrap;
}

.terminal-tool-btn-danger {
  border-color: color-mix(in srgb, var(--sem-error, #f87171) 55%, transparent);
  background: color-mix(in srgb, var(--sem-error, #f87171) 18%, var(--editor-btn-bg, #020617) 82%);
  color: color-mix(in srgb, var(--sem-error, #f87171) 55%, var(--text, #e5e7eb) 45%);
}

.terminal-tool-btn-danger:hover {
  background: color-mix(in srgb, var(--sem-error, #f87171) 24%, var(--editor-btn-bg, #020617) 76%);
}

/* Keep danger buttons "danger" even in active state (override global button:active gradient). */
.terminal-tool-btn-danger:active {
  background: color-mix(in srgb, var(--sem-error, #f87171) 32%, var(--editor-btn-bg, #020617) 68%);
  border-color: color-mix(in srgb, var(--sem-error, #f87171) 75%, transparent);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--sem-error, #f87171) 25%, transparent);
  transform: translateY(1px) scale(0.99);
}

.terminal-toolbar {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 6px;
  flex-wrap: wrap;

  /* Override the header drag cursor inside toolbar/menus.
     Buttons still show pointer via .terminal-tool-btn { cursor: pointer; } */
  cursor: default;

  position: relative;
}

/* Dropdown menus should not look like drag handles */
.terminal-overflow-menu,
.terminal-view-menu,
.terminal-buffer-menu {
  cursor: default;
}

.terminal-tool-btn {
  border-radius: 9999px;
  padding: 4px 8px;
  border: 1px solid var(--header-btn-border, rgba(148, 163, 184, 0.35));
  background: var(--header-btn-bg, rgba(2, 6, 23, 0.6));
  color: var(--header-btn-text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  cursor: pointer;
}

.terminal-tool-btn:hover {
  background: var(--header-btn-hover-bg, rgba(17, 24, 39, 0.85));
}

.terminal-tool-btn:active {
  transform: translateY(1px);
}

.terminal-tool-btn.is-active {
  border-color: var(--header-tab-active-bg, rgba(59, 130, 246, 0.65));
  background: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 24%, transparent);
}

.terminal-tool-btn-kbd {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  padding: 4px 7px;
}

.terminal-header span {
  font-weight: 600;
}

.terminal-close {
  background: transparent;
  border: none;
  color: var(--modal-close, #9ca3af);
  cursor: pointer;
  font-size: calc(18px * var(--xk-font-scale));
  line-height: 1;
}

.terminal-window.is-fullscreen {
  position: fixed !important;
  left: 8px !important;
  top: 8px !important;
  width: calc(100vw - 16px) !important;
  height: calc(100vh - 16px) !important;
  max-width: none !important;
  max-height: none !important;
  resize: none !important;
}

.terminal-window.is-fullscreen::after {
  display: none;
}

.terminal-command {
  width: 100%;
  background: var(--card-bg, #020617);
  border-radius: 6px;
  border: 1px solid var(--border, #1f2937);
  padding: 4px 8px;
  margin-bottom: 6px;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-search-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
  flex-wrap: wrap;
}

.terminal-search-input {
  flex: 1 1 220px;
  min-width: 140px;
  background: var(--card-bg, #020617);
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  padding: 6px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--text, #e5e7eb);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-search-btn {
  border-radius: 9999px;
  padding: 4px 8px;
  border: 1px solid var(--header-btn-border, rgba(148, 163, 184, 0.35));
  background: var(--header-btn-bg, rgba(2, 6, 23, 0.6));
  color: var(--header-btn-text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  cursor: pointer;
}

.terminal-search-btn:hover {
  background: var(--header-btn-hover-bg, rgba(17, 24, 39, 0.85));
}

.terminal-search-btn:active {
  transform: translateY(1px);
}

.terminal-search-counter {
  min-width: 52px;
  text-align: center;
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-output {
  width: 100%;
  background: var(--card-bg, #020617);
  border-radius: 6px;
  border: 1px solid var(--border, #1f2937);
  padding: 6px 8px;
  margin-bottom: 6px;

  /* растягиваемое окно: вывод занимает всё оставшееся место */
  flex: 1 1 auto;
  min-height: 140px;
  max-height: none;

  overflow: auto;
  white-space: pre-wrap;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--text, #e5e7eb);
}

.terminal-output:has(.xterm) {
  padding: 0;
  overflow: hidden;
}

/* xterm-addon-search match decorations (improves readability on dark background) */
.xterm-find-result-decoration {
  border-radius: 3px;
}
.xterm-find-active-result-decoration {
  border-radius: 3px;
  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.35) inset;
}

.terminal-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.terminal-footer-group {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.terminal-footer-label {
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  font-weight: 600;
  user-select: none;
  margin-right: 2px;
}


.terminal-input-row {
  display: flex;
  gap: 8px;
}

.terminal-input-row.confirm-hidden {
  justify-content: flex-end;
}

.terminal-input {
  flex: 1;
  background: var(--card-bg, #020617);
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  padding: 6px 10px;
  font-size: calc(14px * var(--xk-font-scale));
  color: var(--text, #e5e7eb);
}

.terminal-send {
  border-radius: 9999px;
  padding: 6px 12px;
  border: none;
  background: var(--editor-btn-active-to, #2563eb);
  color: var(--header-tab-active-text, #f9fafb);
  font-size: calc(14px * var(--xk-font-scale));
  cursor: pointer;
}
.terminal-send:hover {
  background: var(--editor-btn-active-from, #1d4ed8);
}


.terminal-history-btn {
  border-radius: 9999px;
  padding: 6px 10px;
  border: 1px solid var(--border, #4b5563);
  background: transparent;
  color: var(--text, #e5e7eb);
  font-size: calc(14px * var(--xk-font-scale));
  cursor: pointer;
}
.terminal-history-btn:hover {
  background: color-mix(in srgb, var(--card-bg, #111827) 85%, transparent);
}



.mihomo-templates-row {
  gap: 8px;
  flex-wrap: wrap;
  overflow-x: auto;
}

.mihomo-templates-row button {
  flex: 0 0 auto;
}

.mihomo-template-select {
  min-width: 180px;
  border-radius: 9999px;
  padding: 6px 12px;
  font-size: calc(14px * var(--xk-font-scale));
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  outline: none;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.4);
}

.mihomo-template-select:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.5);
}



/* Top tabs (main header + DevTools tabs)
   Base style is compact and does NOT stretch buttons across the full page.
   The main panel header uses .header-tabs modifier to stretch evenly in one line.
*/
.top-tabs {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}

/* DevTools tabs: align with the left Tools column and stretch like the "Сервис панели" block.
   Scoped via .dt-tabs to avoid affecting any other tabs/buttons in the UI.
*/
.top-tabs.dt-tabs {
  justify-content: flex-start;
  flex-wrap: nowrap;
  width: min(100%, 420px);
  margin-right: auto;
}

/* Main panel header tabs: always one line, evenly stretched */
.top-tabs.header-tabs {
  width: 100%;
  flex-wrap: nowrap;
  justify-content: space-between;
  overflow-x: auto;
  scrollbar-width: none; /* Firefox */
}

.top-tabs.header-tabs::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
}

button.top-tab-btn {
  border-radius: 9999px;
  padding: 6px 10px;
  font-size: calc(13px * var(--xk-font-scale));
  text-align: center;
  justify-content: center;
  display: inline-flex;
  align-items: center;
  background: var(--header-tab-bg, #020617);
  border: 1px solid var(--header-tab-border, #1f2937);
  color: var(--header-tab-text, #e5e7eb);
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.7);
  box-shadow: 0 2px 6px color-mix(in srgb, var(--header-tab-border, #1f2937) 55%, transparent);
  cursor: pointer;
  white-space: nowrap;
  width: auto;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

/* DevTools pills should share the available width (two buttons ≈ full width of the left column). */
.top-tabs.dt-tabs .top-tab-btn {
  flex: 1 1 0;
  width: auto;
}

/* Header tabs need to share width equally */
.top-tabs.header-tabs .top-tab-btn {
  flex: 1 1 0;
  min-width: 0;
  padding: 6px 8px;
  /* +1 (header tabs) */
  font-size: calc(13px * var(--xk-font-scale));
}

button.top-tab-btn:hover {
  background: var(--header-tab-active-bg, #2563eb);
  border-color: var(--header-tab-active-bg, #2563eb);
  color: var(--header-tab-active-text, #ffffff);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.6);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 45%, transparent);
  transform: translateY(-1px);
}

button.top-tab-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.7);
}

button.top-tab-btn.active {
  background: var(--header-tab-active-bg, #2563eb);
  border-color: var(--header-tab-active-bg, #2563eb);
  color: var(--header-tab-active-text, #ffffff);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 35%, transparent);
}

.view-section {
  margin-top: 16px;
}
/* Fix terminal overflow */
.terminal-window,
.terminal-window * {
    box-sizing: border-box;
}



/* DevTools Logs: two-column layout with sidebar */
.dt-logs-layout {
  display: grid;
  grid-template-columns: minmax(220px, 280px) minmax(0, 1fr);
  gap: 14px;
  align-items: start;
}

.dt-logs-sidebar,
.dt-logs-main {
  min-width: 0;
}

.dt-logs-sidebar-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.dt-log-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 520px;
  overflow: auto;
  padding-right: 4px;
}

.dt-log-item {
  width: 100%;
  text-align: left;
  border-radius: 14px;
  border: 1px solid var(--border, #1f2937);
  background: rgba(2, 6, 23, 0.55);
  background: var(--fm-row-header-bg, color-mix(in srgb, var(--card-bg, #020617) 55%, transparent));
  padding: 8px 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.dt-log-item:hover {
  border-color: var(--accent, #60a5fa);
}

.dt-log-item.active {
  border-color: var(--accent, #60a5fa);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.18);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--accent, #60a5fa) 18%, transparent);
}

.dt-log-item.is-missing {
  opacity: 0.55;
  cursor: not-allowed;
}

.dt-log-item.is-missing:hover {
  border-color: var(--border, #1f2937);
}

.dt-log-name {
  font-size: calc(12px * var(--xk-font-scale));
  font-weight: 600;
  color: var(--text, #e5e7eb);
}

.dt-log-meta {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  line-height: 1.1;
}

.dt-log-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.dt-log-dot {
  width: 8px;
  height: 8px;
  border-radius: 9999px;
  background: var(--sem-success, #22c55e);
  opacity: 0;
  flex: 0 0 auto;
  box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.18);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--sem-success, #22c55e) 18%, transparent);
}

.dt-log-item.has-new .dt-log-dot {
  opacity: 1;
}

.dt-log-view {
  box-sizing: border-box;
  white-space: pre;
  overflow-x: auto;
}

/* DevTools Logs: highlight only the level token ([Info]/ERROR/etc.), not the whole line */
.dt-log-view.log-block .log-line-info,
.dt-log-view.log-block .log-line-warning,
.dt-log-view.log-block .log-line-error,
.dt-log-view.log-block .log-line-debug,
#dt-log-context-body .log-line-info,
#dt-log-context-body .log-line-warning,
#dt-log-context-body .log-line-error,
#dt-log-context-body .log-line-debug {
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
}

/* Log levels (tokens): used in DevTools Tools Logs + Live Xray logs */
.log-lvl {
  font-weight: 700;
  padding: 1px 6px;
  border-radius: 9999px;
  border: 1px solid transparent;
  white-space: nowrap;
}

.log-lvl-info { color: var(--sem-info, #93c5fd); }
.log-lvl-warning { color: var(--sem-warning, #fbbf24); }
.log-lvl-error { color: var(--sem-error, #f87171); }
.log-lvl-debug { color: var(--sem-debug, #a1a1aa); }

.log-lvl-info,
.log-lvl-warning,
.log-lvl-error,
.log-lvl-debug {
  background: rgba(255, 255, 255, 0.06);
  background: color-mix(in srgb, currentColor 14%, transparent);
  border-color: rgba(255, 255, 255, 0.10);
  border-color: color-mix(in srgb, currentColor 28%, transparent);
}

/* DevTools Logs: Stage 4 "human" filters */
.dt-log-human-filters {
  gap: 10px;
}

.dt-log-profile {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.dt-log-profile-btn.active {
  border-color: var(--accent, #60a5fa);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.18);
}

.dt-log-presets {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.dt-chip-btn {
  border-radius: 9999px;
  border: 1px solid var(--header-btn-border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  padding: 6px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  cursor: pointer;
  transition: border-color 0.12s ease, transform 0.12s ease, box-shadow 0.12s ease;
}

.dt-chip-btn:hover {
  background: var(--fm-btn-hover-bg, var(--header-btn-hover-bg, rgba(255,255,255,0.06)));
  border-color: var(--header-btn-hover-border, var(--accent, #60a5fa));
  color: var(--header-btn-hover-text, var(--text, #e5e7eb));
  transform: translateY(-1px);
}

.dt-chip-btn.active {
  border-color: var(--header-tab-active-bg, #2563eb);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.18);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 18%, transparent);
}

.dt-log-advanced {
  border: 1px solid var(--border, #1f2937);
  border-radius: 14px;
  padding: 6px 10px;
  background: rgba(2, 6, 23, 0.45);
  background: color-mix(in srgb, var(--card-bg, #020617) 45%, transparent);
}

/* Timestamp visuals inside log lines */
.log-block .log-ts {
  opacity: 0.7;
  margin-right: 8px;
  font-variant-numeric: tabular-nums;
}

/* Live Xray logs */
.xray-log-block {
  /* Сделать лог-окно заметно читаемее (было слишком мелко) */
  font-size: calc(15px * var(--xk-font-scale));
  line-height: 1.35;

  /* Ручка растягивания только вниз: фиксируем минимальную высоту */
  height: 420px;
  min-height: 420px;
  max-height: none;

  /* Allow user to stretch the log window вниз (vertical only) */
  resize: vertical;
}

/* Live Xray logs: filter + selects (match the panel theme) */
.xray-log-filter{
  width: 100%;
  padding: 7px 12px;
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--text, #e5e7eb);
  box-sizing: border-box;
  font-size: calc(13px * var(--xk-font-scale));
  line-height: 1.15;
  outline: none;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.40);
  transition: border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
}

.xray-log-filter::placeholder{
  color: var(--muted, #6b7280);
}

.xray-log-filter:focus{
  border-color: var(--accent, #60a5fa);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent, #60a5fa) 22%, transparent);
}

.xray-log-select{
  border-radius: 9999px;
  padding: 7px 34px 7px 12px;
  font-size: calc(12px * var(--xk-font-scale));
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--text, #e5e7eb);
  outline: none;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.40);
  cursor: pointer;
  line-height: 1.15;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23a3b3c7' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 14px 14px;
}

.xray-log-select:focus{
  border-color: var(--accent, #60a5fa);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent, #60a5fa) 22%, transparent);
}

html[data-theme="light"] .xray-log-select{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
}


.xray-log-select option{
  background: var(--card-bg, #020617);
  color: var(--text, #e5e7eb);
}

html[data-theme="light"] .xray-log-select option{
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
}


/* Inline field validation (e.g., Regex invalid) */
.xray-log-filter.is-invalid {
  border-color: var(--sem-error, #ef4444);
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.25);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--sem-error, #ef4444) 25%, transparent);
}

.dt-log-search-wrap {
  display: flex;
  flex-direction: column;
  min-width: 220px;
}

/* Stage 5: Include/Exclude tokens as chips */
.dt-token-field {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  min-width: 220px;
  padding: 6px 10px;
  border-radius: 16px;
  border: 1px solid var(--border, #374151);
  background: var(--card-bg, #020617);
}

.dt-token-field-compact {
  min-width: 180px;
}

.dt-token-field.is-invalid {
  border-color: var(--sem-error, #ef4444);
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.25);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--sem-error, #ef4444) 25%, transparent);
}

.dt-token-entry {
  flex: 1;
  min-width: 120px;
  border: none;
  outline: none;
  background: transparent;
  color: var(--text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  padding: 2px 0;
}

.dt-token-entry::placeholder {
  color: var(--muted, #6b7280);
}

.dt-token-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 9999px;
  border: 1px solid var(--border, #1f2937);
  background: rgba(2, 6, 23, 0.55);
  background: color-mix(in srgb, var(--card-bg, #020617) 55%, transparent);
  color: var(--text, #e5e7eb);
  padding: 4px 8px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
}

.dt-token-chip .dt-token-x {
  border: none;
  background: transparent;
  color: var(--muted, #94a3b8);
  cursor: pointer;
  font-size: calc(14px * var(--xk-font-scale));
  line-height: 1;
  padding: 0;
}

.dt-token-chip .dt-token-x:hover {
  color: var(--sem-error, #f87171);
}

/* Stage 6: Level filter container */
.dt-log-level-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.dt-field-error {
  margin-top: 4px;
  padding-left: 10px;
  color: var(--sem-error, #f87171);
  font-size: calc(11px * var(--xk-font-scale));
  line-height: 1.2;
}


/* Live Xray logs */
.xray-log-block {
  /* Keep only the color here (size/resize rules are defined выше) */
  color: var(--text, #e5e7eb);
}

.log-block .log-line {
  display: block;
}

/* Logs: keep line text neutral; mark level via a subtle left accent */
.log-block .log-line-info,
.log-block .log-line-warning,
.log-block .log-line-error,
.log-block .log-line-debug {
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
}

.dt-log-view .log-line-info,
#dt-log-context-body .log-line-info,
.log-block .log-line-info {
  box-shadow: inset 2px 0 0 var(--sem-info, #93c5fd);
  box-shadow: inset 2px 0 0 color-mix(in srgb, var(--sem-info, #93c5fd) 65%, transparent);
}

.dt-log-view .log-line-warning,
#dt-log-context-body .log-line-warning,
.log-block .log-line-warning {
  box-shadow: inset 2px 0 0 var(--sem-warning, #fbbf24);
  box-shadow: inset 2px 0 0 color-mix(in srgb, var(--sem-warning, #fbbf24) 65%, transparent);
}

.dt-log-view .log-line-error,
#dt-log-context-body .log-line-error,
.log-block .log-line-error {
  box-shadow: inset 2px 0 0 var(--sem-error, #f87171);
  box-shadow: inset 2px 0 0 color-mix(in srgb, var(--sem-error, #f87171) 65%, transparent);
}

.dt-log-view .log-line-debug,
#dt-log-context-body .log-line-debug,
.log-block .log-line-debug {
  box-shadow: inset 2px 0 0 var(--sem-debug, #a1a1aa);
  box-shadow: inset 2px 0 0 color-mix(in srgb, var(--sem-debug, #a1a1aa) 65%, transparent);
}



.log-btn.icon-only {
  font-size: calc(18px * var(--xk-font-scale));
  line-height: 1;
  padding-inline: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}



/* Backup action buttons in backups table */
.backup-actions {
  display: flex;
  gap: 6px;
  justify-content: flex-end;
  align-items: center;
}

button.backup-icon-btn {
  flex: 0 0 auto;
  padding: 4px 10px;
  border-radius: 9999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

button.backup-icon-btn .backup-icon,
.backup-icon-btn .backup-icon {
  width: 14px;
  height: 14px;
}

/* More prominent style for delete backup button */
button.backup-icon-btn.backup-delete-btn {
  background: linear-gradient(135deg, #b91c1c, #ef4444);
  border-color: #b91c1c;
}

@keyframes xray-log-blink {
  0%,
  49% {
    opacity: 1;
  }
  50%,
  100% {
    opacity: 0.15;
  }
}

@media (prefers-reduced-motion: reduce) {
  .xray-log-lamp[data-state="on"] {
    animation: none;
  }
}

/* Xray logs status lamp */
.xray-log-lamp {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 9999px;
  margin-left: 8px;
  background: #6b7280;
  box-shadow: none;
  transition:
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.15s ease;
  vertical-align: middle;
}

.xray-log-lamp[data-state="on"] {
  background: var(--sem-success, #22c55e);
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.85);
  box-shadow: 0 0 6px color-mix(in srgb, var(--sem-success, #22c55e) 70%, transparent);
  /* Live logs stream enabled: blink like an LED (on/off). */
  animation: xray-log-blink 1s steps(1, end) infinite;
}


.xray-log-lamp[data-state="off"] {
  background: #4b5563;
  box-shadow: none;
}

.xray-log-lamp[data-state="error"] {
  background: var(--sem-warning, #f97316);
  box-shadow: 0 0 6px rgba(249, 115, 22, 0.7);
  box-shadow: 0 0 6px color-mix(in srgb, var(--sem-warning, #f97316) 70%, transparent);
}

.xray-log-lamp.pulse {
  transform: scale(1.2);
}

/* Header badge: global Xray logs enabled */
.xray-logs-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-left: 10px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid var(--sem-warning, #f59e0b);
  background: rgba(245, 158, 11, 0.12);
  background: color-mix(in srgb, var(--sem-warning, #f59e0b) 12%, transparent);
  color: var(--sem-warning, #fbbf24);
  font-size: calc(12px * var(--xk-font-scale));
  font-weight: 600;
  line-height: 1;
  white-space: nowrap;
  user-select: none;
}

/* Header badge: active Xray profile (classic vs hysteria2 fragments) */
.xray-profile-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 10px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--text-muted, #94a3b8) 35%, transparent);
  background: color-mix(in srgb, var(--text-muted, #94a3b8) 10%, transparent);
  color: var(--text-muted, #94a3b8);
  font-size: calc(12px * var(--xk-font-scale));
  font-weight: 600;
  line-height: 1;
  white-space: nowrap;
  user-select: none;
}

.xray-profile-badge[data-profile="hys2"] {
  border-color: var(--accent, #60a5fa);
  background: color-mix(in srgb, var(--accent, #60a5fa) 12%, transparent);
  color: var(--accent, #60a5fa);
}

.xray-logs-badge[data-state="on"] {
  display: inline-flex;
  animation: xray-logs-badge-blink 1.1s infinite;
}

.xray-logs-badge[data-state="off"] {
  display: none;
}

@keyframes xray-logs-badge-blink {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.45; transform: scale(0.98); }
}

/* Mobile layout tweaks */
@media (max-width: 640px) {
  /* On small screens:
     - DevTools tabs can wrap naturally.
     - Header tabs stay on one line and become horizontally scrollable.
  */
  .top-tabs { justify-content: flex-start; }

  .top-tabs.header-tabs .top-tab-btn {
    flex: 0 0 auto;
    font-size: calc(12px * var(--xk-font-scale));
    padding: 6px 10px;
  }

  table {
    font-size: calc(12px * var(--xk-font-scale));
  }

  th,
  td {
    padding: 6px 4px;
  }

  .backup-actions {
    justify-content: flex-end;
  }
}


/* GitHub catalog modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 60;

  /*
    Safety net for modals that end up larger than the viewport (or if a modal
    is positioned incorrectly by custom scripts/styles).
    The overlay becomes scrollable so the header/close button stays reachable.
  */
  padding: 24px;
  box-sizing: border-box;
  overflow: auto;
}

/* Confirm dialog must stay above other modals (e.g. file manager operations modal). */
#confirm-modal {
  z-index: 130;
}

.modal.hidden {
  display: none;
}

.modal-content {
  background: #020617;
  border-radius: 12px;
  border: 1px solid #334155;
  padding: 12px 14px 14px 14px;
  max-width: 520px;
  width: 100%;
  max-height: 80vh;
  box-sizing: border-box;
  box-shadow: 0 18px 50px rgba(15, 23, 42, 0.8);
  display: flex;
  flex-direction: column;
  position: relative;
}

/* Terminal history drawer (right-side modal) */
.modal.modal-drawer {
  justify-content: flex-end;
  align-items: stretch;

  /* Drawer should stick to the edge without extra padding/scroll on overlay. */
  padding: 0;
  overflow: hidden;
}

/* Ensure regular modals are centered even if some page styles override flex alignment. */
.modal:not(.modal-drawer) {
  align-items: center !important;
  justify-content: center !important;
}

.modal.modal-drawer .modal-content {
  max-width: 420px;
  width: min(92vw, 420px);
  height: 100vh;
  max-height: 100vh;
  border-radius: 0;
  border-left: 1px solid #334155;
  border-top: 0;
  border-right: 0;
  border-bottom: 0;
}

.terminal-history-filter {
  width: 100%;
  box-sizing: border-box;
  padding: 10px 10px;
  border-radius: 10px;
  border: 1px solid #334155;
  background: rgba(255,255,255,0.04);
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
  outline: none;
}

.terminal-history-list {
  margin-top: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  overflow: auto;
  max-height: calc(100vh - 220px);
  padding-right: 4px;
}

.terminal-history-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(51,65,85,0.7);
  background: rgba(255,255,255,0.03);
  cursor: pointer;
}

.terminal-history-item:hover {
  background: rgba(255,255,255,0.06);
}

.terminal-history-item.selected {
  border-color: rgba(56,189,248,0.85);
  box-shadow: 0 0 0 2px rgba(56,189,248,0.15);
}

.terminal-history-cmd {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.9rem;
  word-break: break-word;
  white-space: pre-wrap;
  opacity: 0.95;
}

.terminal-history-hint {
  margin-top: 8px;
  font-size: 0.85rem;
  opacity: 0.75;
}



.modal-actions {
  margin-top: 12px;
  display: flex;
  justify-content: space-between;
  gap: 8px;
  align-items: center;
}

.github-config-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
}

.github-config-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 6px;
  background: rgba(255,255,255,0.04);
}

.github-config-title {
  font-weight: 600;
}

.github-config-meta {
  font-size: 0.8rem;
  opacity: 0.8;
}


.github-export-form {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.github-export-form input,
.github-export-form textarea {
  width: 100%;
  background: #111827;
  border: 1px solid #374151;
  color: #e5e7eb;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: 0.9rem;
  box-sizing: border-box;
}


.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid #1f2937;

  /* Drag handle for draggable modals (buttons override cursor as needed). */
  cursor: move;
  user-select: none;
}

.modal-title {
  font-size: calc(15px * var(--xk-font-scale));
  font-weight: 600;
}

.modal-close {
  background: transparent;
  border: none;
  color: #9ca3af;
  cursor: pointer;
  font-size: calc(18px * var(--xk-font-scale));
  line-height: 1;
}

.modal-close:hover {
  color: #e5e7eb;
}

.modal-body {
  margin-top: 8px;
  margin-bottom: 10px;
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overflow-x: hidden;
}

.modal-resizer {
  position: absolute;
  width: 16px;
  height: 16px;
  left: auto;
  right: 6px;
  bottom: 6px;
  cursor: se-resize;
  z-index: 5;
  opacity: 0.55;
  border-right: 2px solid rgba(148,163,184,0.7);
  border-bottom: 2px solid rgba(148,163,184,0.7);
  border-radius: 2px;
  user-select: none;
  touch-action: none;
}

/* Routing help modal: slightly larger resize handle (iframe makes pointer events trickier). */
#xkeen-routing-help-modal .modal-resizer {
  width: 20px;
  height: 20px;
  right: 10px;
  bottom: 10px;
}

.modal-resizer::before {
  content: '';
  position: absolute;
  right: 3px;
  bottom: 3px;
  width: 10px;
  height: 10px;
  border-right: 2px solid rgba(148,163,184,0.45);
  border-bottom: 2px solid rgba(148,163,184,0.45);
  border-radius: 2px;
}

.modal-resizer:hover {
  opacity: 0.9;
}


/* Donate modal (💰 Донат) */
#donate-modal .modal-content {
  max-width: 760px;
}

.donate-modal-content {
  padding: 14px 16px 16px 16px;
}

.donate-lead {
  margin: 0 0 12px 0;
  font-size: calc(14px * var(--xk-font-scale));
  line-height: 1.45;
  opacity: 0.95;
}

.donate-coins {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.donate-coin {
  border: 1px solid rgba(51, 65, 85, 0.75);
  background: rgba(255, 255, 255, 0.03);
  border-radius: 14px;
  padding: 10px 10px 12px 10px;
}

.donate-coin-title {
  display: flex;
  align-items: baseline;
  gap: 6px;
  font-size: calc(13px * var(--xk-font-scale));
  font-weight: 600;
  margin-bottom: 8px;
}

.donate-coin-sub {
  font-weight: 500;
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.75;
}

.donate-address {
  width: 100%;
  display: inline-flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(51, 65, 85, 0.85);
  background: rgba(2, 6, 23, 0.75);
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
  cursor: pointer;
  text-align: left;
  box-sizing: border-box;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: calc(12.5px * var(--xk-font-scale));
  line-height: 1.35;
  transition: transform 0.05s ease, box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
}

.donate-address-text {
  overflow-wrap: anywhere;
  word-break: break-word;
}

.donate-address-icon {
  flex: 0 0 auto;
  opacity: 0.75;
}

.donate-address:hover {
  border-color: rgba(37, 99, 235, 0.7);
  box-shadow: 0 10px 25px rgba(37, 99, 235, 0.22);
  transform: translateY(-1px);
}

.donate-address:active {
  transform: translateY(1px) scale(0.99);
}

.donate-hint {
  margin-top: 10px;
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.75;
}

html[data-theme="light"] .donate-coin {
  background: rgba(15, 23, 42, 0.04);
  border-color: rgba(15, 23, 42, 0.18);
}

html[data-theme="light"] .donate-address {
  background: rgba(255, 255, 255, 0.85);
  border-color: rgba(15, 23, 42, 0.18);
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
}

html[data-theme="light"] .donate-address:hover {
  border-color: rgba(37, 99, 235, 0.55);
  box-shadow: 0 10px 25px rgba(37, 99, 235, 0.16);
}

/* DevTools: ENV help modal/table */
#dt-env-help-modal .modal-content {
  width: min(1120px, 96vw);
  max-width: 1120px;
}

/* Let the help modal scroll horizontally if something still overflows. */
#dt-env-help-modal .modal-body {
  overflow-x: auto;
}

.dt-env-help-table-wrap {
  overflow: auto;
  border: 1px solid rgba(51,65,85,0.6);
  border-radius: 10px;
}

.dt-env-help-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.dt-env-help-table th,
.dt-env-help-table td {
  text-align: left;
  vertical-align: top;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(51,65,85,0.35);
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  hyphens: auto;
}

.dt-env-help-table thead th {
  position: sticky;
  top: 0;
  background: rgba(2,6,23,0.92);
  backdrop-filter: blur(6px);
}

html[data-theme="light"] .dt-env-help-table thead th {
  background: rgba(255,255,255,0.92);
}

.dt-env-help-col-key { width: 260px; white-space: nowrap; }
.dt-env-help-col-restart { width: 190px; }

.dt-env-help-td-key code {
  white-space: nowrap;
}

@media (max-width: 720px) {
  .dt-env-help-col-key { width: 210px; }
  .dt-env-help-col-restart { width: 150px; }
}

/*
  JSON editor modal: avoid "double scroll" (outer modal-body + inner CodeMirror).
  Keep modal-body non-scrollable and let CodeMirror stretch & scroll.
*/
#json-editor-modal .modal-content {
  /*
    IMPORTANT:
    `.modal-content` has `max-height: 80vh` globally, but no explicit `height`.
    If the JSON content doesn't immediately force the modal to reach its max-height,
    CodeMirror can end up with an effectively unbounded height (because the global
    `.CodeMirror { height: auto; }` rule lets it grow with content). In that case
    the extra lines get clipped by the modal layout, and the internal scrollbar may
    not appear.

    Setting an explicit height for the JSON editor modal guarantees that CodeMirror
    always has a bounded area and shows the same vertical scrollbar behavior for
    both 03_inbounds.json and 04_outbounds.json.
  */
  height: 80vh;
}

/* JSON editor modal: let the scroll area use the available height (no global cap) */
#json-editor-modal .CodeMirror-scroll {
  max-height: none !important;
  height: 100% !important;
}

#json-editor-modal .modal-body {
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* CodeMirror wrapper inside JSON editor modal should occupy remaining height */
#json-editor-modal .CodeMirror {
  flex: 1 1 auto;
  min-height: 0;
  height: 100% !important; /* override CodeMirror's default 300px */
}

/* Keep fallback textarea usable if CodeMirror fails to load */
#json-editor-modal textarea#json-editor-textarea {
  flex: 1 1 auto;
  min-height: 0;
  height: 100%;
  overflow: auto;
}


/* File manager text editor modal: avoid "double scroll" (outer modal-body + inner CodeMirror) */
#fm-editor-modal .modal-content {
  height: 80vh;
  max-width: 980px;
}

#fm-editor-modal .modal-body {
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

#fm-editor-modal .CodeMirror-scroll {
  max-height: none !important;
  height: 100% !important;
}

#fm-editor-modal .CodeMirror {
  flex: 1 1 auto;
  min-height: 0;
  height: 100% !important;
}

/* Keep fallback textarea usable if CodeMirror fails to load */
#fm-editor-modal textarea#fm-editor-textarea {
  flex: 1 1 auto;
  min-height: 0;
  height: 100%;
  overflow: auto;
}

/* Routing help modal (iframe): avoid "double scroll" (outer modal-body + inner iframe) */
#xkeen-routing-help-modal .modal-content {
  height: 80vh;
}

#xkeen-routing-help-modal .modal-body {
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#xkeen-routing-help-modal iframe {
  flex: 1 1 auto;
  min-height: 0;
}




#toast-container {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 80;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast {
  min-width: 260px;
  max-width: 360px;
  background: #020617;
  border-radius: 10px;
  border: 1px solid #22c55e;
  box-shadow: 0 18px 40px rgba(22, 163, 74, 0.4);
  padding: 10px 12px;
  font-size: 0.86rem;
  color: #e5e7eb;
  display: flex;
  align-items: flex-start;
  gap: 8px;
}

.toast-error {
  border-color: var(--sem-error, #ef4444);
  box-shadow: 0 18px 40px rgba(239, 68, 68, 0.4);
}

.toast-icon {
  font-size: 1.1rem;
  margin-top: 1px;
}

.toast-message {
  flex: 1;
}


/* Global auto-restart toggle in header */
.global-toggle-row {
  margin-top: 8px;
  display: flex;
  justify-content: flex-end;
  align-items: flex-start;
}

/* Справа: чекбокс авто‑перезапуска + бейдж "Загружено ...
.fm-help-body{
  font-size: 0.95rem;
  line-height: 1.35;
}
.fm-help-body h3{
  margin: 14px 0 6px 0;
  font-size: 1rem;
}
.fm-help-body ul{
  margin: 6px 0 0 18px;
}
.fm-help-body li{
  margin: 4px 0;
}
" строго под ним */
.global-toggle-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
}

.global-autorestart-toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: calc(12px * var(--xk-font-scale));
  color: #9ca3af;
  user-select: none;
}

.global-autorestart-toggle input[type="checkbox"] {
  width: 14px;
  height: 14px;
  cursor: pointer;
}

.global-autorestart-toggle span {
  cursor: pointer;
}


.xkeen-ctrl-row {
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 12px;
  flex-wrap: wrap;
}




/* Бейдж справа: под чекбоксом и выровнен по правому краю */
.global-toggle-right .last-load-badge {
  margin-left: 0;
  align-self: flex-end;
}
.xkeen-ctrl-group {
  display: inline-flex;
  gap: 4px;
}

/* Бейдж «Загружено ...
.fm-help-body{
  font-size: 0.95rem;
  line-height: 1.35;
}
.fm-help-body h3{
  margin: 14px 0 6px 0;
  font-size: 1rem;
}
.fm-help-body ul{
  margin: 6px 0 0 18px;
}
.fm-help-body li{
  margin: 4px 0;
}
.xkeen-ctrl-row .last-load-badge {
  margin-left: 0;
}

.xkeen-ctrl-btn {
  padding: 3px 10px;
  font-size: calc(11px * var(--xk-font-scale));
  border-radius: 9999px;
  border: 1px solid var(--border, #1f2937);
  background: var(--editor-btn-bg, #020617);
  color: var(--editor-btn-text, #e5e7eb);
  box-shadow: 0 2px 6px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.4) + 0.3));
  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

/* DevTools: make Start/Stop/Restart compact and match Refresh button typography */
.actions button.dt-ui-action {
  flex: 0 0 auto;
  white-space: nowrap;
  min-width: 92px;
  padding: 6px 14px;
  font-size: calc(14px * var(--xk-font-scale));
}

/* DevTools (Tools tab): keep Start/Stop/Restart on a single row */
.dt-service-actions {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.dt-service-actions button.dt-ui-action {
  width: 100%;
  min-width: 0;
  padding: 6px 10px;
  font-size: calc(13px * var(--xk-font-scale));
}

.dt-service-actions-secondary {
  margin-top: 8px;
  display: flex;
}

.dt-service-actions-secondary button {
  width: 100%;
}

/* DevTools: logging block (pill style, single column) */
.dt-logging-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.dt-logging-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.dt-logging-label {
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.1;
  opacity: 0.88;
}

.dt-pill-field {
  width: 100%;
  min-width: 0;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  box-sizing: border-box;
}

.dt-pill-field:focus {
  outline: none;
  border-color: rgba(37, 99, 235, 0.9);
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
}

.dt-logging-card .dt-logging-switch {
  align-self: flex-start;
}

.dt-logging-actions {
  margin-top: 10px;
  display: flex;
}

.dt-logging-actions button {
  width: 100%;
}



/* DevTools: theme editor */
.dt-theme-target {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin: 6px 0 12px;
}

.dt-theme-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

@media (max-width: 760px) {
  .dt-theme-grid { grid-template-columns: 1fr; }
}

.dt-theme-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  /* Allow shrink inside CSS grid to prevent slider overflow */
  min-width: 0;
}

.dt-theme-name {
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.1;
  opacity: 0.88;
}

.dt-theme-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

.dt-theme-alpha {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 6px;
  width: 100%;
  min-width: 0;
}

.dt-theme-alpha-name {
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  /* Fixed-ish label width keeps rows compact */
  flex: 0 0 64px;
  min-width: 0;
}

.dt-theme-alpha input[type="range"] {
  flex: 1 1 0;
  min-width: 0;
  height: 6px;
}

.dt-theme-alpha-val {
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--muted, #9ca3af);
  flex: 0 0 44px;
  min-width: 0;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* Narrow cards: stack opacity controls into two rows (label+value, then slider) */
@media (max-width: 520px) {
  .dt-theme-alpha {
    display: grid;
    grid-template-columns: 1fr 56px;
    grid-template-areas:
      "name val"
      "range range";
    gap: 6px 10px;
    align-items: center;
  }
  .dt-theme-alpha-name { grid-area: name; }
  .dt-theme-alpha input[type="range"] { grid-area: range; }
  .dt-theme-alpha-val {
    grid-area: val;
    justify-self: end;
  }
}

.dt-theme-color {
  width: 44px;
  height: 34px;
  border-radius: 10px;
  border: 1px solid #374151;
  background: transparent;
  padding: 0;
}

.dt-theme-color::-webkit-color-swatch-wrapper {
  padding: 0;
  border-radius: 10px;
}

.dt-theme-color::-webkit-color-swatch {
  border: none;
  border-radius: 9px;
}

.dt-theme-sliders {
  margin-top: 12px;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

@media (max-width: 760px) {
  .dt-theme-sliders { grid-template-columns: 1fr; }
}

.dt-theme-slider {
  display: flex;
  align-items: center;
  gap: 10px;
}

.dt-theme-slider-name {
  width: 86px;
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.88;
}

.dt-theme-slider input[type="range"] {
  flex: 1 1 auto;
}

.dt-theme-slider-val {
  width: 64px;
  text-align: right;
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.85;
  font-variant-numeric: tabular-nums;
}
/* DevTools: toolbars shouldn't force buttons to stretch full width */
.actions.dt-log-toolbar button {
  flex: 0 0 auto;
  white-space: nowrap;
}

/* DevTools Logs: line actions (Stage 8) */
.dt-log-line-menu {
  position: fixed;
  z-index: 65;
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 8px;
  border-radius: 12px;
  border: 1px solid var(--border, #334155);
  background: var(--card-bg, #020617);
  box-shadow: 0 18px 50px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.4) + 0.4));
}

.dt-log-line-menu.hidden {
  display: none;
}

.dt-log-line-menu button {
  width: 100%;
  text-align: left;
}

.dt-log-context-focus {
  background: color-mix(in srgb, var(--accent, #60a5fa) 16%, transparent);
  border-left: 3px solid var(--accent, #2563eb);
  padding-left: 8px;
}


/* DevTools Logs: tail -f controls (Stage 3 scaffold) */
.dt-log-badge {
  flex: 0 0 auto;
  white-space: nowrap;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid var(--accent, #2563eb);
  background: color-mix(in srgb, var(--accent, #2563eb) 18%, transparent);
  color: var(--text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  cursor: pointer;
}

.dt-log-badge:hover {
  border-color: var(--accent, #60a5fa);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--accent, #2563eb) 22%, transparent);
}

#dt-log-pause.is-paused {
  border-color: var(--sem-warning, #f59e0b);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--sem-warning, #f59e0b) 22%, transparent);
}
/* DevTools: ENV table should use most of the viewport */
.dt-env-scroll {
  overflow: auto;
  max-height: calc(100vh - 260px);
}

/* DevTools: ENV editor inputs should look consistent in dark theme */
.dt-env-input {
  width: 100%;
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  box-sizing: border-box;
  font-size: calc(13px * var(--xk-font-scale));
}

.dt-env-input:focus {
  outline: none;
  border-color: #60a5fa;
  box-shadow: 0 0 0 1px #1d4ed8;
}
.xkeen-ctrl-btn.loading {
  position: relative;
  color: var(--muted, #9ca3af);
  cursor: wait;
}

.xkeen-ctrl-btn.loading::after {
  content: '';
  position: absolute;
  right: 10px;
  top: 50%;
  width: 14px;
  height: 14px;
  margin-top: -7px;
  border-radius: 999px;
  border: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 60%, transparent);
  border-top-color: var(--text, #e5e7eb);
  animation: xkeen-spinner 0.8s linear infinite;
}

@keyframes xkeen-spinner {
  from { transform: translateY(-50%) rotate(0deg); }
  to   { transform: translateY(-50%) rotate(360deg); }
}


@keyframes xkeen-global-spinner {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
.xkeen-ctrl-btn.loading {
  position: relative;
  color: var(--muted, #9ca3af);
  cursor: wait;
}

.xkeen-ctrl-btn.loading::after {
  content: '';
  position: absolute;
  right: 10px;
  top: 50%;
  width: 14px;
  height: 14px;
  margin-top: -7px;
  border-radius: 999px;
  border: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 60%, transparent);
  border-top-color: var(--text, #e5e7eb);
  animation: xkeen-spinner 0.8s linear infinite;
}

@keyframes xkeen-spinner {
  from { transform: translateY(-50%) rotate(0deg); }
  to   { transform: translateY(-50%) rotate(360deg); }
}


.xkeen-ctrl-btn:hover {
  background: linear-gradient(135deg, var(--editor-btn-active-from, #1d4ed8), var(--editor-btn-active-to, #2563eb));
  border-color: var(--editor-btn-active-to, #2563eb);
  box-shadow: 0 4px 12px color-mix(in srgb, var(--editor-btn-active-to, #2563eb) 45%, transparent);
  transform: translateY(-1px);
}

.xkeen-ctrl-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 2px 6px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.4) + 0.3));
}



textarea#json-editor-textarea {
  width: 100%;
  min-height: 260px;
  max-height: 60vh;
  height: 260px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: calc(14px * var(--xk-font-scale));
  padding: 8px;
  border-radius: 8px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb); /* как в редакторе 05_routing */
  resize: none; /* избегаем артефактов при сильном растягивании */
  box-sizing: border-box;
  overflow-y: auto;
}



#routing-help-line {
  cursor: pointer;
  display: inline-block;
  margin-top: -4px;
  margin-bottom: 2px;
}



#routing-help-line:hover {
  animation: routing-help-blink 1s infinite;
}

@keyframes routing-help-blink {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}


#mihomo-profiles-link {
  cursor: pointer;
  display: inline-block;
  margin-top: -4px;
  margin-bottom: 4px;
  font-size: calc(14px * var(--xk-font-scale));
}

#mihomo-profiles-link:hover {
  animation: routing-help-blink 1s infinite;
}
/* Custom tooltip for XKeen commands */
.command-item::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(100% + 6px);
  padding: 6px 8px;
  border-radius: 8px;
  background: rgba(15, 23, 42, 0.98);
  color: #e5e7eb;
  font-size: calc(11px * var(--xk-font-scale));
  line-height: 1.3;
  white-space: normal;
  max-width: 260px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.45);
  opacity: 0;
  pointer-events: none;
  z-index: 40;
}

.command-item::before {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 100%;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent rgba(15, 23, 42, 0.98) transparent;
  opacity: 0;
  pointer-events: none;
  z-index: 39;
}

.command-item:hover::after,
.command-item:hover::before {
  opacity: 1;
}



/* --- Mihomo generator layout --- */
.xkeen-input {
  width: 100%;
  padding: 6px 8px;
  margin: 4px 0 8px;
  border-radius: 8px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  box-sizing: border-box;
  font-size: calc(14px * var(--xk-font-scale));
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.xkeen-input:focus {
  outline: none;
  border-color: #60a5fa;
  box-shadow: 0 0 0 1px #1d4ed8;
}

.small-textarea {
  min-height: 120px;
}

.mihomo-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-top: 12px;
}

.mihomo-column {
  flex: 1 1 260px;
  min-width: 260px;
}

.xkeen-table {
  width: 100%;
  border-collapse: collapse;
  font-size: calc(14px * var(--xk-font-scale));
  margin-top: 8px;
}

.xkeen-table th,
.xkeen-table td {
  padding: 6px 8px;
  border-bottom: 1px solid #1f2933;
  text-align: left;
}

.xkeen-table th {
  font-weight: 600;
  color: #d1d5db;
}

.xkeen-table tbody tr:hover {
  background: #020617;
}


/* Xray log filter row */
.log-filter-row {
  margin: 8px 0 10px;
  display: flex;
  align-items: stretch;
  gap: 0;
  flex-wrap: nowrap;
}

.log-filter-row .xray-log-filter {
  flex: 1;
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  box-shadow: none;
}

.log-filter-row .xray-log-filter:focus{
  /* Keep focus ring even though base shadow is removed for the joined group */
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent, #60a5fa) 22%, transparent);
}

.log-filter-row #xray-log-filter-clear{
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  padding: 7px 12px;
  min-width: 44px;
  line-height: 1;
  box-shadow: none;
  transform: none;
  border-left: 0;
}

.log-filter-row #xray-log-filter-clear:hover,
.log-filter-row #xray-log-filter-clear:active{
  transform: none;
  box-shadow: none;
}

/* Keep filter row usable on narrow screens */
@media (max-width: 560px){
  .log-filter-row{ flex-wrap: wrap; gap: 8px; }
  .log-filter-row .xray-log-filter{
    border-radius: 9999px;
    box-shadow: 0 4px 10px rgba(15, 23, 42, 0.40);
  }
  .log-filter-row #xray-log-filter-clear{
    border-radius: 9999px;
    border-left: 1px solid var(--editor-btn-border, rgba(51,65,85,0.9));
  }
}


/* DevTools Logs: compact topbar + controls (short panel) */
.dt-log-topbar{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
  margin: 4px 0 8px 0;
}

.dt-log-topbar-actions{
  display:flex;
  align-items:center;
  gap: 8px;
  flex-wrap: wrap;
}

/* DevTools Logs: make secondary buttons match compact pill controls */
.dt-log-btn{
  padding: 6px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  border-radius: 9999px;
}

.dt-log-menu{
  position: relative;
}

.dt-log-menu > summary{
  list-style: none;
}

.dt-log-menu > summary::-webkit-details-marker{ display:none; }

.dt-log-menu[open] > summary{
  border-color: #2563eb;
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.18);
}

.dt-log-menu-panel{
  position: absolute;
  right: 0;
  top: calc(100% + 8px);
  min-width: 240px;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid var(--border, #334155);
  background: var(--card-bg, #020617);
  box-shadow: 0 18px 50px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.4) + 0.4));
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 60;
}


/* Xray logs: per-line context menu (right click) */
.xray-line-menu{
  position: fixed;
  right: auto;
  top: auto;
  min-width: 200px;
  z-index: 80;
}

.dt-log-menu-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
}

.dt-log-lines-input{
  width: 92px;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid var(--border, #374151);
  background: var(--header-btn-bg, #020617);
  color: var(--header-btn-text, #e5e7eb);
  font-size: calc(12px * var(--xk-font-scale));
  box-sizing: border-box;
}

.dt-log-lines-input:focus{
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 1px #3b82f6;
}

.dt-log-controls{
  margin: 8px 0;
  display:flex;
  align-items:center;
  gap: 8px;
  flex-wrap: wrap;
}

.dt-log-search-group{
  flex: 1 1 360px;
  min-width: 240px;
  display:flex;
  align-items:center;
  gap: 8px;
}

.dt-log-filter{
  flex: 1 1 auto;
}

.dt-log-interval{
  display:inline-flex;
  align-items:center;
  gap: 8px;
}

.dt-log-interval-label{
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.85;
}

/* Small switch-like pill (used in DevTools Logs controls) */
.dt-switch{
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  padding: 6px 8px;
  border-radius: 9999px;
  border: 1px solid var(--border, rgba(51,65,85,0.55));
  background: var(--fm-row-hover-bg, color-mix(in srgb, var(--card-bg, #020617) 85%, transparent));
}

.dt-switch:hover{ background: color-mix(in srgb, var(--card-bg, #020617) 75%, transparent); }

.dt-switch input{
  position: absolute;
  opacity: 0;
  width: 1px;
  height: 1px;
}

.dt-switch-slider{
  width: 34px;
  height: 18px;
  border-radius: 999px;
  background: color-mix(in srgb, var(--border, #334155) 75%, transparent);
  border: 1px solid var(--fm-panel-border, var(--border, rgba(51,65,85,0.85)));
  position: relative;
  flex: 0 0 auto;
}

.dt-switch-slider::after{
  content: "";
  position: absolute;
  top: 1px;
  left: 1px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--text, rgba(226,232,240,0.92));
  transition: transform 0.15s ease;
}

.dt-switch input:checked + .dt-switch-slider{
  background: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 45%, transparent);
  border-color: var(--header-tab-active-bg, #2563eb);
}

.dt-switch input:checked + .dt-switch-slider::after{ transform: translateX(16px); }

.dt-switch-label{ opacity: 0.85; }

.dt-log-stats{
  margin-left: auto;
  white-space: nowrap;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid var(--border, rgba(51,65,85,0.55));
  background: color-mix(in srgb, var(--card-bg, #020617) 85%, transparent);
  opacity: 0.92;
}

.dt-log-stats:empty{ display:none; }


/* Generic small round icon-only buttons (used for Mihomo profiles/backups controls) */
button.icon-btn {
  padding-inline: 10px;
  min-width: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}


/* Backup filename marquee to prevent layout breaking */
.backup-filename-marquee {
  max-width: 220px;
  overflow: hidden;
  position: relative;
  white-space: nowrap;
}

.backup-filename-marquee-inner {
  display: inline-block;
  padding-left: 100%;
  animation: backup-filename-scroll 12s linear infinite;
}

.backup-filename-marquee:hover .backup-filename-marquee-inner {
  animation-play-state: paused;
}

@keyframes backup-filename-scroll {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}


/* Global XKeen overlay spinner */
#global-xkeen-spinner {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.65);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#global-xkeen-spinner.is-active {
  display: flex;
}

.global-spinner-box {
  min-width: 260px;
  max-width: 320px;
  padding: 16px 20px;
  background: #020617;
  border-radius: 12px;
  border: 1px solid #1f2937;
  box-shadow: 0 18px 38px rgba(15, 23, 42, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.global-spinner-icon {
  display: inline-block;
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  border-radius: 999px;
  border: 2px solid rgba(34, 197, 94, 0.35);
  border-top-color: #22c55e;
  animation: xkeen-global-spinner 0.8s linear infinite;
}

.global-spinner-text {
  font-size: calc(14px * var(--xk-font-scale));
  color: #e5e7eb;
  text-align: center;
}



.modal-body-logs {
  font-family: monospace;
  font-size: calc(12px * var(--xk-font-scale));
}

.log-line {
  line-height: 1.35;
  white-space: pre-wrap;
}
.log-info {
  color: #60a5fa;
}
.log-warn {
  color: #facc15;
}
.log-error {
  color: var(--sem-error, #f87171);
}
.log-fatal {
  color: #fb7185;
  font-weight: 600;
}
.log-debug {
  color: #9ca3af;
}

/* Дополнительная подсветка для Live Xray logs */
.log-route {
  font-weight: 500;
}

.log-route-tproxy-vless {
  color: var(--log-route-tproxy-vless, #22c55e); /* tproxy -> vless-reality */
}

.log-route-redirect-vless {
  color: var(--log-route-redirect-vless, #38bdf8); /* redirect -> vless-reality */
}

.log-route-redirect-direct {
  color: var(--log-route-redirect-direct, #a855f7); /* redirect -> direct */
}

.log-route-reject {
  color: var(--log-route-reject, #f97373); /* reject */
  font-weight: 600;
}


.log-ts {
  color: var(--log-ts, #94a3b8); /* timestamp */
}

.log-link {
  cursor: pointer;
  text-decoration: underline dotted;
  text-underline-offset: 2px;
  border-radius: 3px;
  padding: 0 1px;
}

.log-link:visited {
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
}

html[data-theme="dark"] .log-link:hover {
  text-decoration: underline;
  background: rgba(255, 255, 255, 0.06);
}

html[data-theme="light"] .log-link:hover {
  text-decoration: underline;
  background: rgba(0, 0, 0, 0.05);
}


.log-ip {
  color: var(--log-ip, #fde68a); /* IP */
}

.log-domain {
  color: var(--log-domain, #6ee7b7); /* domain */
}

.log-proto {
  color: var(--log-proto, #7dd3fc); /* protocol/transport */
  font-weight: 500;
}

.log-port {
  color: var(--log-port, #fb923c); /* port */
  font-weight: 500;
}

.log-uuid {
  color: var(--log-uuid, #f472b6); /* uuid/id */
}

.log-email {
  color: var(--log-email, #22d3ee); /* email */
}

.log-inbound {
  color: var(--log-inbound, #818cf8); /* inbound tag */
}

.log-outbound {
  color: var(--log-outbound, #f0abfc); /* outbound tag */
}

.log-method {
  color: var(--log-method, #fbbf24); /* HTTP method */
  font-weight: 600;
}

.log-path {
  color: var(--log-path, #bef264); /* path/uri/url */
}

.log-sni {
  color: var(--log-sni, #5eead4); /* sni/serverName */
}

.log-alpn {
  color: var(--log-alpn, #93c5fd); /* alpn */
}

/* === Темы: тёмная / светлая === */

html[data-theme="dark"] {
  color-scheme: dark;
}

html[data-theme="light"] {
  color-scheme: light;
}

/* Плавающая кнопка переключения темы (видна на всех страницах) */
.theme-toggle-floating {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 1000;
}

.theme-toggle-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 9999px;
  padding: 4px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  border: 1px solid transparent;
  background: transparent;
  cursor: pointer;
}

/* Стиль кнопки в тёмной теме */
html[data-theme="dark"] .theme-toggle-btn {
  background: rgba(15, 23, 42, 0.9);
  border-color: #1f2937;
  color: #e5e7eb;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
}

/* Стиль кнопки в светлой теме в духе macOS */
html[data-theme="light"] .theme-toggle-btn {
  background: rgba(255, 255, 255, 0.8);
  border-color: #d1d5db;
  color: #111827;
  backdrop-filter: blur(12px);
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
}

.theme-toggle-btn:hover {
  transform: translateY(-1px);
}

.theme-toggle-btn:active {
  transform: translateY(0);
}

.theme-toggle-icon {
  font-size: calc(14px * var(--xk-font-scale));
}

/* === Светлая тема (маковские оттенки) === */

html[data-theme="light"] body {
  background: #f5f5f7;
  color: #111827;
}

/* Ссылки — синий оттенок как в macOS */
html[data-theme="light"] a {
  color: #0a84ff;
}

html[data-theme="light"] a:hover {
  text-decoration: underline;
}

/* Карточки / панели */
html[data-theme="light"] .card {
  background: #ffffff;
  border-color: #d1d5db;
  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
}

/* Таблицы */
html[data-theme="light"] table {
  background: #ffffff;
}

html[data-theme="light"] th {
  background: #f3f4f6;
  border-bottom-color: #e5e7eb;
}

html[data-theme="light"] td {
  border-bottom-color: #e5e7eb;
}

/* Базовые кнопки */
html[data-theme="light"] button {
  background: var(--editor-btn-bg, #ffffff);
  border-color: var(--editor-btn-border, #d1d5db);
  color: var(--editor-btn-text, #111827);
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] button:disabled {
  background: #e5e7eb;
  color: #9ca3af;
}

/* Поля ввода и текстовые области */
html[data-theme="light"] input,
html[data-theme="light"] select,
html[data-theme="light"] textarea,
html[data-theme="light"] .xkeen-textarea {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

/* Лампочка статуса */
html[data-theme="light"] .service-status-lamp[data-state="running"] {
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.4);
}

html[data-theme="light"] .service-status-lamp[data-state="stopped"],
html[data-theme="light"] .service-status-lamp[data-state="error"] {
  box-shadow: 0 0 6px rgba(248, 113, 113, 0.4);
}

/* Модальные окна */
html[data-theme="light"] .modal {
  background: #ffffff;
  border-color: #d1d5db;
}

/* === Дополнительные правки светлой темы: более тёмный текст и светлый редактор === */

/* Чуть более контрастный «вторичный» текст */
html[data-theme="light"] .card p,
html[data-theme="light"] .hint,
html[data-theme="light"] .edit-toggle,
html[data-theme="light"] .command-item-desc {
  color: #4b5563;
}

/* YAML-просмотр и CodeMirror в светлой теме */
html[data-theme="light"] .xkeen-textarea,
html[data-theme="light"] .CodeMirror {
  background: #f9fafb;
  color: #111827;
  border-color: #d1d5db;
  box-shadow: 0 1px 0 rgba(15, 23, 42, 0.03);
}

/* Сделать тему material-darker светлой, когда включена светлая тема панели */
html[data-theme="light"] .cm-s-material-darker.CodeMirror {
  background: #f9fafb;
  color: #111827;
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-gutters {
  background: #f3f4f6;
  border-right: 1px solid #e5e7eb;
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-cursor {
  border-left: 1px solid #111827;
}

/* Нейтральные цвета подсветки для YAML */
html[data-theme="light"] .cm-s-material-darker .cm-comment {
  color: #6b7280;
}

html[data-theme="light"] .cm-s-material-darker .cm-keyword {
  color: #7c3aed;
}

html[data-theme="light"] .cm-s-material-darker .cm-atom,
html[data-theme="light"] .cm-s-material-darker .cm-number,
html[data-theme="light"] .cm-s-material-darker .cm-variable-2,
html[data-theme="light"] .cm-s-material-darker .cm-variable-3,
html[data-theme="light"] .cm-s-material-darker .cm-tag,
html[data-theme="light"] .cm-s-material-darker .cm-attribute,
html[data-theme="light"] .cm-s-material-darker .cm-qualifier {
  /* Более тёмный и контрастный зелёный для YAML-маркеров (*, & и т.п.) */
  color: #047857;
}

html[data-theme="light"] .cm-s-material-darker .cm-string {
  color: #b91c1c;
}

html[data-theme="light"] .cm-s-material-darker .cm-def,
html[data-theme="light"] .cm-s-material-darker .cm-property,
html[data-theme="light"] .cm-s-material-darker .cm-variable {
  color: #1f2937;
}

/* Выделение текста в редакторе на светлой теме */
html[data-theme="light"] .cm-s-material-darker .CodeMirror-selected,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line::selection,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line > span::selection,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line > span > span::selection {
  background: rgba(148, 163, 184, 0.35) !important;
}

/* Light theme: softer selection (avoid "dirty" dark blocks) */
html[data-theme="light"] .xkeen-cm .CodeMirror-selected,
html[data-theme="light"] .xkeen-cm .CodeMirror-line::selection,
html[data-theme="light"] .xkeen-cm .CodeMirror-line > span::selection,
html[data-theme="light"] .xkeen-cm .CodeMirror-line > span > span::selection {
  background: rgba(10, 132, 255, 0.22) !important;
}
html[data-theme="light"] .xkeen-cm ::selection {
  background: rgba(10, 132, 255, 0.22) !important;
}


/* Светлая тема: make CodeMirror cosmetics clearly visible */
html[data-theme="light"] .cm-s-material-darker .cm-matchhighlight,
html[data-theme="light"] .xkeen-cm .cm-matchhighlight {
  background: rgba(59, 130, 246, 0.14);
}

html[data-theme="light"] .cm-s-material-darker .cm-trailingspace,
html[data-theme="light"] .xkeen-cm .cm-trailingspace {
  background: rgba(220, 38, 38, 0.16);
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-ruler,
html[data-theme="light"] .xkeen-cm .CodeMirror-ruler {
  border-left-color: rgba(17, 24, 39, 0.12);
}


/* === Светлая тема: читаемые «Команды» и модальные окна === */

/* Заголовок и группы команд в светлой теме */
html[data-theme="light"] .commands-header h2 {
  color: #111827;
}

html[data-theme="light"] .command-group-title {
  color: #6b7280;
}

/* Плашки команд в светлой теме */
html[data-theme="light"] .command-item {
  /* Inherit pill-button look like Start/Stop/Restart (via base button + xkeen-ctrl-btn vars). */
  background: var(--editor-btn-bg, #ffffff);
  border-color: var(--editor-btn-border, #d1d5db);
  color: var(--editor-btn-text, #111827);
}

html[data-theme="light"] .command-item-code code {
  color: #374151;
}

html[data-theme="light"] .command-item-desc {
  color: #4b5563;
}

/* Do not override hover here: .xkeen-ctrl-btn:hover provides the unified hover style. */

/* Модальные окна в светлой теме */
html[data-theme="light"] .modal {
  background: rgba(15, 23, 42, 0.35);
}

html[data-theme="light"] .modal-content {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
  box-shadow: 0 20px 45px rgba(15, 23, 42, 0.18);
}

html[data-theme="light"] .modal-header {
  border-bottom-color: #e5e7eb;
}

html[data-theme="light"] .modal-close {
  color: #6b7280;
}

html[data-theme="light"] .modal-close:hover {
  color: #111827;
}

html[data-theme="light"] .modal-body-logs {
  background: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  color: #111827;
}


/* Light theme: make CodeMirror scroll area background light */
html[data-theme="light"] .CodeMirror-scroll {
  background-color: #f9fafb;
}


/* === Светлая тема: логи и JSON-редактор === */

/* Live логи Xray, перезапуск и нижний журнал */
html[data-theme="light"] .log-block {
  background: #f9fafb;
  color: #111827;
  border-color: #e5e7eb;
}

/* Log level colors are controlled via semantic vars (--sem-*) */

/* Терминал (нижний журнал в разделе Команды) */
html[data-theme="light"] .terminal-output {
  background: var(--card-bg, #f9fafb);
  color: var(--text, #111827);
  border-color: var(--border, #e5e7eb);
}


/* Поля фильтра / выбора в блоке Live логи Xray */
html[data-theme="light"] .xray-log-filter,
html[data-theme="light"] .xray-log-select {
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
  border-color: var(--border, #d1d5db);
}


/* DevTools logging: pill fields in light theme */
html[data-theme="light"] .dt-pill-field {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

/* DevTools theme editor */
html[data-theme="light"] .dt-theme-color {
  border-color: #d1d5db;
}

/* DevTools Logs: compact controls in light theme */
html[data-theme="light"] .dt-log-menu-panel{
  background: var(--card-bg, #ffffff);
  border-color: var(--border, #d1d5db);
  box-shadow: 0 18px 50px rgba(17, 24, 39, 0.12);
}


html[data-theme="light"] .dt-log-lines-input{
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
  border-color: var(--border, #d1d5db);
}


html[data-theme="light"] .dt-switch,
html[data-theme="light"] .dt-log-interval,
html[data-theme="light"] .dt-log-stats{
  background: color-mix(in srgb, var(--card-bg, #ffffff) 92%, transparent);
  border-color: var(--border, #d1d5db);
  color: var(--text, #111827);
}


html[data-theme="light"] .dt-switch-slider{
  background: color-mix(in srgb, var(--border, #e5e7eb) 85%, transparent);
  border-color: var(--border, #d1d5db);
}


html[data-theme="light"] .dt-switch-slider::after{
  background: var(--card-bg, #ffffff);
  box-shadow: 0 1px 3px rgba(17, 24, 39, 0.12);
}


html[data-theme="light"] .dt-switch input:checked + .dt-switch-slider{
  background: var(--fm-row-selected-bg, color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 18%, transparent));
  border-color: var(--header-tab-active-bg, #2563eb);
}


/* Stage 5: Include/Exclude token fields in light theme */
html[data-theme="light"] .dt-token-field {
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
  border-color: var(--border, #d1d5db);
}


html[data-theme="light"] .dt-token-entry {
  color: var(--text, #111827);
}


html[data-theme="light"] .dt-token-chip {
  background: color-mix(in srgb, var(--card-bg, #ffffff) 90%, transparent);
  border-color: var(--border, #e5e7eb);
  color: var(--text, #111827);
}


html[data-theme="light"] .dt-token-chip .dt-token-x {
  color: var(--muted, #6b7280);
}


/* Модальный JSON-редактор 03_inbounds.json / 04_outbounds.json */
html[data-theme="light"] #json-editor-textarea {
  background: #f9fafb;
  color: #111827;
  border-color: #d1d5db;
}

/* Светлая тема: мини-терминал в разделе Команды */
html[data-theme="light"] .terminal-window {
  background: var(--modal-bg, #ffffff);
  border-color: var(--modal-border, #e5e7eb);
  box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
}


html[data-theme="light"] .terminal-command {
  background: var(--card-bg, #f9fafb);
  color: var(--text, #111827);
  border-color: var(--border, #e5e7eb);
}


html[data-theme="light"] .terminal-search-input {
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
  border-color: var(--border, #d1d5db);
}


html[data-theme="light"] .terminal-search-btn {
  background: var(--header-btn-bg, rgba(248, 250, 252, 0.9));
  color: var(--fm-btn-text, var(--header-btn-text, #111827));
  border-color: var(--header-btn-border, rgba(15, 23, 42, 0.16));
}


html[data-theme="light"] .terminal-search-btn:hover {
  background: var(--header-btn-hover-bg, rgba(226, 232, 240, 0.9));
}


html[data-theme="light"] .terminal-input {
  background: var(--card-bg, #ffffff);
  color: var(--text, #111827);
  border-color: var(--border, #d1d5db);
}


html[data-theme="light"] .terminal-tool-btn {
  background: var(--header-btn-bg, rgba(248, 250, 252, 0.9));
  color: var(--fm-btn-text, var(--header-btn-text, #111827));
  border-color: var(--header-btn-border, rgba(15, 23, 42, 0.16));
}


html[data-theme="light"] .terminal-tool-btn:hover {
  background: var(--header-btn-hover-bg, rgba(226, 232, 240, 0.9));
}


/* Светлая тема: режим работы inbounds */
html[data-theme="light"] .mode-item {
  background: #f9fafb;
  border-color: #e5e7eb;
}

html[data-theme="light"] .mode-item strong {
  color: #111827;
}

html[data-theme="light"] .mode-item small {
  color: #4b5563;
}

html[data-theme="light"] .toggle {
  color: #4b5563;
}

/* Светлая тема: VLESS URL (04_outbounds.json) */
html[data-theme="light"] #outbounds-url {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

html[data-theme="light"] .outbounds-parse-box {
  background: rgba(255, 255, 255, 0.9);
  border-color: #e5e7eb;
}

html[data-theme="light"] .outbounds-badge {
  background: rgba(255, 255, 255, 0.85);
  border-color: #e5e7eb;
  color: #111827;
}

html[data-theme="light"] .outbounds-kv-row {
  background: rgba(249, 250, 251, 0.95);
  border-color: #e5e7eb;
}

html[data-theme="light"] .outbounds-kv-row .k {
  color: #4b5563;
}

html[data-theme="light"] .outbounds-kv-row .v {
  color: #111827;
}


/* Светлая тема: кнопка переключения ядра и бейдж времени загрузки */
html[data-theme="light"] .service-core-text {
  background: rgba(255, 255, 255, 0.9);
  border-color: #d1d5db;
  color: #111827;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] .service-core-text.has-core {
  border-color: var(--accent, #0a84ff);
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent, #0a84ff) 40%, transparent);
  background: color-mix(in srgb, var(--accent, #0a84ff) 10%, var(--header-btn-bg, #ffffff) 90%);
}

html[data-theme="light"] .last-load-badge {
  background: color-mix(in srgb, var(--bg, #f5f5f7) 70%, var(--card-bg, #ffffff) 30%);
  border-color: var(--border, #d1d5db);
  color: var(--muted, #4b5563);
}

/* Светлая тема: ховер строк таблиц (в т.ч. профили/бэкапы Mihomo) */
html[data-theme="light"] tbody tr:hover {
  background: #f3f4f6;
}



/* Подсветка текущей строки в редакторах CodeMirror (как в современных IDE) */
.cm-s-material-darker .CodeMirror-activeline-background,
.xkeen-cm .CodeMirror-activeline-background {
  background: #111827;
}


/* Light theme: active line highlight must be light (avoid dark bars) */
html[data-theme="light"] .xkeen-cm .CodeMirror-activeline-background,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-activeline-background,
html[data-theme="light"] .cm-s-default .CodeMirror-activeline-background {
  background: rgba(15, 23, 42, 0.06);
}



/* Indent guides rendered via overlay (spaces & tabs at line start). */
.xkeen-cm .cm-indent-guide {
  position: relative;
}

.xkeen-cm .cm-indent-guide::before {
  content: "";
  position: absolute;
  left: 0;
  top: -2px;
  bottom: -2px;
  border-left: 1px solid rgba(55, 65, 81, 0.8);
  opacity: 0.9;
}
/* Вертикальные направляющие отступов (indent guides) для JSON/YAML редакторов */
.xkeen-cm .CodeMirror-code .cm-tab {
  position: relative;
}

.xkeen-cm .CodeMirror-code .cm-tab::before {
  content: "";
  position: absolute;
  left: 0;
  top: -2px;
  bottom: -2px;
  border-left: 1px solid rgba(55, 65, 81, 0.85);
  opacity: 0.7;
}


/* Light theme: indent guides should be subtle */
html[data-theme="light"] .xkeen-cm .cm-indent-guide::before,
html[data-theme="light"] .xkeen-cm .CodeMirror-code .cm-tab::before {
  border-left-color: rgba(17, 24, 39, 0.12);
  opacity: 0.7;
}





html[data-theme="light"] .terminal-uptime {
  color: var(--muted, #9ca3af);
}



/* Terminal: Xray logs mini-menu (runs tail -f inside PTY) */
.terminal-xraylogs-menu{
  position:absolute;
  top:34px;
  right:48px;
  z-index:85;
  background:#020617;
  border:1px solid #334155;
  border-radius:12px;
  padding:10px;
  box-shadow:0 18px 50px rgba(15,23,42,.8);
  display:flex;
  flex-direction:column;
  gap:8px;
  min-width:220px;
}
.terminal-xraylogs-menu.hidden{ display:none; }

/* Terminal: grouped menus (overflow / view / buffer) */
.terminal-overflow-menu{
  position:absolute;
  top:34px;
  right:8px;
  z-index:90;
  background:#020617;
  border:1px solid #334155;
  border-radius:12px;
  padding:10px;
  box-shadow:0 18px 50px rgba(15,23,42,.8);
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width:240px;
  max-width:340px;
  /* allow scrolling when the menu is taller than the terminal modal */
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  overscroll-behavior: contain;
}
.terminal-overflow-menu.hidden{ display:none; }

.terminal-menu-section{ display:flex; flex-direction:column; gap:6px; }
.terminal-menu-title{
  font-size: calc(11px * var(--xk-font-scale));
  color:#9ca3af;
  font-weight:700;
  letter-spacing:.02em;
  user-select:none;
  margin-bottom:2px;
}

/* Terminal: overflow menu collapsible sections */
.terminal-menu-section[data-collapsible="1"] > .terminal-menu-title{
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:4px 6px;
  border-radius:10px;
}
.terminal-menu-section[data-collapsible="1"] > .terminal-menu-title:hover{
  background: rgba(148,163,184,0.08);
  color:#cbd5e1;
}
.terminal-menu-section[data-collapsible="1"] > .terminal-menu-title:focus{
  outline:2px solid rgba(59,130,246,0.55);
  outline-offset:2px;
}
.terminal-menu-section[data-collapsible="1"] > .terminal-menu-title::after{
  content:"▾";
  font-size: calc(12px * var(--xk-font-scale));
  color:#94a3b8;
}
.terminal-menu-section[data-collapsible="1"].collapsed > .terminal-menu-title::after{
  content:"▸";
}
.terminal-menu-section[data-collapsible="1"].collapsed > :not(.terminal-menu-title){
  display:none;
}

.terminal-menu-title-inline{ margin-top:2px; }
.terminal-menu-sep{ height:1px; background:rgba(148,163,184,0.18); margin:2px 0; }

/* Menus anchored to footer groups */
.terminal-footer-group-view,
.terminal-footer-group-buffer{ position: relative; }

.terminal-view-menu,
.terminal-buffer-menu{
  position:absolute;
  bottom:34px;
  left:0;
  z-index:90;
  background:#020617;
  border:1px solid #334155;
  border-radius:12px;
  padding:10px;
  box-shadow:0 18px 50px rgba(15,23,42,.8);
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width:220px;
  max-width:320px;
  /* these menus can also grow depending on options */
  max-height: 60vh;
  overflow-y: auto;
  overscroll-behavior: contain;
}
.terminal-view-menu.hidden,
.terminal-buffer-menu.hidden{ display:none; }

/* Menu item look: reuse terminal-tool-btn but make it block-like inside menus */
.terminal-overflow-menu .terminal-tool-btn,
.terminal-view-menu .terminal-tool-btn,
.terminal-buffer-menu .terminal-tool-btn{
  width:100%;
  text-align:left;
  border-radius:10px;
  padding:8px 10px;
  display:flex;
  align-items:center;
  gap:8px;
  line-height:1.2;
}

/* Nested Xray menu is shown inline inside the overflow menu */
.terminal-overflow-menu .terminal-xraylogs-menu{
  position: static;
  top:auto;
  right:auto;
  z-index:auto;
  box-shadow:none;
  min-width: unset;
}


.terminal-xraylogs-row{ display:flex; align-items:center; gap:8px; }

/* Xray logs controls: keep them compact (icon buttons) */
.terminal-xraylogs-actions{ display:flex; gap:8px; justify-content:flex-start; }
.terminal-xraylogs-actions > button{ flex:0 0 auto; }

/*
  IMPORTANT:
  Inside .terminal-overflow-menu we style .terminal-tool-btn as full-width "menu items".
  Xray log buttons are *not* menu items; they must stay compact.
  Add a higher-specificity override so icon buttons don't stretch.
*/
.terminal-overflow-menu .terminal-xraylogs-actions .terminal-tool-btn{
  width:34px;
  height:28px;
  text-align:center;
  border-radius:9999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:0;
  padding:0; /* icon buttons manage their own sizing */
}

.terminal-xraylogs-iconbtn{
  width:34px;
  height:28px;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size: calc(13px * var(--xk-font-scale));
  line-height:1;
}

.terminal-signals-item{
  width:100%;
  text-align:left;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.04);
  color:inherit;
  cursor:pointer;
}
.terminal-signals-item:hover{
  background:rgba(255,255,255,.08);
}



/* Terminal: Quick commands menu (footer) */
.terminal-footer-group-commands{ position: relative; }

.terminal-commands-menu{
  position:absolute;
  bottom: 34px;
  right: 0;
  z-index: 90;
  background: var(--modal-bg, #020617);
  border: 1px solid var(--modal-border, #334155);
  border-radius:12px;
  padding:10px;
  box-shadow:0 18px 50px rgba(15,23,42,.8);
  min-width: 280px;
  max-width: 360px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.terminal-commands-menu.hidden{ display:none; }

.terminal-commands-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}

.terminal-commands-title{
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--text, #cbd5e1);
  font-weight: 700;
  user-select: none;
}

.terminal-commands-mode{ display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; }

.terminal-commands-mode-btn{
  padding:6px 10px;
  border-radius:9999px;
  border: 1px solid var(--border, rgba(255,255,255,.10));
  background: var(--header-btn-bg, rgba(255,255,255,.04));
  color:inherit;
  cursor:pointer;
  font-size: calc(12px * var(--xk-font-scale));
}
.terminal-commands-mode-btn:hover{ background: var(--header-btn-hover-bg, rgba(255,255,255,.08)); }
.terminal-commands-mode-btn.is-active{
  background: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 35%, transparent);
  border-color: var(--header-tab-active-bg, #2563eb);
}

.terminal-commands-list{
  display:flex;
  flex-direction:column;
  gap:6px;
  max-height: 260px;
  overflow:auto;
  padding-right: 2px;
}

.terminal-commands-item{
  width:100%;
  text-align:left;
  padding:8px 10px;
  border-radius:10px;
  border: 1px solid var(--border, rgba(255,255,255,.10));
  background: color-mix(in srgb, var(--card-bg, #020617) 92%, transparent);
  color:inherit;
  cursor:pointer;
}
.terminal-commands-item:hover{ background: color-mix(in srgb, var(--card-bg, #020617) 85%, transparent); }

.terminal-commands-item-label{
  display:block;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
}

.terminal-commands-item-desc{
  display:block;
  margin-top: 2px;
  font-size: calc(11px * var(--xk-font-scale));
  color: var(--muted, #94a3b8);
}

.terminal-commands-hint{
  font-size: calc(10px * var(--xk-font-scale));
  color: var(--muted, #94a3b8);
  opacity: .95;
}

html[data-theme="light"] .terminal-commands-menu{
  background: var(--modal-bg, #ffffff);
  border-color: var(--modal-border, rgba(15,23,42,.15));
  box-shadow:0 18px 50px rgba(15,23,42,.18);
}
html[data-theme="light"] .terminal-commands-title{ color: var(--text, #0f172a); }
html[data-theme="light"] .terminal-commands-mode-btn,
html[data-theme="light"] .terminal-commands-item{
  background: var(--header-btn-bg, rgba(15,23,42,.04));
  border-color: var(--border, rgba(15,23,42,.12));
  color: var(--text, #0f172a);
}
html[data-theme="light"] .terminal-commands-item:hover,
html[data-theme="light"] .terminal-commands-mode-btn:hover{
  background: var(--header-btn-hover-bg, rgba(15,23,42,.08));
}
html[data-theme="light"] .terminal-commands-item-desc,
html[data-theme="light"] .terminal-commands-hint{ color: var(--muted, #475569); }
html[data-theme="light"] .terminal-commands-mode-btn.is-active{
  background: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 14%, transparent);
  border-color: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 35%, transparent);
}
/* Optional semantic button helpers (used in SSH modal) */
.btn-secondary{
  background: var(--editor-btn-bg, rgba(255,255,255,0.04));
  border: 1px solid var(--editor-btn-border, rgba(51,65,85,0.9));
  color: var(--editor-btn-text, #e5e7eb);
}
.btn-primary{
  /* fallback */
  background: rgba(37,99,235,0.18);
  border: 1px solid rgba(37,99,235,0.55);
  /* prefer theme-aware */
  background: color-mix(in srgb, var(--editor-btn-active-to, #2563eb) 18%, transparent);
  border-color: color-mix(in srgb, var(--editor-btn-active-to, #2563eb) 55%, transparent);
  color: var(--editor-btn-text, #e5e7eb);
}

/* Small square/circle icon button (used in FM connect modal) */
.btn-icon{
  padding: 6px 10px;
  width: 34px;
  height: 34px;
  min-width: 34px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: calc(16px * var(--xk-font-scale));
  line-height: 1;
}


/* Legacy alias: keep .xk-tooltip as a marker (older markup).
   Actual tooltip rendering uses the global [data-tooltip] rules above. */
.xk-tooltip{
  position: relative;
}

/* Destructive action button (used in confirm modals) */
.btn-danger{
  border-color: rgba(248, 113, 113, 0.55);
  background: rgba(127, 29, 29, 0.40);
  color: #fecaca;
}
.btn-danger:hover{
  background: rgba(153, 27, 27, 0.55);
}
/* Keep danger buttons "danger" even in active state (override global button:active gradient). */
.btn-danger:active{
  background: rgba(153, 27, 27, 0.70);
  border-color: rgba(248, 113, 113, 0.75);
  box-shadow: 0 6px 16px rgba(239, 68, 68, 0.25);
  transform: translateY(1px) scale(0.99);
}

html[data-theme="light"] .btn-danger{
  border-color: rgba(239, 68, 68, 0.45);
  background: rgba(239, 68, 68, 0.10);
  color: #991b1b;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}
html[data-theme="light"] .btn-danger:hover{
  background: rgba(239, 68, 68, 0.16);
}
html[data-theme="light"] .btn-danger:active{
  background: rgba(239, 68, 68, 0.22);
  border-color: rgba(239, 68, 68, 0.55);
  box-shadow: 0 6px 16px rgba(239, 68, 68, 0.18);
}

/* Highlighted button for PTY terminal */
.btn-interactive-shell{
  background: rgba(249,115,22,0.24);
  border: 1px solid rgba(249,115,22,0.75);
  box-shadow: 0 0 0 2px rgba(249,115,22,0.12);
  color: #ffffff;
  font-weight: 600;
}
.btn-interactive-shell:hover{
  background: rgba(249,115,22,0.34);
}
html[data-theme="light"] .btn-interactive-shell{
  background: rgba(249,115,22,0.20);
  border-color: rgba(249,115,22,0.70);
  color: #0f172a;
  box-shadow: 0 0 0 2px rgba(249,115,22,0.10);
}
html[data-theme="light"] .btn-interactive-shell:hover{
  background: rgba(249,115,22,0.28);
}

/* SSH editor layout */
.ssh-form-grid{
  display: grid;
  grid-template-columns: 140px 1fr;
  gap: 10px 12px;
  align-items: center;
}
.ssh-form-grid label{
  opacity: 0.9;
  font-size: 0.95rem;
}
.ssh-form-grid input{
  width: 100%;
  box-sizing: border-box;
}

/* SSH profile row selection */
.github-config-row.is-selected{
  border: 1px solid rgba(56,189,248,0.85);
  box-shadow: 0 0 0 2px rgba(56,189,248,0.12);
}

/* Disabled button hint */
button:disabled{
  opacity: 0.5;
  cursor: not-allowed;
}

@media (max-width: 520px){
  .ssh-form-grid{
    grid-template-columns: 1fr;
  }
}


/* ----------------------------- File manager (two-panel) ----------------------------- */
.fm-card{
  padding: 14px;
  /* Keep a safe bottom area so footer buttons don't block the resize corners */
  padding-bottom: 34px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  /* Like the terminal window: allow user resize */
  resize: both;
  overflow: hidden;
  position: relative;
  /*
    Browser resize handle is only bottom-right.
    We add our own bottom-left handle (JS) that resizes from the left
    by widening the card and shifting it with a CSS variable.
  */
  --fm-shift-x: 0px;
  transform: translateX(var(--fm-shift-x));
  min-height: 420px;
  height: clamp(420px, 70vh, 760px);
  max-height: 90vh;
  max-width: 100%;
}

/*
  File manager has two panels with fixed/min column widths.
  In the default 960px container this can cause a horizontal scrollbar.

  On wide screens we expand the file manager card ~2cm on each side
  (≈ +4cm total) relative to the main container, without affecting the header.
*/
@media (min-width: 1120px){
  .fm-card{
    width: calc(100% + 4cm);
    margin-left: -2cm;
    margin-right: -2cm;
    max-width: none;
  }
}

.fm-card::after{
  /* bottom-right resize hint */
  content: "";
  position: absolute;
  right: 10px;
  bottom: 10px;
  width: 14px;
  height: 14px;
  border-right: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 35%, transparent);
  border-bottom: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 35%, transparent);
  pointer-events: none;
  border-radius: 2px;
}

.fm-card::before{
  /* bottom-left resize hint (visual; browser handle is still bottom-right) */
  content: "";
  position: absolute;
  left: 10px;
  bottom: 10px;
  width: 14px;
  height: 14px;
  border-left: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 22%, transparent);
  border-bottom: 2px solid color-mix(in srgb, var(--muted, #94a3b8) 22%, transparent);
  pointer-events: none;
  border-radius: 2px;
}

.fm-resize-handle-left{
  /* Actual draggable area for bottom-left resize (implemented in JS) */
  position: absolute;
  left: 6px;
  bottom: 6px;
  width: 22px;
  height: 22px;
  cursor: nesw-resize;
  z-index: 3;
  background: transparent;
  touch-action: none;
}

.fm-card.is-fullscreen{
  position: fixed !important;
  left: 8px !important;
  top: 8px !important;
  width: calc(100vw - 16px) !important;
  height: calc(100vh - 16px) !important;
  /* Reset the "wider-than-container" offsets used in normal mode */
  margin: 0 !important;
  max-width: none !important;
  max-height: none !important;
  resize: none !important;
  transform: none !important;
  --fm-shift-x: 0px !important;
  z-index: 45;
}

.fm-card.is-fullscreen .fm-resize-handle-left{
  display: none;
}

.fm-card.is-fullscreen::after,
.fm-card.is-fullscreen::before{
  display: none;
}

/* File manager: busy overlay (e.g., when opening a remote file via SFTP) */
.fm-busy-overlay{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 60;
  background: color-mix(in srgb, var(--card-bg, #020617) 55%, transparent);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  pointer-events: all;
}

.fm-card.fm-busy{
  /* Give immediate visual feedback even if overlay isn't visible for some reason */
  cursor: wait;
}

.fm-busy-box{
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid color-mix(in srgb, var(--border, #334155) 70%, transparent);
  background: color-mix(in srgb, var(--card-bg, #020617) 85%, transparent);
  box-shadow: 0 10px 30px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.4) + 0.25));
}

.fm-busy-text{
  font-size: calc(13px * var(--xk-font-scale));
  color: var(--text, #e5e7eb);
  opacity: 0.92;
  max-width: min(520px, 86vw);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.fm-busy-spinner{
  width: 22px;
  height: 22px;
  border-radius: 999px;
  border: 3px solid color-mix(in srgb, var(--muted, #94a3b8) 55%, transparent);
  border-top-color: var(--text, #e5e7eb);
  animation: xkeen-global-spinner 0.75s linear infinite;
  flex: 0 0 auto;
}
.fm-header{ display:flex; align-items:center; justify-content:space-between; gap: 12px; margin-bottom: 10px; }
.fm-header h2{ margin: 0; }
.fm-header-actions{ display:flex; gap: 8px; align-items:center; }

/* File manager buttons: allow separate theming */
.fm-card .btn-secondary{
  background: var(--fm-btn-bg, var(--editor-btn-bg, rgba(255,255,255,0.04)));
  border-color: var(--fm-btn-border, var(--editor-btn-border, rgba(51,65,85,0.9)));
  color: var(--fm-btn-text, var(--editor-btn-text, #e5e7eb));
}
.fm-card .btn-secondary:hover{
  background: var(--fm-btn-hover-bg, var(--editor-btn-hover-bg, rgba(255,255,255,0.06)));
  border-color: var(--fm-btn-hover-border, var(--editor-btn-hover-border, rgba(148,163,184,0.55)));
  color: var(--fm-btn-hover-text, var(--editor-btn-hover-text, #e5e7eb));
}
.fm-card .btn-secondary:active{
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--fm-btn-active-from, var(--editor-btn-active-from, #1d4ed8)) 40%, transparent),
    color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 45%, transparent)
  );
  border-color: color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 65%, transparent);
}


/* Small toggle (used for dotfiles) */
.fm-toggle{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  user-select: none;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1;
  padding: 6px 8px;
  border-radius: 10px;
  /* Use theme-aware button vars so the toggle is readable in both themes */
  color: var(--editor-btn-text, #e5e7eb);
  border: 1px solid var(--editor-btn-border, rgba(51,65,85,0.55));
  background: color-mix(in srgb, var(--editor-btn-bg, rgba(255,255,255,0.04)) 85%, transparent);
}
.fm-toggle:hover{ background: color-mix(in srgb, var(--editor-btn-bg, rgba(255,255,255,0.04)) 75%, transparent); }
.fm-toggle input{
  position: absolute;
  opacity: 0;
  width: 1px;
  height: 1px;
}
.fm-toggle-slider{
  width: 34px;
  height: 18px;
  border-radius: 999px;
  background: color-mix(in srgb, var(--editor-btn-border, rgba(51,65,85,0.85)) 75%, transparent);
  border: 1px solid var(--fm-btn-border, var(--editor-btn-border, rgba(51,65,85,0.85)));
  position: relative;
  flex: 0 0 auto;
}
.fm-toggle-slider::after{
  content: "";
  position: absolute;
  top: 1px;
  left: 1px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  /* Knob should stay "milky" in light theme, but still readable in dark */
  background: var(--fm-toggle-knob-bg, rgba(226,232,240,0.92));
  border: 1px solid var(--fm-toggle-knob-border, rgba(15,23,42,0.12));
  transition: transform 0.15s ease;
}
.fm-toggle input:checked + .fm-toggle-slider{
  background: color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 45%, transparent);
  border-color: var(--header-tab-active-bg, #2563eb);
}
.fm-toggle input:checked + .fm-toggle-slider::after{ transform: translateX(16px); }
.fm-toggle-label{ opacity: 0.85; }

.fm-two{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  flex: 1;
  min-height: 0;
}

.fm-panel{
  border: 1px solid var(--fm-panel-border, var(--border, rgba(51,65,85,0.85)));
  border-radius: 14px;
  overflow: hidden;
  background: var(--fm-panel-bg, color-mix(in srgb, var(--card-bg, #111827) 92%, transparent));
  display: flex;
  flex-direction: column;
  min-height: 0;
}
.fm-panel-active{
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent, #60a5fa) 22%, transparent);
}

.fm-panel-bar{
  display:flex;
  gap: 8px;
  align-items:center;
  padding: 8px;
  border-bottom: 1px solid var(--fm-panel-bar-border, var(--border, rgba(51,65,85,0.6)));
  background: var(--fm-panel-bar-bg, color-mix(in srgb, var(--card-bg, #020617) 72%, transparent));
}
/*
  File manager: make the target selector (L/R) and quick paths (📌) as compact as
  the refresh icon button next to them.

  These are native <select> elements, but we style them to look like small
  pill-shaped icon buttons.
*/
.fm-bookmarks-select,
.fm-target-select,
.fm-bookmarks-btn{
  /* Match <button> + .btn-secondary visual language */
  border-radius: 9999px;
  background: var(--fm-btn-bg, var(--header-btn-bg, rgba(255,255,255,0.04)));
  border: 1px solid var(--fm-btn-border, var(--header-btn-border, rgba(51,65,85,0.9)));
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
  box-shadow: 0 4px 10px color-mix(in srgb, var(--header-btn-border, #334155) 55%, transparent);
  color: var(--fm-btn-text, var(--header-btn-text, inherit));

  /* Compact sizing (icon-like) */
  height: 32px;
  padding: 6px 12px;
  line-height: 18px;

  /* Behave like a button */
  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;

  /* Hide native select arrow so it reads like an icon button */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: none;
  text-align: center;
  text-align-last: center;
}

/* Keep them really small: they only show a single glyph (L/R, 📌) */
.fm-target-select{
  width: 44px;
  min-width: 44px;
  max-width: 44px;
}
.fm-bookmarks-select{
  width: 52px;
  min-width: 52px;
  max-width: 52px;
}

.fm-bookmarks-select:hover,
.fm-target-select:hover,
.fm-bookmarks-btn:hover{
  background: var(--fm-btn-hover-bg, var(--header-btn-hover-bg, rgba(255,255,255,0.06)));
  border-color: var(--fm-btn-hover-border, var(--header-btn-hover-border, rgba(148,163,184,0.55)));
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
  transform: translateY(-1px);
}

.fm-bookmarks-select:active,
.fm-target-select:active,
.fm-bookmarks-btn:active{
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--fm-btn-active-from, var(--editor-btn-active-from, #1d4ed8)) 40%, transparent),
    color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 45%, transparent)
  );
  border-color: color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 65%, transparent);
  transform: translateY(1px) scale(0.99);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 25%, transparent);
}

.fm-bookmarks-select:focus,
.fm-target-select:focus,
.fm-bookmarks-btn:focus{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 22%, transparent),
    0 4px 10px rgba(15, 23, 42, 0.7);
}

/* Light theme: align with light buttons */
html[data-theme="light"] .fm-bookmarks-select,
html[data-theme="light"] .fm-target-select,
html[data-theme="light"] .fm-bookmarks-btn{
  background: var(--fm-btn-bg, var(--header-btn-bg, #ffffff));
  border-color: var(--fm-btn-border, var(--header-btn-border, #d1d5db));
  color: var(--fm-btn-text, var(--header-btn-text, #111827));
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}
html[data-theme="light"] .fm-bookmarks-select:hover,
html[data-theme="light"] .fm-target-select:hover,
html[data-theme="light"] .fm-bookmarks-btn:hover{
  border-color: var(--fm-btn-hover-border, var(--header-btn-hover-border, #9ca3af));
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.18);
  background: var(--fm-btn-hover-bg, var(--header-btn-hover-bg, #ffffff));
}
html[data-theme="light"] .fm-bookmarks-select:active,
html[data-theme="light"] .fm-target-select:active,
html[data-theme="light"] .fm-bookmarks-btn:active{
  background: color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 12%, transparent);
  border-color: color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 45%, transparent);
  box-shadow: 0 6px 16px color-mix(in srgb, var(--fm-btn-active-to, var(--editor-btn-active-to, #2563eb)) 18%, transparent);
}

/* Make native <select> dropdowns readable in dark theme (options are otherwise too pale on white popups) */
html:not([data-theme="light"]) .fm-bookmarks-select,
html:not([data-theme="light"]) .fm-target-select,
html:not([data-theme="light"]) .fm-bookmarks-btn{
  color-scheme: dark;
}
html:not([data-theme="light"]) .fm-bookmarks-select option,
html:not([data-theme="light"]) .fm-target-select option,
html:not([data-theme="light"]) .fm-bookmarks-select optgroup,
html:not([data-theme="light"]) .fm-target-select optgroup{
  background-color: rgba(2,6,23,0.98);
  color: rgba(226,232,240,0.98);
}

.fm-path-input{
  flex: 1;
  min-width: 80px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid var(--fm-input-border, var(--border, rgba(51,65,85,0.9)));
  background: var(--fm-input-bg, var(--card-bg, rgba(255,255,255,0.02)));
  color: inherit;
}


.fm-filter-wrap{
  display: flex;
  align-items: center;
  gap: 6px;
  /* Allow the filter block to shrink instead of being clipped */
  flex: 0 1 240px;
  min-width: 120px;
}

.fm-filter-input{
  flex: 1 1 auto;
  width: auto;
  min-width: 0;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid var(--fm-input-border, var(--border, rgba(51,65,85,0.9)));
  background: var(--fm-input-bg, var(--card-bg, rgba(255,255,255,0.02)));
  color: inherit;
}

.fm-filter-clear-btn{
  padding: 8px 10px;
  border-radius: 10px;
  min-width: 36px;
}

@media (max-width: 900px){
  .fm-filter-wrap{ flex-basis: 200px; min-width: 110px; }
}

.fm-list{
  flex: 1;
  min-height: 0;
  overflow: auto;
  outline: none;
  overscroll-behavior: contain;
}
.fm-list.is-loading{ opacity: 0.65; pointer-events: none; }

.fm-list.is-drop-target{
  outline: 2px dashed color-mix(in srgb, var(--accent, #60a5fa) 55%, transparent);
  outline-offset: -2px;
}

.fm-row.is-drop-target{
  background: color-mix(in srgb, var(--accent, #60a5fa) 10%, transparent);
  outline: 1px dashed color-mix(in srgb, var(--accent, #60a5fa) 65%, transparent);
}

.fm-row[draggable="true"]{ cursor: grab; }
.fm-row[draggable="true"]:active{ cursor: grabbing; }

.fm-row{
  display:grid;
  grid-template-columns: 28px minmax(160px, 1fr) minmax(64px, 92px) minmax(72px, 100px) minmax(120px, 150px);
  gap: 10px;
  align-items:center;
  padding: 6px 10px;
  user-select:none;
}

/* Trash view: add an extra column "Откуда удалено" */
.fm-panel.is-trash .fm-row{
  grid-template-columns: 28px minmax(160px, 1fr) minmax(220px, 1.2fr) minmax(64px, 92px) minmax(72px, 100px) minmax(120px, 150px);
}
.fm-cell.fm-from{
  opacity: 0.85;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
.fm-row-header{
  position: sticky;
  top: 0;
  z-index: 1;
  font-size: calc(12px * var(--xk-font-scale));
  letter-spacing: 0.02em;
  text-transform: none;
  opacity: 0.85;
  background: var(--fm-row-header-bg, color-mix(in srgb, var(--card-bg, #020617) 55%, transparent));
  border-bottom: 1px solid var(--fm-row-header-border, var(--border, rgba(51,65,85,0.6)));
}
.fm-row-header .fm-sort-cell{
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
}
.fm-row-header .fm-sort-cell:hover{ text-decoration: underline; }
.fm-sort-ind{ font-size: calc(11px * var(--xk-font-scale)); opacity: 0.75; }
.fm-row-header .fm-sort-cell.is-sort-active .fm-sort-ind{ opacity: 0.95; }
.fm-row:not(.fm-row-header){
  cursor: default;
}
.fm-row:not(.fm-row-header):hover{
  background: var(--fm-row-hover-bg, color-mix(in srgb, var(--card-bg, #020617) 85%, transparent));
}
.fm-row.is-selected{
  background: var(--fm-row-selected-bg, color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 18%, transparent));
}
.fm-row.is-focused{
  outline: 1px solid var(--fm-row-focus-outline, color-mix(in srgb, var(--accent, #60a5fa) 55%, transparent));
}

.fm-cell{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.fm-cell.fm-check{ display:flex; align-items:center; justify-content:center; }
.fm-check-input{ width:16px; height:16px; margin:0; cursor:pointer; }
.fm-cell.fm-name{ display:flex; gap:8px; align-items:center; }
.fm-ico{ width: 18px; text-align:center; opacity: 0.95; }
.fm-name-text{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

.fm-hints{
  display:flex;
  gap: 14px;
  align-items: flex-start;
  flex-wrap: wrap;
  margin-top: 10px;
  font-size: calc(12px * var(--xk-font-scale));
}

/* Properties panel */
.fm-props{
  margin-top: 10px;
  padding: 10px 12px;
  border: 1px solid var(--fm-props-border, var(--border, rgba(51,65,85,0.85)));
  border-radius: 14px;
  background: var(--fm-props-bg, color-mix(in srgb, var(--card-bg, #020617) 82%, transparent));
}
.fm-props-head{ display:flex; align-items: baseline; justify-content: space-between; gap: 12px; }
.fm-props-title{ font-weight: 600; font-size: calc(13px * var(--xk-font-scale)); }
.fm-props-meta{ font-size: calc(12px * var(--xk-font-scale)); opacity: 0.75; }
.fm-props-body{ margin-top: 8px; min-height: 34px; }
.fm-props-grid{
  display: grid;
  grid-template-columns: 160px 1fr;
  gap: 6px 12px;
  align-items: start;
  font-size: calc(12px * var(--xk-font-scale));
}
.fm-props-k{ opacity: 0.75; }
.fm-props-v{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
}
.fm-props-empty{ font-size: calc(12px * var(--xk-font-scale)); opacity: 0.8; padding: 6px 0; }


.fm-props-actions{
  display: inline-flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}
.fm-props-recalc-btn{
  padding: 4px 10px;
  border-radius: 10px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.2;
  font-family: var(--xk-font-family);
}
.fm-props-dirsize-note{
  opacity: 0.75;
  font-size: calc(12px * var(--xk-font-scale));
  font-family: var(--xk-font-family);
}

@media (max-width: 760px){
  .fm-props-grid{ grid-template-columns: 1fr; }
  .fm-props-v{ font-family: inherit; }
}

.fm-hints-text{
  display:flex;
  gap: 14px;
  flex-wrap: wrap;
  opacity: 0.85;
}


/* Bottom bar: help (left) + actions (right) */
.fm-footer{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-top: 10px;
}
.fm-footer-actions{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  flex-wrap: wrap;
}

.fm-help-btn{
  padding: 6px 10px;
  font-size: calc(12px * var(--xk-font-scale));
  line-height: 1.1;
}

.fm-help-body{
  font-size: 0.95rem;
  line-height: 1.35;
}
.fm-help-body h3{
  margin: 14px 0 6px 0;
  font-size: 1rem;
}
.fm-help-body ul{
  margin: 6px 0 0 18px;
}
.fm-help-body li{
  margin: 4px 0;
}

.fm-dropop-list{
  max-height: 260px;
  overflow: auto;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--fm-props-border, var(--border, rgba(51,65,85,0.85)));
  background: var(--fm-props-bg, color-mix(in srgb, var(--card-bg, #020617) 92%, var(--text, #e5e7eb) 8%));
  box-sizing: border-box;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.9rem;
  white-space: pre-wrap;
}

/* Context menu (ПКМ) */
.fm-context-menu{
  position: fixed;
  z-index: 60;
  min-width: 220px;
  padding: 6px;
  border-radius: 12px;
  border: 1px solid var(--fm-menu-border, var(--modal-border, rgba(51,65,85,0.85)));
  background: var(--fm-menu-bg, color-mix(in srgb, var(--modal-bg, #020617) 92%, transparent));
  box-shadow: 0 10px 30px rgba(var(--shadow-rgb, 0,0,0), calc(var(--shadow, 0.35)));
  backdrop-filter: blur(6px);
}
.fm-context-menu.hidden{ display:none; }

.fm-context-item{
  width: 100%;
  display: flex;
  justify-content: space-between;
  gap: 12px;
  align-items: center;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--fm-btn-text, var(--header-btn-text, inherit));
  cursor: pointer;
  text-align: left;
}
.fm-context-item:hover{
  background: var(--fm-menu-item-hover-bg, color-mix(in srgb, var(--accent, #60a5fa) 12%, transparent));
  border-color: var(--fm-menu-item-hover-border, color-mix(in srgb, var(--border, #334155) 60%, transparent));
}

.fm-context-item:active{
  background: color-mix(in srgb, var(--accent, #60a5fa) 18%, transparent);
}

.fm-context-kbd{
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.75;
}
.fm-context-sep{
  height: 1px;
  margin: 6px 6px;
  background: var(--fm-menu-sep, color-mix(in srgb, var(--border, #334155) 60%, transparent));
}


html[data-theme="light"] .fm-context-menu{
  background: var(--fm-menu-bg, color-mix(in srgb, var(--modal-bg, #ffffff) 92%, transparent));
  border-color: var(--fm-menu-border, var(--modal-border, var(--border, rgba(15,23,42,0.18))));
  box-shadow: 0 10px 30px rgba(var(--shadow-rgb, 15,23,42), var(--shadow, 0.12));
}
html[data-theme="light"] .fm-context-item:hover{
  background: var(--fm-menu-item-hover-bg, color-mix(in srgb, var(--accent, #0a84ff) 10%, transparent));
  border-color: var(--fm-menu-item-hover-border, color-mix(in srgb, var(--border, rgba(15,23,42,0.12)) 60%, transparent));
}
html[data-theme="light"] .fm-context-sep{
  background: var(--fm-menu-sep, color-mix(in srgb, var(--border, rgba(15,23,42,0.12)) 60%, transparent));
}
/* Connect form */
.fm-form-grid{
  display:grid;
  grid-template-columns: 160px 1fr;
  gap: 10px 12px;
  align-items:center;
}

/*
  FM connect modal: prevent profile select / flex rows from forcing horizontal overflow.
  Modal-body hides overflow-x, and without min-width:0 the grid could overflow and
  visually "cut" the left part of labels (only the tail of the label remained visible).
*/
#fm-connect-modal .fm-form-grid{
  /* Slightly wider labels column for "SFTP host key" and friends */
  grid-template-columns: 180px 1fr;
}
#fm-connect-modal .fm-form-grid > *{
  min-width: 0;
}
#fm-connect-modal .fm-form-grid > label{
  opacity: 0.9;
  font-size: 0.95rem;
  line-height: 1.25;
  white-space: normal;
  overflow: visible;
  word-break: break-word;
}
/* Flex wrappers inside the grid (profile row, hostkey policy row, fingerprint row) */
#fm-connect-modal .fm-form-grid > div{
  min-width: 0;
}
#fm-connect-modal .fm-form-grid .terminal-input{
  min-width: 0;
}

/* Keep the 1-column layout on small screens (override the more specific connect-modal rule above) */
@media (max-width: 920px){
  #fm-connect-modal .fm-form-grid{ grid-template-columns: 1fr; }
}


/* chmod/chown helpers */
.fm-mono{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
.fm-perms-grid{
  display: grid;
  grid-template-columns: 80px repeat(3, 1fr);
  gap: 8px 12px;
  align-items: center;
}
.fm-perms-head{
  font-weight: 600;
  opacity: 0.9;
}
.fm-perms-rowlabel{
  opacity: 0.9;
}
.fm-perms-cell{
  display: flex;
  gap: 8px;
  align-items: center;
  user-select: none;
}
.fm-perms-cell input{
  width: 16px;
  height: 16px;
  margin: 0;
}

/* Conflicts */
.fm-conflicts-table{
  display:grid;
  gap: 6px;
}
.fm-conflicts-row{
  display:grid;
  grid-template-columns: 1fr 1fr 140px;
  gap: 10px;
  padding: 8px 10px;
  border: 1px solid rgba(51,65,85,0.65);
  border-radius: 12px;
  background: rgba(255,255,255,0.02);
}
.fm-conflicts-head{
  font-size: calc(12px * var(--xk-font-scale));
  opacity: 0.85;
  background: rgba(2,6,23,0.35);
}
.fm-conflicts-footer{ margin-top: 10px; }

/* Progress */
.fm-progress-line{ font-weight: 600; margin-bottom: 10px; }
.fm-progress-bar{ height: 10px; border-radius: 999px; background: rgba(51,65,85,0.55); overflow:hidden; }
.fm-progress-bar-inner{ height: 100%; width: 0%; background: rgba(37,99,235,0.55); }
.fm-progress-meta{ margin-top: 8px; font-size: calc(12px * var(--xk-font-scale)); opacity: 0.85; }
.fm-mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.fm-progress-extra{ margin-top: 8px; display:flex; justify-content:space-between; gap: 10px; align-items:center; flex-wrap:wrap; font-size: calc(12px * var(--xk-font-scale)); }
.fm-progress-extra-right{ opacity: 0.85; }
.fm-progress-details{ margin-top: 10px; max-height: 260px; overflow:auto; background: rgba(2,6,23,0.35); border: 1px solid rgba(51,65,85,0.55); border-radius: 12px; padding: 10px; }

/* Ops list */
.fm-ops-table{ display:grid; gap: 6px; }
.fm-ops-row{ display:grid; grid-template-columns: 110px 80px 90px 120px 1fr 170px; gap: 10px; padding: 8px 10px; border: 1px solid rgba(51,65,85,0.65); border-radius: 12px; background: rgba(255,255,255,0.02); align-items:center; }
.fm-ops-head{ font-size: calc(12px * var(--xk-font-scale)); opacity: 0.85; background: rgba(2,6,23,0.35); }

@media (max-width: 920px){
  .fm-card{ resize: none; }
  .fm-resize-handle-left{ display:none; }
  .fm-two{ grid-template-columns: 1fr; }
  .fm-row{ grid-template-columns: 28px minmax(140px, 1fr) minmax(56px, 84px) minmax(64px, 92px) minmax(108px, 140px); }
  .fm-panel.is-trash .fm-row{ grid-template-columns: 28px minmax(140px, 1fr) minmax(180px, 1.2fr) minmax(56px, 84px) minmax(64px, 92px) minmax(108px, 140px); }
  .fm-form-grid{ grid-template-columns: 1fr; }
  .fm-conflicts-row{ grid-template-columns: 1fr; }
  .fm-ops-row{ grid-template-columns: 1fr; }
}

html[data-theme="light"] .fm-panel{
  background: var(--fm-panel-bg, color-mix(in srgb, var(--card-bg, #ffffff) 92%, transparent));
  border-color: var(--fm-panel-border, var(--border, rgba(15,23,42,0.18)));
}
html[data-theme="light"] .fm-panel-bar{
  background: var(--fm-panel-bar-bg, color-mix(in srgb, var(--card-bg, #ffffff) 90%, transparent));
  border-color: var(--fm-panel-bar-border, var(--border, rgba(15,23,42,0.12)));
}
html[data-theme="light"] .fm-row-header{
  background: var(--fm-row-header-bg, color-mix(in srgb, var(--card-bg, #ffffff) 90%, transparent));
  border-color: var(--fm-row-header-border, var(--border, rgba(15,23,42,0.12)));
}
html[data-theme="light"] .fm-row:not(.fm-row-header):hover{
  background: var(--fm-row-hover-bg, color-mix(in srgb, var(--card-bg, #ffffff) 85%, transparent));
}
html[data-theme="light"] .fm-row.is-selected{
  background: var(--fm-row-selected-bg, color-mix(in srgb, var(--header-tab-active-bg, #2563eb) 12%, transparent));
}
html[data-theme="light"] .fm-progress-details{
  background: color-mix(in srgb, var(--card-bg, #ffffff) 92%, transparent);
  border-color: var(--border, rgba(15,23,42,0.12));
}


/* File Manager: bookmarks (pins) manager modal */
.fm-bm-list{
  display:flex;
  flex-direction:column;
  gap: 8px;
  margin-top: 8px;
  max-height: min(52vh, 520px);
  overflow: auto;
  padding-right: 2px;
}
.fm-bm-row{
  display:flex;
  gap: 8px;
  align-items:center;
}
.fm-bm-row .terminal-input{
  height: 32px;
}
.fm-bm-label{
  flex: 0 0 220px;
  min-width: 140px;
}
.fm-bm-path{
  flex: 1 1 auto;
  min-width: 180px;
}
.fm-bm-mini{
  height: 32px;
  min-width: 36px;
  padding: 0 10px;
  border-radius: 9999px;
}



/* Outbounds helper hints (protocol/type/security dropdowns) */
.outbounds-hints{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: flex-end;
  margin: 10px 0 12px 0;
}

.outbounds-hints label{
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.outbounds-hints .hint-label{
  font-size: calc(12px * var(--xk-font-scale));
  color: var(--muted, #94a3b8);
  padding-left: 4px;
}

/* Slightly compact select paddings for the outbounds block */
.outbounds-hints select.xray-log-select{
  padding-top: 6px;
  padding-bottom: 6px;
}


/* Outbounds mini-generator modal */
.outbounds-gen-hints{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:flex-end;
  margin: 6px 0 10px 0;
}
.outbounds-gen-hints label{ display:flex; flex-direction:column; gap:6px; }

.outbounds-gen-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
  align-items:end;
}
.outbounds-gen-grid label{ display:flex; flex-direction:column; gap:6px; }

.outbounds-gen-preview{
  /* Reuse the main panel textarea style (.xkeen-textarea) and just make it compact */
  min-height: 96px;
  max-height: min(38vh, 280px);
  font-size: calc(13px * var(--xk-font-scale));
  padding: 10px 12px;
  border-radius: 8px;
  line-height: 1.35;
}

/* Mihomo Import modal: YAML preview with minimal syntax highlighting (CodeMirror, read-only) */
.xk-mihomo-import-preview.CodeMirror{
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  font-size: calc(13px * var(--xk-font-scale));
  line-height: 1.35;
}
.xk-mihomo-import-preview .CodeMirror-scroll{
  padding: 10px 12px;
}

.outbounds-gen-advanced{
  margin-top: 10px;
  padding: 10px 10px 8px 10px;
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  background: rgba(2, 6, 23, 0.18);
}
.outbounds-gen-advanced > summary{
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  opacity: 0.9;
}
.outbounds-gen-advanced[open] > summary{ margin-bottom: 10px; }

@media (max-width: 720px){
  .outbounds-gen-grid{ grid-template-columns: 1fr; }
}
