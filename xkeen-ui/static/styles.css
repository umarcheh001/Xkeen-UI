body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}

body.modal-open {
  overflow: hidden;
}


a {
  color: #60a5fa;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px;
}

header {
  margin-bottom: 24px;
}

header h1 {
  margin: 0 0 4px;
  font-size: 28px;
}


header p {
  margin: 0;
  color: #9ca3af;
}

.header-main {
  /* 3 зоны: слева заголовок, по центру выбор ядра, справа действия */
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  column-gap: 12px;
  row-gap: 10px;
}

.header-title-group { justify-self: start; }
.header-center { justify-self: center; }
.header-right { justify-self: end; }

@media (max-width: 900px) {
  .header-main {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  .header-center {
    order: 3;
    width: 100%;
    display: flex;
    justify-content: center;
  }
}

/* Правая группа в шапке: версия/ядро + действия (выйти + тема) */
.header-right {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  flex-wrap: nowrap;
}

/* Держим «Выйти» и переключатель темы рядом (как единый блок) */
.header-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
}

.theme-toggle-header {
  /* в шапке кнопка не плавающая */
  position: static;
  top: auto;
  right: auto;
}

.header-title-group {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.service-status-text {
  display: none; /* текст статуса убран, остаётся только всплывающая подсказка на лампочке */
}

.service-status-lamp {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 9999px;
  background: #6b7280;
  box-shadow: none;
  cursor: help;
  transition:
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.15s ease;
}


/* Сервис запущен */
.service-status-lamp[data-state="running"] {
  background: #22c55e;
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.7);
  animation: service-status-pulse 1s infinite;
}

/* Остановлен */
.service-status-lamp[data-state="stopped"] {
  background: #ef4444;
  box-shadow: 0 0 4px rgba(248, 113, 113, 0.7);
}

/* Проверка / ожидание */
.service-status-lamp[data-state="pending"] {
  background: #f59e0b;
  box-shadow: 0 0 6px rgba(245, 158, 11, 0.7);
  animation: service-status-pulse 1s infinite;
}

/* Ошибка / неизвестно */
.service-status-lamp[data-state="error"] {
  background: #f97316;
  box-shadow: 0 0 6px rgba(249, 115, 22, 0.7);
}

@keyframes service-status-pulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.25);
    opacity: 0.7;
  }
}



.service-core-text {
  font-size: 12px;
  padding: 4px 12px;
  border-radius: 999px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  white-space: nowrap;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.service-core-text.has-core {
  border-color: #2563eb;
  background: #0b1120;
  box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
}

.last-load-badge {
  margin-left: 16px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid #1f2937;
  font-size: 11px;
  color: #9ca3af;
  white-space: nowrap;
  align-self: center;
  background: rgba(15, 23, 42, 0.9);
}

/* Когда бейдж стоит рядом с кнопками управления — используем gap вместо margin */
.xkeen-ctrl-row .last-load-badge {
  margin-left: 0;
}

.last-load-badge.last-load-loaded {
  border-color: #22c55e66;
  color: #bbf7d0;
}

.last-load-badge.last-load-saved {
  border-color: #38bdf866;
  color: #bae6fd;
}

.last-load-badge.last-load-error {
  border-color: #ef444466;
  color: #fecaca;
}


.service-core-text.has-core:hover {
  text-decoration: underline;
}

.core-select-row {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.core-option {
  padding: 4px 12px;
  font-size: 12px;
  border-radius: 9999px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

.core-option:hover {
  background: linear-gradient(135deg, #1d4ed8, #2563eb);
  border-color: #2563eb;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.6);
  transform: translateY(-1px);
}

.core-option.active {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border-color: #22c55e;
  box-shadow: 0 4px 12px rgba(22, 163, 74, 0.6);
}

.core-option[disabled] {
  opacity: 0.6;
  cursor: default;
  box-shadow: none;
  background: #020617;
}



.card {
  background: #020617;
  border-radius: 12px;
  padding: 16px 16px 20px;
  margin-bottom: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  border: 1px solid #1f2937;
}

.card h2 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 20px;
}

.card p {
  margin-top: 0;
  margin-bottom: 12px;
  color: #9ca3af;
}

textarea#routing-editor {
  width: 100%;
  min-height: 260px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 14px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  resize: vertical;
  box-sizing: border-box;
}


.xkeen-textarea {
  width: 100%;
  min-height: 200px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 14px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  resize: vertical;
  box-sizing: border-box;
}

.CodeMirror {
  border-radius: 8px;
  border: 1px solid #111827;
  background: #020617;
  /* Let CodeMirror grow with content; avoid conflicting manual resize */
  height: auto;
  min-height: 260px;
  font-family: "JetBrains Mono", "Fira Code", Menlo, Monaco, Consolas,
    "Liberation Mono", "Courier New", monospace;
box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);

  font-size: 14px;
}

/* Make scrolling predictable and avoid white gaps */
.CodeMirror-scroll {
  max-height: 70vh;
  background-color: #020617;
  overflow: auto !important;
}

/*
  Fullscreen (CodeMirror addon/display/fullscreen)
  ------------------------------------------------
  We intentionally cap editor height in normal mode via `max-height: 70vh`.
  But in fullscreen CodeMirror only adds `.CodeMirror-fullscreen` on the
  wrapper; without overrides the scroll area stays capped, so fullscreen looks
  "crooked" (big empty space below/aside).
*/
.CodeMirror.CodeMirror-fullscreen {
  /* Make sure the editor overlays the whole UI (sidebar/header, etc.) */
  z-index: 10000;
  border-radius: 0;
}

.CodeMirror.CodeMirror-fullscreen .CodeMirror-scroll {
  max-height: none !important;
  height: 100% !important;
}

.cm-error-line {
  background: rgba(220, 38, 38, 0.15);
}

.actions {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.actions button {
  flex: 1 1 210px;
  text-align: center;
  white-space: normal;
}


button {
  border-radius: 9999px;
  padding: 6px 14px;
  font-size: 14px;
  cursor: pointer;
  background: #020617;
  border: 1px solid #1f2937;
  color: #e5e7eb;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

button:hover {
  background: #020617;
  border-color: #4b5563;
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
  transform: translateY(-1px);
}

button:active {
  background: linear-gradient(135deg, #1d4ed8, #2563eb);
  border-color: #2563eb;
  transform: translateY(1px) scale(0.99);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
}

button:disabled {
  opacity: 0.5;
  cursor: default;
  box-shadow: none;
}

.status {
  margin-top: 8px;
  font-size: 12px;
  color: #9ca3af;
}

.error {
  margin-top: 6px;
  font-size: 12px;
  color: #fca5a5;
}

.inbounds-modes {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mode-item {
  display: flex;
  gap: 8px;
  padding: 8px;
  border-radius: 8px;
  background: #020617;
  border: 1px solid #1f2937;
}

.mode-item input {
  margin-top: 4px;
}

.mode-item strong {
  color: #e5e7eb;
}

.mode-item small {
  color: #9ca3af;
}

.toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  margin-top: 10px;
  color: #9ca3af;
}

.toggle input {
  width: 16px;
  height: 16px;
}

#outbounds-url {
  width: 100%;
  box-sizing: border-box;
  border-radius: 9999px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  padding: 8px 12px;
  font-size: 14px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

#outbounds-url:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 1px #3b82f6;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

thead {
  background: #020617;
}

th, td {
  padding: 6px 8px;
  border-bottom: 1px solid #1f2937;
  text-align: left;
}

th {
  font-weight: 600;
  color: #9ca3af;
}

tbody tr:hover {
  background: #020617;
}
#backups-table .backups-empty-row:hover {
  background: transparent;
}


.hint {
  margin-top: 8px;
  font-size: 12px;
  color: #9ca3af;
}

footer {
  margin-top: 16px;
  text-align: right;
  color: #6b7280;
  font-size: 11px;
}

.btn-link {
  border-radius: 9999px;
  padding: 6px 14px;
  border: 1px solid #374151;
  display: inline-block;
}

.links {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.links li {
  margin-bottom: 4px;
}

.log-block {
  background: #020617;
  border-radius: 8px;
  border: 1px solid #1f2937;
  padding: 8px;
  font-size: 12px;
  max-height: 260px;
  overflow: auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: pre-wrap;
}
.log-tag-info {
  color: #60a5fa;
  font-weight: 500;
}

.log-tag-warn {
  color: #facc15;
  font-weight: 500;
}

.log-tag-error {
  color: #f97373;
  font-weight: 600;
}



/* Two-column main layout */
.layout-2col {
  display: grid;
  grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
  gap: 16px;
  align-items: flex-start;
}

.layout-main {
  min-width: 0;
}

.layout-side {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.layout-side .card {
  margin-top: 0;
}

@media (max-width: 1024px) {
  .layout-2col {
    grid-template-columns: minmax(0, 1fr);
  }
}

/* Log controls */
.log-card {
  margin-top: 16px;
}

.log-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 8px;
}

.log-header-row h2 {
  margin: 0;
}

.log-header-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  overflow-x: auto;
  scrollbar-width: none; /* Firefox */
}

/* Hide horizontal scrollbar but keep scrollability */
.log-header-actions::-webkit-scrollbar {
  display: none;
}

.log-btn {
  font-size: 11px;
  padding-inline: 10px;
}

/* XKeen commands block */
.commands-card {
  margin-top: 16px;
}

.commands-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.commands-header h2 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #c7d2fe;
}

#commands-arrow {
  font-size: 14px;
  opacity: 0.8;
}

.command-group + .command-group {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #1f2937;
}

.command-group-title {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #9ca3af;
  margin-bottom: 4px;
}


.command-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  grid-auto-rows: auto;
  column-gap: 8px;
  row-gap: 4px;
}


@media (max-width: 900px) {
  .command-list {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 640px) {
  .command-list {
    grid-template-columns: 1fr;
  }
}


.command-item {
  position: relative;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 10px;
  background: #020617;
  border: 1px solid #1f2937;
  font-size: 12px;
  cursor: pointer;
  transition: border-color 0.12s ease, background 0.12s ease, transform 0.1s ease;
}
.command-item.loading {
  opacity: 0.7;
  cursor: wait;
}

.command-item.loading::after {
  content: '';
  position: absolute;
  right: 8px;
  top: 50%;
  width: 12px;
  height: 12px;
  margin-top: -6px;
  border-radius: 999px;
  border: 2px solid rgba(148, 163, 184, 0.5);
  border-top-color: #e5e7eb;
  animation: xkeen-spinner 0.8s linear infinite;
}


.command-item:hover {
  border-color: #60a5fa;
  background: #0b1220;
  transform: translateY(-1px);
}

.command-item-top {
  display: flex;
  align-items: center;
  gap: 8px;
}

.command-item-icon {
  font-size: 10px;
  opacity: 0.85;
}

.command-item-code code {
  background: transparent;
  border-radius: 999px;
  border: 1px solid rgba(30, 64, 175, 0.9);
  padding: 2px 8px;
  font-size: 12px;
}

.command-item-desc {
  color: #9ca3af;
  font-size: 11px;
  line-height: 1.4;
}

.layout-single {
  max-width: 960px;
  margin: 0 auto;
}

/* XKeen editors: make CodeMirror text brighter and comments более заметными */
.cm-s-material-darker.CodeMirror {
  color: #e5e7eb;
}

/* Комментарии: приглушённые серо-синие в тёмной теме */
.cm-s-material-darker .cm-comment {
  color: #64748b;
  font-style: italic;
}

/* Ключи JSON/YAML (названия полей) */
.cm-s-material-darker .cm-property {
  color: #60a5fa;
}

/* Строки (пути, значения) */
.cm-s-material-darker .cm-string {
  color: #a3e635;
}

/* Числа */
.cm-s-material-darker .cm-number {
  color: #f97316;
}

/* true / false / null и прочие атомы */
.cm-s-material-darker .cm-atom {
  color: #22d3ee;
}

/* Скобки, запятые, двоеточия */
.cm-s-material-darker .cm-punctuation,
.cm-s-material-darker .cm-bracket {
  color: #9ca3af;
}

/* Ключевые слова */
.cm-s-material-darker .cm-keyword {
  color: #facc15;
}

/* Имена и переменные */
.cm-s-material-darker .cm-def,
.cm-s-material-darker .cm-variable,
.cm-s-material-darker .cm-variable-2 {
  color: #e5e7eb;
}

/* Цвет номера строки и курсор */
.cm-s-material-darker .CodeMirror-linenumber {
  color: #4b5563;
}

.cm-s-material-darker .CodeMirror-cursor {
  border-left: 2px solid #facc15;
}

/* Более заметное выделение текста в редакторах CodeMirror */
.cm-s-material-darker .CodeMirror-selected,
.cm-s-material-darker .CodeMirror-line::selection,
.cm-s-material-darker .CodeMirror-line > span::selection,
.cm-s-material-darker .CodeMirror-line > span > span::selection,
.xkeen-cm .CodeMirror-selected,
.xkeen-cm .CodeMirror-line::selection,
.xkeen-cm .CodeMirror-line > span::selection,
.xkeen-cm .CodeMirror-line > span > span::selection {
  background: rgba(96, 165, 250, 0.45) !important; /* светло-синий фон выделения */
}

/* На случай, если браузер использует общий ::selection внутри оболочки редактора */
.xkeen-cm ::selection {
  background: rgba(96, 165, 250, 0.45) !important;
}

/* === CodeMirror cosmetics (enabled addons need CSS to be visible) ===
   - match-highlighter: .cm-matchhighlight
   - trailing-space:    .cm-trailingspace
   - rulers:            .CodeMirror-ruler (.CodeMirror-rulers wrapper)
*/
.cm-s-material-darker .cm-matchhighlight,
.xkeen-cm .cm-matchhighlight {
  background: rgba(34, 211, 238, 0.18);
  border-radius: 2px;
}

.cm-s-material-darker .cm-trailingspace,
.xkeen-cm .cm-trailingspace {
  background: rgba(248, 113, 113, 0.28);
}

.cm-s-material-darker .CodeMirror-rulers,
.xkeen-cm .CodeMirror-rulers {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
}

.cm-s-material-darker .CodeMirror-ruler,
.xkeen-cm .CodeMirror-ruler {
  /* Hide CodeMirror rulers (thin vertical guide line) */
  border-left: 0 !important;
}





.xkeen-cm {
  /* CodeMirror wrapper */
  min-height: 160px;
}


/* --- CodeMirror mouse toolbar (overlay) --- */
.xkeen-cm-toolbar {
  /* Toolbar sits above the editor (outside CodeMirror) */
  position: relative;
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin: 0 0 6px 0;
  padding-right: 6px;
  /* Ensure tooltips and the toolbar itself can overlap the editor */
  z-index: 50;
  overflow: visible;
}

/* When editor is in fullscreen, keep toolbar visible */
.xkeen-cm-toolbar.is-fullscreen {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 10050;
}


.xkeen-cm-tool {
  position: relative;
  width: 30px;
  height: 28px;
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.22);
  background: rgba(2, 6, 23, 0.72);
  color: rgba(226, 232, 240, 0.95);
  cursor: pointer;
  display: grid;
  place-items: center;
  line-height: 1;
  user-select: none;
}

.xkeen-cm-tool svg {
  width: 16px;
  height: 16px;
  display: block;
}

.xkeen-cm-tool:hover {
  border-color: rgba(148, 163, 184, 0.45);
  background: rgba(2, 6, 23, 0.88);
}

.xkeen-cm-tool:active {
  transform: translateY(1px);
}

.xkeen-cm-tool:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.75);
  outline-offset: 2px;
}

/* Red "?" help button */
.xkeen-cm-tool.is-help {
  color: rgba(239, 68, 68, 0.98);
}

.xkeen-cm-tool.is-help:hover {
  border-color: rgba(239, 68, 68, 0.55);
}

/* Tooltip (hover + keyboard focus) */
.xkeen-cm-tool[data-tip]::after {
  content: attr(data-tip);
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  z-index: 9999;
  white-space: nowrap;
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px solid rgba(148, 163, 184, 0.22);
  background: rgba(15, 23, 42, 0.95);
  color: rgba(226, 232, 240, 0.98);
  font-size: 12px;
  opacity: 0;
  transform: translateY(-2px);
  pointer-events: none;
  transition: opacity 0.12s ease, transform 0.12s ease;
}

.xkeen-cm-tool[data-tip]:hover::after,
.xkeen-cm-tool[data-tip]:focus-visible::after {
  opacity: 1;
  transform: translateY(0);
}

/* Light theme */
html[data-theme="light"] .xkeen-cm-tool {
  background: rgba(255, 255, 255, 0.85);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.18);
}

html[data-theme="light"] .xkeen-cm-tool.is-help {
  color: rgba(220, 38, 38, 0.98);
}

html[data-theme="light"] .xkeen-cm-tool[data-tip]::after {
  background: rgba(255, 255, 255, 0.98);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.18);
}

/* --- CodeMirror help drawer (slides in from the right) --- */
.xkeen-cm-help-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.55);
  z-index: 10040;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.16s ease;
}

.xkeen-cm-help-overlay.is-open {
  opacity: 1;
  pointer-events: auto;
}

.xkeen-cm-help-drawer {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  width: min(460px, 92vw);
  z-index: 10041;
  transform: translateX(100%);
  transition: transform 0.18s ease;
  border-left: 1px solid rgba(148, 163, 184, 0.18);
  background: rgba(2, 6, 23, 0.98);
  color: rgba(226, 232, 240, 0.95);
  box-shadow: -24px 0 48px rgba(0, 0, 0, 0.35);
  display: flex;
  flex-direction: column;
}

.xkeen-cm-help-drawer.is-open {
  transform: translateX(0);
}

.xkeen-cm-help-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 14px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.16);
}

.xkeen-cm-help-title {
  font-weight: 700;
  font-size: 14px;
  letter-spacing: 0.2px;
}

.xkeen-cm-help-close {
  width: 34px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.18);
  background: rgba(15, 23, 42, 0.65);
  color: rgba(226, 232, 240, 0.95);
  cursor: pointer;
}

.xkeen-cm-help-close:hover {
  background: rgba(15, 23, 42, 0.9);
}

.xkeen-cm-help-body {
  padding: 12px 14px 18px;
  overflow: auto;
}

.xkeen-cm-help-section {
  padding: 10px 10px;
  margin: 0 0 10px 0;
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.14);
  background: rgba(15, 23, 42, 0.35);
}

.xkeen-cm-help-section h3 {
  margin: 0 0 6px 0;
  font-size: 13px;
}

.xkeen-cm-help-section p {
  margin: 6px 0;
  font-size: 13px;
  line-height: 1.35;
}

.xkeen-cm-help-section ul {
  margin: 8px 0 0 18px;
  padding: 0;
  font-size: 13px;
  line-height: 1.35;
}

html[data-theme="light"] .xkeen-cm-help-overlay {
  background: rgba(15, 23, 42, 0.35);
}

html[data-theme="light"] .xkeen-cm-help-drawer {
  background: rgba(255, 255, 255, 0.98);
  color: rgba(15, 23, 42, 0.95);
  border-left-color: rgba(15, 23, 42, 0.12);
  box-shadow: -24px 0 48px rgba(0, 0, 0, 0.18);
}

html[data-theme="light"] .xkeen-cm-help-head {
  border-bottom-color: rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] .xkeen-cm-help-close {
  background: rgba(255, 255, 255, 0.9);
  color: rgba(15, 23, 42, 0.95);
  border-color: rgba(15, 23, 42, 0.16);
}

html[data-theme="light"] .xkeen-cm-help-section {
  background: rgba(248, 250, 252, 0.8);
  border-color: rgba(15, 23, 42, 0.12);
}

/* Мини-терминал XKeen */
.terminal-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(15, 23, 42, 0.75);
  z-index: 50;
}

.terminal-window {
  width: 520px;
  height: 360px;

  min-width: 360px;
  min-height: 240px;

  max-width: 95vw;
  max-height: 90vh;

  background: #020617;
  border-radius: 12px;
  border: 1px solid #334155;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
  padding: 12px 14px;
  font-size: 14px;

  /* resizable + layout */
  display: flex;
  flex-direction: column;
  resize: both;
  overflow: hidden;
  position: relative;
}

.terminal-window::after {
  /* визуальная "ручка" в правом нижнем углу */
  content: "";
  position: absolute;
  right: 8px;
  bottom: 8px;
  width: 14px;
  height: 14px;
  border-right: 2px solid rgba(148, 163, 184, 0.35);
  border-bottom: 2px solid rgba(148, 163, 184, 0.35);
  pointer-events: none;
  border-radius: 2px;
}

.terminal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;

  /* drag handle */
  cursor: move;
  user-select: none;
}

.terminal-header-left {
  display: flex;
  align-items: center;
  min-width: 0;
}

.terminal-conn-lamp {
  margin-left: 10px;
}

.terminal-conn-badge {
  margin-left: 10px;
  padding: 2px 8px;
  border-radius: 9999px;
  font-size: 11px;
  line-height: 1.2;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(2, 6, 23, 0.6);
  color: #cbd5e1;
  white-space: nowrap;
}

.terminal-conn-badge[data-state="connected"] {
  border-color: rgba(52, 211, 153, 0.45);
  background: rgba(16, 185, 129, 0.15);
  color: #34d399;
}

.terminal-conn-badge[data-state="connecting"] {
  border-color: rgba(251, 191, 36, 0.45);
  background: rgba(245, 158, 11, 0.14);
  color: #fbbf24;
}

.terminal-conn-badge[data-state="disconnected"] {
  border-color: rgba(248, 113, 113, 0.45);
  background: rgba(239, 68, 68, 0.12);
  color: #fca5a5;
}

.terminal-uptime {
  margin-left: 8px;
  font-size: 11px;
  color: #9ca3af;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  white-space: nowrap;
}

.terminal-tool-btn-danger {
  border-color: rgba(248, 113, 113, 0.55);
  background: rgba(127, 29, 29, 0.40);
  color: #fecaca;
}

.terminal-tool-btn-danger:hover {
  background: rgba(153, 27, 27, 0.55);
}

.terminal-toolbar {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 6px;
  flex-wrap: wrap;
}

.terminal-tool-btn {
  border-radius: 9999px;
  padding: 4px 8px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(2, 6, 23, 0.6);
  color: #e5e7eb;
  font-size: 12px;
  line-height: 1;
  cursor: pointer;
}

.terminal-tool-btn:hover {
  background: rgba(17, 24, 39, 0.85);
}

.terminal-tool-btn:active {
  transform: translateY(1px);
}

.terminal-tool-btn.is-active {
  border-color: rgba(59, 130, 246, 0.65);
  background: rgba(30, 64, 175, 0.35);
}

.terminal-tool-btn-kbd {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  padding: 4px 7px;
}

.terminal-header span {
  font-weight: 600;
}

.terminal-close {
  background: transparent;
  border: none;
  color: #9ca3af;
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
}

.terminal-window.is-fullscreen {
  position: fixed !important;
  left: 8px !important;
  top: 8px !important;
  width: calc(100vw - 16px) !important;
  height: calc(100vh - 16px) !important;
  max-width: none !important;
  max-height: none !important;
  resize: none !important;
}

.terminal-window.is-fullscreen::after {
  display: none;
}

.terminal-command {
  width: 100%;
  background: #020617;
  border-radius: 6px;
  border: 1px solid #1f2937;
  padding: 4px 8px;
  margin-bottom: 6px;
  font-size: 12px;
  color: #9ca3af;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-search-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
  flex-wrap: wrap;
}

.terminal-search-input {
  flex: 1 1 220px;
  min-width: 140px;
  background: #020617;
  border-radius: 9999px;
  border: 1px solid #374151;
  padding: 6px 10px;
  font-size: 12px;
  color: #e5e7eb;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-search-btn {
  border-radius: 9999px;
  padding: 4px 8px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(2, 6, 23, 0.6);
  color: #e5e7eb;
  font-size: 12px;
  line-height: 1;
  cursor: pointer;
}

.terminal-search-btn:hover {
  background: rgba(17, 24, 39, 0.85);
}

.terminal-search-btn:active {
  transform: translateY(1px);
}

.terminal-search-counter {
  min-width: 52px;
  text-align: center;
  font-size: 11px;
  color: #9ca3af;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.terminal-output {
  width: 100%;
  background: #020617;
  border-radius: 6px;
  border: 1px solid #1f2937;
  padding: 6px 8px;
  margin-bottom: 6px;

  /* растягиваемое окно: вывод занимает всё оставшееся место */
  flex: 1 1 auto;
  min-height: 140px;
  max-height: none;

  overflow: auto;
  white-space: pre-wrap;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12px;
  color: #e5e7eb;
}

.terminal-output:has(.xterm) {
  padding: 0;
  overflow: hidden;
}

.terminal-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.terminal-footer-group {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.terminal-footer-label {
  font-size: 11px;
  color: #9ca3af;
  font-weight: 600;
  user-select: none;
  margin-right: 2px;
}


.terminal-input-row {
  display: flex;
  gap: 8px;
}

.terminal-input {
  flex: 1;
  background: #020617;
  border-radius: 9999px;
  border: 1px solid #374151;
  padding: 6px 10px;
  font-size: 14px;
  color: #e5e7eb;
}

.terminal-send {
  border-radius: 9999px;
  padding: 6px 12px;
  border: none;
  background: #2563eb;
  color: #f9fafb;
  font-size: 14px;
  cursor: pointer;
}
.terminal-send:hover {
  background: #1d4ed8;
}


.terminal-history-btn {
  border-radius: 9999px;
  padding: 6px 10px;
  border: 1px solid #4b5563;
  background: transparent;
  color: #e5e7eb;
  font-size: 14px;
  cursor: pointer;
}
.terminal-history-btn:hover {
  background: #111827;
}



.mihomo-templates-row {
  gap: 8px;
  flex-wrap: wrap;
  overflow-x: auto;
}

.mihomo-templates-row button {
  flex: 0 0 auto;
}

.mihomo-template-select {
  min-width: 180px;
  border-radius: 9999px;
  padding: 6px 12px;
  font-size: 14px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  outline: none;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.4);
}

.mihomo-template-select:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.5);
}


.top-tabs {
  margin-top: 12px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

button.top-tab-btn {
  border-radius: 9999px;
  padding: 6px 14px;
  font-size: 14px;
  text-align: center;
  justify-content: center;
  display: flex;
  align-items: center;
  background: #020617;
  border: 1px solid #1f2937;
  color: #e5e7eb;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
  cursor: pointer;
  white-space: nowrap;
  flex: 1 1 0;
}


button.top-tab-btn.active {
  background: linear-gradient(135deg, #1d4ed8, #2563eb);
  border-color: #2563eb;
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
}

.view-section {
  margin-top: 16px;
}
/* Fix terminal overflow */
.terminal-window,
.terminal-window * {
    box-sizing: border-box;
}

/* Live Xray logs */
.xray-log-block {
  max-height: 420px;
}

.xray-log-filter,
.xray-log-select {
  min-width: 140px;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  font-size: 12px;
}

.xray-log-filter::placeholder {
  color: #6b7280;
}


/* Live Xray logs */
.xray-log-block {
  max-height: 420px;
  color: #e5e7eb;
}

.log-block .log-line {
  display: block;
}

.log-block .log-line-info {
  color: #93c5fd;
}

.log-block .log-line-warning {
  color: #fbbf24;
}

.log-block .log-line-error {
  color: #f87171;
}

.xray-log-select {
  min-width: 140px;
  padding: 6px 10px;
  border-radius: 9999px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  font-size: 12px;
}


.log-btn.icon-only {
  font-size: 18px;
  line-height: 1;
  padding-inline: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}



/* Backup action buttons in backups table */
.backup-actions {
  display: flex;
  gap: 6px;
  justify-content: flex-end;
  align-items: center;
}

button.backup-icon-btn {
  flex: 0 0 auto;
  padding: 4px 10px;
  border-radius: 9999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

button.backup-icon-btn .backup-icon,
.backup-icon-btn .backup-icon {
  width: 14px;
  height: 14px;
}

/* More prominent style for delete backup button */
button.backup-icon-btn.backup-delete-btn {
  background: linear-gradient(135deg, #b91c1c, #ef4444);
  border-color: #b91c1c;
}

/* Xray logs status lamp */
.xray-log-lamp {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 9999px;
  margin-left: 8px;
  background: #6b7280;
  box-shadow: none;
  transition:
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.15s ease;
  vertical-align: middle;
}

.xray-log-lamp[data-state="on"] {
  background: #22c55e;
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.7);
}

.xray-log-lamp[data-state="off"] {
  background: #4b5563;
  box-shadow: none;
}

.xray-log-lamp[data-state="error"] {
  background: #f97316;
  box-shadow: 0 0 6px rgba(249, 115, 22, 0.7);
}

.xray-log-lamp.pulse {
  transform: scale(1.2);
}

/* Mobile layout tweaks */
@media (max-width: 640px) {
  .top-tabs {
    flex-direction: column;
    align-items: stretch;
  }

  .top-tabs .top-tab-btn {
    width: 100%;
  }

  table {
    font-size: 12px;
  }

  th,
  td {
    padding: 6px 4px;
  }

  .backup-actions {
    justify-content: flex-end;
  }
}


/* GitHub catalog modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 60;
}

.modal.hidden {
  display: none;
}

.modal-content {
  background: #020617;
  border-radius: 12px;
  border: 1px solid #334155;
  padding: 12px 14px 14px 14px;
  max-width: 520px;
  width: 100%;
  max-height: 80vh;
  box-sizing: border-box;
  box-shadow: 0 18px 50px rgba(15, 23, 42, 0.8);
  display: flex;
  flex-direction: column;
}



.modal-actions {
  margin-top: 12px;
  display: flex;
  justify-content: space-between;
  gap: 8px;
  align-items: center;
}

.github-config-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
}

.github-config-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 6px;
  background: rgba(255,255,255,0.04);
}

.github-config-title {
  font-weight: 600;
}

.github-config-meta {
  font-size: 0.8rem;
  opacity: 0.8;
}


.github-export-form {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.github-export-form input,
.github-export-form textarea {
  width: 100%;
  background: #111827;
  border: 1px solid #374151;
  color: #e5e7eb;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: 0.9rem;
  box-sizing: border-box;
}


.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid #1f2937;
}

.modal-title {
  font-size: 15px;
  font-weight: 600;
}

.modal-close {
  background: transparent;
  border: none;
  color: #9ca3af;
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
}

.modal-close:hover {
  color: #e5e7eb;
}

.modal-body {
  margin-top: 8px;
  margin-bottom: 10px;
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overflow-x: hidden;
}




#toast-container {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 80;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast {
  min-width: 260px;
  max-width: 360px;
  background: #020617;
  border-radius: 10px;
  border: 1px solid #22c55e;
  box-shadow: 0 18px 40px rgba(22, 163, 74, 0.4);
  padding: 10px 12px;
  font-size: 0.86rem;
  color: #e5e7eb;
  display: flex;
  align-items: flex-start;
  gap: 8px;
}

.toast-error {
  border-color: #ef4444;
  box-shadow: 0 18px 40px rgba(239, 68, 68, 0.4);
}

.toast-icon {
  font-size: 1.1rem;
  margin-top: 1px;
}

.toast-message {
  flex: 1;
}


/* Global auto-restart toggle in header */
.global-toggle-row {
  margin-top: 8px;
  display: flex;
  justify-content: flex-end;
  align-items: flex-start;
}

/* Справа: чекбокс авто‑перезапуска + бейдж "Загружено ..." строго под ним */
Lpx;
}

.global-autorestart-toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #9ca3af;
  user-select: none;
}

.global-autorestart-toggle input[type="checkbox"] {
  width: 14px;
  height: 14px;
  cursor: pointer;
}

.global-autorestart-toggle span {
  cursor: pointer;
}


.xkeen-ctrl-row {
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 12px;
  flex-wrap: wrap;
}




/* Бейдж справа: под чекбоксом и выровнен по правому краю */
.global-toggle-right .last-load-badge {
  margin-left: 0;
  align-self: flex-end;
}
.xkeen-ctrl-group {
  display: inline-flex;
  gap: 4px;
}

/* Бейдж «Загружено ...» теперь стоит рядом с кнопками управления */
.xkeen-ctrl-row .last-load-badge {
  margin-left: 0;
}

.xkeen-ctrl-btn {
  padding: 3px 10px;
  font-size: 11px;
  border-radius: 9999px;
  border: 1px solid #1f2937;
  background: #020617;
  color: #e5e7eb;
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.7);
  cursor: pointer;
  transition:
    background 0.15s ease,
    transform 0.05s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}
.xkeen-ctrl-btn.loading {
  position: relative;
  color: #9ca3af;
  cursor: wait;
}

.xkeen-ctrl-btn.loading::after {
  content: '';
  position: absolute;
  right: 10px;
  top: 50%;
  width: 14px;
  height: 14px;
  margin-top: -7px;
  border-radius: 999px;
  border: 2px solid rgba(148, 163, 184, 0.6);
  border-top-color: #e5e7eb;
  animation: xkeen-spinner 0.8s linear infinite;
}

@keyframes xkeen-spinner {
  from { transform: translateY(-50%) rotate(0deg); }
  to   { transform: translateY(-50%) rotate(360deg); }
}


@keyframes xkeen-global-spinner {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
.xkeen-ctrl-btn.loading {
  position: relative;
  color: #9ca3af;
  cursor: wait;
}

.xkeen-ctrl-btn.loading::after {
  content: '';
  position: absolute;
  right: 10px;
  top: 50%;
  width: 14px;
  height: 14px;
  margin-top: -7px;
  border-radius: 999px;
  border: 2px solid rgba(148, 163, 184, 0.6);
  border-top-color: #e5e7eb;
  animation: xkeen-spinner 0.8s linear infinite;
}

@keyframes xkeen-spinner {
  from { transform: translateY(-50%) rotate(0deg); }
  to   { transform: translateY(-50%) rotate(360deg); }
}


.xkeen-ctrl-btn:hover {
  background: linear-gradient(135deg, #1d4ed8, #2563eb);
  border-color: #2563eb;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.6);
  transform: translateY(-1px);
}

.xkeen-ctrl-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.7);
}



textarea#json-editor-textarea {
  width: 100%;
  min-height: 260px;
  max-height: 60vh;
  height: 260px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 14px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb; /* как в редакторе 05_routing */
  resize: none; /* избегаем артефактов при сильном растягивании */
  box-sizing: border-box;
  overflow-y: auto;
}



#routing-help-line {
  cursor: pointer;
  display: inline-block;
  margin-top: -4px;
  margin-bottom: 2px;
}



#routing-help-line:hover {
  animation: routing-help-blink 1s infinite;
}

@keyframes routing-help-blink {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}


#mihomo-profiles-link {
  cursor: pointer;
  display: inline-block;
  margin-top: -4px;
  margin-bottom: 4px;
  font-size: 14px;
}

#mihomo-profiles-link:hover {
  animation: routing-help-blink 1s infinite;
}
/* Custom tooltip for XKeen commands */
.command-item::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: calc(100% + 6px);
  padding: 6px 8px;
  border-radius: 8px;
  background: rgba(15, 23, 42, 0.98);
  color: #e5e7eb;
  font-size: 11px;
  line-height: 1.3;
  white-space: normal;
  max-width: 260px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.45);
  opacity: 0;
  pointer-events: none;
  z-index: 40;
}

.command-item::before {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: 100%;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent rgba(15, 23, 42, 0.98) transparent;
  opacity: 0;
  pointer-events: none;
  z-index: 39;
}

.command-item:hover::after,
.command-item:hover::before {
  opacity: 1;
}



/* --- Mihomo generator layout --- */
.xkeen-input {
  width: 100%;
  padding: 6px 8px;
  margin: 4px 0 8px;
  border-radius: 8px;
  border: 1px solid #374151;
  background: #020617;
  color: #e5e7eb;
  box-sizing: border-box;
  font-size: 14px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.xkeen-input:focus {
  outline: none;
  border-color: #60a5fa;
  box-shadow: 0 0 0 1px #1d4ed8;
}

.small-textarea {
  min-height: 120px;
}

.mihomo-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-top: 12px;
}

.mihomo-column {
  flex: 1 1 260px;
  min-width: 260px;
}

.xkeen-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  margin-top: 8px;
}

.xkeen-table th,
.xkeen-table td {
  padding: 6px 8px;
  border-bottom: 1px solid #1f2933;
  text-align: left;
}

.xkeen-table th {
  font-weight: 600;
  color: #d1d5db;
}

.xkeen-table tbody tr:hover {
  background: #020617;
}


/* Xray log filter row */
.log-filter-row {
  margin: 8px 0;
  display: flex;
  gap: 8px;
}

.log-filter-row .xray-log-filter {
  flex: 1;
}


/* Generic small round icon-only buttons (used for Mihomo profiles/backups controls) */
button.icon-btn {
  padding-inline: 10px;
  min-width: 32px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}


/* Backup filename marquee to prevent layout breaking */
.backup-filename-marquee {
  max-width: 220px;
  overflow: hidden;
  position: relative;
  white-space: nowrap;
}

.backup-filename-marquee-inner {
  display: inline-block;
  padding-left: 100%;
  animation: backup-filename-scroll 12s linear infinite;
}

.backup-filename-marquee:hover .backup-filename-marquee-inner {
  animation-play-state: paused;
}

@keyframes backup-filename-scroll {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}


/* Global XKeen overlay spinner */
#global-xkeen-spinner {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.65);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#global-xkeen-spinner.is-active {
  display: flex;
}

.global-spinner-box {
  min-width: 260px;
  max-width: 320px;
  padding: 16px 20px;
  background: #020617;
  border-radius: 12px;
  border: 1px solid #1f2937;
  box-shadow: 0 18px 38px rgba(15, 23, 42, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.global-spinner-icon {
  display: inline-block;
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  border-radius: 999px;
  border: 2px solid rgba(34, 197, 94, 0.35);
  border-top-color: #22c55e;
  animation: xkeen-global-spinner 0.8s linear infinite;
}

.global-spinner-text {
  font-size: 14px;
  color: #e5e7eb;
  text-align: center;
}



.modal-body-logs {
  font-family: monospace;
  font-size: 12px;
}

.log-line {
  line-height: 1.35;
  white-space: pre-wrap;
}
.log-info {
  color: #60a5fa;
}
.log-warn {
  color: #facc15;
}
.log-error {
  color: #f87171;
}
.log-fatal {
  color: #fb7185;
  font-weight: 600;
}
.log-debug {
  color: #9ca3af;
}

/* Дополнительная подсветка для Live Xray logs */
.log-route {
  font-weight: 500;
}

.log-route-tproxy-vless {
  color: #22c55e; /* зелёный: tproxy -> vless-reality */
}

.log-route-redirect-vless {
  color: #38bdf8; /* голубой: redirect -> vless-reality */
}

.log-route-redirect-direct {
  color: #a855f7; /* фиолетовый: redirect -> direct */
}

.log-route-reject {
  color: #f97373; /* красный: reject */
  font-weight: 600;
}

.log-ip {
  color: #fde68a; /* тёплый жёлтый для IP */
}

.log-domain {
  color: #6ee7b7; /* мятный для доменов */
}

/* === Темы: тёмная / светлая === */

html[data-theme="dark"] {
  color-scheme: dark;
}

html[data-theme="light"] {
  color-scheme: light;
}

/* Плавающая кнопка переключения темы (видна на всех страницах) */
.theme-toggle-floating {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 1000;
}

.theme-toggle-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 9999px;
  padding: 4px 10px;
  font-size: 12px;
  line-height: 1;
  border: 1px solid transparent;
  background: transparent;
  cursor: pointer;
}

/* Стиль кнопки в тёмной теме */
html[data-theme="dark"] .theme-toggle-btn {
  background: rgba(15, 23, 42, 0.9);
  border-color: #1f2937;
  color: #e5e7eb;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.7);
}

/* Стиль кнопки в светлой теме в духе macOS */
html[data-theme="light"] .theme-toggle-btn {
  background: rgba(255, 255, 255, 0.8);
  border-color: #d1d5db;
  color: #111827;
  backdrop-filter: blur(12px);
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
}

.theme-toggle-btn:hover {
  transform: translateY(-1px);
}

.theme-toggle-btn:active {
  transform: translateY(0);
}

.theme-toggle-icon {
  font-size: 14px;
}

/* === Светлая тема (маковские оттенки) === */

html[data-theme="light"] body {
  background: #f5f5f7;
  color: #111827;
}

/* Ссылки — синий оттенок как в macOS */
html[data-theme="light"] a {
  color: #0a84ff;
}

html[data-theme="light"] a:hover {
  text-decoration: underline;
}

/* Карточки / панели */
html[data-theme="light"] .card {
  background: #ffffff;
  border-color: #d1d5db;
  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
}

/* Таблицы */
html[data-theme="light"] table {
  background: #ffffff;
}

html[data-theme="light"] th {
  background: #f3f4f6;
  border-bottom-color: #e5e7eb;
}

html[data-theme="light"] td {
  border-bottom-color: #e5e7eb;
}

/* Базовые кнопки */
html[data-theme="light"] button {
  background: #ffffff;
  border-color: #d1d5db;
  color: #111827;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] button:disabled {
  background: #e5e7eb;
  color: #9ca3af;
}

/* Поля ввода и текстовые области */
html[data-theme="light"] input,
html[data-theme="light"] select,
html[data-theme="light"] textarea,
html[data-theme="light"] .xkeen-textarea {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

/* Лампочка статуса */
html[data-theme="light"] .service-status-lamp[data-state="running"] {
  box-shadow: 0 0 6px rgba(34, 197, 94, 0.4);
}

html[data-theme="light"] .service-status-lamp[data-state="stopped"],
html[data-theme="light"] .service-status-lamp[data-state="error"] {
  box-shadow: 0 0 6px rgba(248, 113, 113, 0.4);
}

/* Модальные окна */
html[data-theme="light"] .modal {
  background: #ffffff;
  border-color: #d1d5db;
}

/* === Дополнительные правки светлой темы: более тёмный текст и светлый редактор === */

/* Чуть более контрастный «вторичный» текст */
html[data-theme="light"] .card p,
html[data-theme="light"] .hint,
html[data-theme="light"] .edit-toggle,
html[data-theme="light"] .command-item-desc {
  color: #4b5563;
}

/* YAML-просмотр и CodeMirror в светлой теме */
html[data-theme="light"] .xkeen-textarea,
html[data-theme="light"] .CodeMirror {
  background: #f9fafb;
  color: #111827;
  border-color: #d1d5db;
  box-shadow: 0 1px 0 rgba(15, 23, 42, 0.03);
}

/* Сделать тему material-darker светлой, когда включена светлая тема панели */
html[data-theme="light"] .cm-s-material-darker.CodeMirror {
  background: #f9fafb;
  color: #111827;
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-gutters {
  background: #f3f4f6;
  border-right: 1px solid #e5e7eb;
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-cursor {
  border-left: 1px solid #111827;
}

/* Нейтральные цвета подсветки для YAML */
html[data-theme="light"] .cm-s-material-darker .cm-comment {
  color: #6b7280;
}

html[data-theme="light"] .cm-s-material-darker .cm-keyword {
  color: #7c3aed;
}

html[data-theme="light"] .cm-s-material-darker .cm-atom,
html[data-theme="light"] .cm-s-material-darker .cm-number,
html[data-theme="light"] .cm-s-material-darker .cm-variable-2,
html[data-theme="light"] .cm-s-material-darker .cm-variable-3,
html[data-theme="light"] .cm-s-material-darker .cm-tag,
html[data-theme="light"] .cm-s-material-darker .cm-attribute,
html[data-theme="light"] .cm-s-material-darker .cm-qualifier {
  /* Более тёмный и контрастный зелёный для YAML-маркеров (*, & и т.п.) */
  color: #047857;
}

html[data-theme="light"] .cm-s-material-darker .cm-string {
  color: #b91c1c;
}

html[data-theme="light"] .cm-s-material-darker .cm-def,
html[data-theme="light"] .cm-s-material-darker .cm-property,
html[data-theme="light"] .cm-s-material-darker .cm-variable {
  color: #1f2937;
}

/* Выделение текста в редакторе на светлой теме */
html[data-theme="light"] .cm-s-material-darker .CodeMirror-selected,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line::selection,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line > span::selection,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-line > span > span::selection {
  background: rgba(148, 163, 184, 0.35) !important;
}

/* Light theme: softer selection (avoid "dirty" dark blocks) */
html[data-theme="light"] .xkeen-cm .CodeMirror-selected,
html[data-theme="light"] .xkeen-cm .CodeMirror-line::selection,
html[data-theme="light"] .xkeen-cm .CodeMirror-line > span::selection,
html[data-theme="light"] .xkeen-cm .CodeMirror-line > span > span::selection {
  background: rgba(10, 132, 255, 0.22) !important;
}
html[data-theme="light"] .xkeen-cm ::selection {
  background: rgba(10, 132, 255, 0.22) !important;
}


/* Светлая тема: make CodeMirror cosmetics clearly visible */
html[data-theme="light"] .cm-s-material-darker .cm-matchhighlight,
html[data-theme="light"] .xkeen-cm .cm-matchhighlight {
  background: rgba(59, 130, 246, 0.14);
}

html[data-theme="light"] .cm-s-material-darker .cm-trailingspace,
html[data-theme="light"] .xkeen-cm .cm-trailingspace {
  background: rgba(220, 38, 38, 0.16);
}

html[data-theme="light"] .cm-s-material-darker .CodeMirror-ruler,
html[data-theme="light"] .xkeen-cm .CodeMirror-ruler {
  border-left-color: rgba(17, 24, 39, 0.12);
}


/* === Светлая тема: читаемые «Команды» и модальные окна === */

/* Заголовок и группы команд в светлой теме */
html[data-theme="light"] .commands-header h2 {
  color: #111827;
}

html[data-theme="light"] .command-group-title {
  color: #6b7280;
}

/* Плашки команд в светлой теме */
html[data-theme="light"] .command-item {
  background: #f9fafb;
  border-color: #e5e7eb;
  color: #111827;
}

html[data-theme="light"] .command-item-code code {
  color: #374151;
}

html[data-theme="light"] .command-item-desc {
  color: #4b5563;
}

html[data-theme="light"] .command-item:hover {
  background: #eff6ff;
  border-color: #3b82f6;
}

/* Модальные окна в светлой теме */
html[data-theme="light"] .modal {
  background: rgba(15, 23, 42, 0.35);
}

html[data-theme="light"] .modal-content {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
  box-shadow: 0 20px 45px rgba(15, 23, 42, 0.18);
}

html[data-theme="light"] .modal-header {
  border-bottom-color: #e5e7eb;
}

html[data-theme="light"] .modal-close {
  color: #6b7280;
}

html[data-theme="light"] .modal-close:hover {
  color: #111827;
}

html[data-theme="light"] .modal-body-logs {
  background: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  color: #111827;
}


/* Light theme: make CodeMirror scroll area background light */
html[data-theme="light"] .CodeMirror-scroll {
  background-color: #f9fafb;
}


/* === Светлая тема: логи и JSON-редактор === */

/* Live логи Xray, перезапуск и нижний журнал */
html[data-theme="light"] .log-block {
  background: #f9fafb;
  color: #111827;
  border-color: #e5e7eb;
}

/* Терминал (нижний журнал в разделе Команды) */
html[data-theme="light"] .terminal-output {
  background: #f9fafb;
  color: #111827;
  border-color: #e5e7eb;
}

/* Поля фильтра / выбора в блоке Live логи Xray */
html[data-theme="light"] .xray-log-filter,
html[data-theme="light"] .xray-log-select {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

/* Модальный JSON-редактор 03_inbounds.json / 04_outbounds.json */
html[data-theme="light"] #json-editor-textarea {
  background: #f9fafb;
  color: #111827;
  border-color: #d1d5db;
}

/* Светлая тема: мини-терминал в разделе Команды */
html[data-theme="light"] .terminal-window {
  background: #ffffff;
  border-color: #e5e7eb;
  box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
}

html[data-theme="light"] .terminal-command {
  background: #f9fafb;
  color: #111827;
  border-color: #e5e7eb;
}

html[data-theme="light"] .terminal-search-input {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

html[data-theme="light"] .terminal-search-btn {
  background: rgba(248, 250, 252, 0.9);
  color: #111827;
  border-color: rgba(15, 23, 42, 0.16);
}

html[data-theme="light"] .terminal-search-btn:hover {
  background: rgba(226, 232, 240, 0.9);
}

html[data-theme="light"] .terminal-input {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}

html[data-theme="light"] .terminal-tool-btn {
  background: rgba(248, 250, 252, 0.9);
  color: #111827;
  border-color: rgba(15, 23, 42, 0.16);
}

html[data-theme="light"] .terminal-tool-btn:hover {
  background: rgba(226, 232, 240, 0.9);
}

/* Светлая тема: режим работы inbounds */
html[data-theme="light"] .mode-item {
  background: #f9fafb;
  border-color: #e5e7eb;
}

html[data-theme="light"] .mode-item strong {
  color: #111827;
}

html[data-theme="light"] .mode-item small {
  color: #4b5563;
}

html[data-theme="light"] .toggle {
  color: #4b5563;
}

/* Светлая тема: VLESS URL (04_outbounds.json) */
html[data-theme="light"] #outbounds-url {
  background: #ffffff;
  color: #111827;
  border-color: #d1d5db;
}


/* Светлая тема: кнопка переключения ядра и бейдж времени загрузки */
html[data-theme="light"] .service-core-text {
  background: rgba(255, 255, 255, 0.9);
  border-color: #d1d5db;
  color: #111827;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
}

html[data-theme="light"] .service-core-text.has-core {
  border-color: #0a84ff;
  box-shadow: 0 0 0 1px rgba(10, 132, 255, 0.4);
  background: rgba(255, 255, 255, 0.95);
}

html[data-theme="light"] .last-load-badge {
  background: rgba(243, 244, 246, 0.9);
  border-color: #e5e7eb;
  color: #4b5563;
}

/* Светлая тема: ховер строк таблиц (в т.ч. профили/бэкапы Mihomo) */
html[data-theme="light"] tbody tr:hover {
  background: #f3f4f6;
}



/* Подсветка текущей строки в редакторах CodeMirror (как в современных IDE) */
.cm-s-material-darker .CodeMirror-activeline-background,
.xkeen-cm .CodeMirror-activeline-background {
  background: #111827;
}


/* Light theme: active line highlight must be light (avoid dark bars) */
html[data-theme="light"] .xkeen-cm .CodeMirror-activeline-background,
html[data-theme="light"] .cm-s-material-darker .CodeMirror-activeline-background,
html[data-theme="light"] .cm-s-default .CodeMirror-activeline-background {
  background: rgba(15, 23, 42, 0.06);
}



/* Indent guides rendered via overlay (spaces & tabs at line start). */
.xkeen-cm .cm-indent-guide {
  position: relative;
}

.xkeen-cm .cm-indent-guide::before {
  content: "";
  position: absolute;
  left: 0;
  top: -2px;
  bottom: -2px;
  border-left: 1px solid rgba(55, 65, 81, 0.8);
  opacity: 0.9;
}
/* Вертикальные направляющие отступов (indent guides) для JSON/YAML редакторов */
.xkeen-cm .CodeMirror-code .cm-tab {
  position: relative;
}

.xkeen-cm .CodeMirror-code .cm-tab::before {
  content: "";
  position: absolute;
  left: 0;
  top: -2px;
  bottom: -2px;
  border-left: 1px solid rgba(55, 65, 81, 0.85);
  opacity: 0.7;
}


/* Light theme: indent guides should be subtle */
html[data-theme="light"] .xkeen-cm .cm-indent-guide::before,
html[data-theme="light"] .xkeen-cm .CodeMirror-code .cm-tab::before {
  border-left-color: rgba(17, 24, 39, 0.12);
  opacity: 0.7;
}





html[data-theme="light"] .terminal-conn-badge {
  background: rgba(255, 255, 255, 0.75);
  color: #334155;
}

html[data-theme="light"] .terminal-uptime {
  color: #475569;
}
