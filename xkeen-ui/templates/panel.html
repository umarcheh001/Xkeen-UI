<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Xkeen UI ‚Äî Routing / Inbounds / Outbounds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CodeMirror & JSON lint -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/shell/shell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/yaml/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/json-lint.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <header>
      <h1>Xkeen UI</h1>
      <p>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —Ä–µ–∂–∏–º inbounds –∏ VLESS outbounds –≤ –æ–¥–Ω–æ–π –ø–∞–Ω–µ–ª–∏.</p>

      <div class="top-tabs">
        <button class="top-tab-btn active" data-view="routing" onclick="showView('routing')">
          –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (05_routing.json)
        </button>
        <button class="top-tab-btn" data-view="mihomo" onclick="showView('mihomo')">
          Mihomo config.yaml
        </button>
        <button class="top-tab-btn" data-view="xkeen" onclick="showView('xkeen')">
          –ü–æ—Ä—Ç—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è XKeen
        </button>
        <button class="top-tab-btn" data-view="commands" onclick="showView('commands')">
          –ö–û–ú–ê–ù–î–´ XKeen
        </button>
      </div>
    </header>

    <div id="view-routing" class="view-section">
<!-- Routing editor + Mihomo config -->
    <div class="layout-2col">
      <div class="layout-main">

        <!-- –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –±–ª–æ–∫ routing -->
        <section class="card">
          <div class="commands-header" onclick="toggleRoutingCard()">
            <h2>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (05_routing.json)</h2>
            <span id="routing-arrow">‚ñº</span>
          </div>

          <div id="routing-body">
            <p>–§–∞–π–ª: <code>{{ routing_file }}</code></p>

            <textarea id="routing-editor" spellcheck="false"></textarea>

            <div id="routing-error" class="error"></div>

            <div class="actions">
              <button id="routing-save-btn" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å routing</button>
              <button id="routing-format-btn">‚ú® –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç JSON</button>
              <button id="routing-strip-btn">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
              <button id="routing-sort-btn">üìë –£–ø–æ—Ä—è–¥–æ—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞</button>
              <button id="routing-backup-btn">üì¶ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø</button>
              <button id="routing-restore-auto-btn">‚è™ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å routing –∏–∑ –∞–≤—Ç–æ-–±—ç–∫–∞–ø–∞</button>
              <button id="routing-restart-btn">‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å xkeen</button>
            </div>

            <div id="routing-status" class="status"></div>
          </div>
        </section>

        

      </div>

      <div class="layout-side">


    <!-- Inbounds mode -->
    <section class="card">
      <h2>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã inbounds (03_inbounds.json)</h2>
      <p>–§–∞–π–ª: <code>{{ inbounds_file }}</code></p>

      <div class="inbounds-modes">
        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="mixed">
          <div>
            <strong>Mixed</strong><br>
            <small>UDP —á–µ—Ä–µ–∑ TProxy, TCP —á–µ—Ä–µ–∑ Redirect. –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º).</small>
          </div>
        </label>

        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="tproxy">
          <div>
            <strong>TProxy</strong><br>
            <small>TCP+UDP —á–µ—Ä–µ–∑ TProxy. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –Ω–æ —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –∏ —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–∏–π.</small>
          </div>
        </label>

        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="redirect">
          <div>
            <strong>Redirect</strong><br>
            <small>–¢–æ–ª—å–∫–æ TCP —á–µ—Ä–µ–∑ Redirect. –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–≥—Ä –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.</small>
          </div>
        </label>
      </div>

      <label class="toggle">
        <input type="checkbox" id="inbounds-autorestart" checked>
        –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å xkeen –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞
      </label>

      <div class="actions">
        <button id="inbounds-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∂–∏–º inbounds</button>
        <button id="inbounds-backup-btn">üì¶ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø 03_inbounds.json</button>
        <button id="inbounds-restore-auto-btn">‚è™ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 03_inbounds.json –∏–∑ –∞–≤—Ç–æ-–±—ç–∫–∞–ø–∞</button>
      </div>

      <div id="inbounds-status" class="status"></div>
    </section>

    <!-- Outbounds VLESS editor -->
    <section class="card">
      <h2>–ü—Ä–æ–∫—Å–∏ (04_outbounds.json)</h2>
      <p>–§–∞–π–ª: <code>{{ outbounds_file }}</code></p>
      <p>–£–∫–∞–∂–∏ VLESS —Å—Å—ã–ª–∫—É, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω –∫–æ–Ω—Ñ–∏–≥ outbounds.</p>

      <input id="outbounds-url" type="text" placeholder="vless://uuid@host:port?encryption=none&flow=xtls-rprx-vision&security=reality&pbk=...&sni=...&fp=chrome&sid=...&spx=%2F">

      <div class="actions">
        <button id="outbounds-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å VLESS —Å—Å—ã–ª–∫—É</button>
        <button id="outbounds-backup-btn">üì¶ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø 04_outbounds.json</button>
        <button id="outbounds-restore-auto-btn">‚è™ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 04_outbounds.json –∏–∑ –∞–≤—Ç–æ-–±—ç–∫–∞–ø–∞</button>
      </div>

      <div id="outbounds-status" class="status"></div>
    </section>

    <!-- Backups list -->
    <section class="card">
      <h2>–ë—ç–∫–∞–ø—ã Xray –∫–æ–Ω—Ñ–∏–≥–æ–≤ (routing / inbounds / outbounds)</h2>
      <p>–ö–∞—Ç–∞–ª–æ–≥ –±—ç–∫–∞–ø–æ–≤: <code>{{ backup_dir }}</code></p>

      <table id="backups-table">
        <thead>
          <tr>
            <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
            <th>–†–∞–∑–º–µ—Ä</th>
            <th>–°–æ–∑–¥–∞–Ω</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <div id="backups-status" class="status"></div>

      <div class="hint">
        <a href="/backups">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±—ç–∫–∞–ø–æ–≤ ‚Üí</a>
      </div>
    </section>

    <!-- Help block -->
    <section class="card">
      <h2>–°–ø—Ä–∞–≤–∫–∞ –∏ —Å—Å—ã–ª–∫–∏</h2>
      <ul class="links">
        <li><a href="https://github.com/Corvus-Malus/XKeen" target="_blank" rel="noopener">GitHub Corvus-Malus/XKeen</a></li>
        <li><a href="https://jameszero.net/faq-xkeen.htm" target="_blank" rel="noopener">FAQ –ø–æ XKeen (jameszero.net)</a></li>
        <li><a href="https://t.me/c/2138190368/23" target="_blank" rel="noopener">Telegram —á–∞—Ç XKeen</a></li>
        <li><a href="https://github.com/jameszeroX/XKeen" target="_blank" rel="noopener">GitHub jameszeroX/XKeen</a></li>
        <li><a href="https://github.com/jameszeroX/XKeen/tree/main/test" target="_blank" rel="noopener">XKeen beta</a></li>
      </ul>
    </section>




    




      

      </div>
    </div>
</div>

<div id="view-mihomo" class="view-section" style="display:none;">
  <!-- –ù–æ–≤—ã–π —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –±–ª–æ–∫ –¥–ª—è Mihomo config.yaml -->
        <section class="card">
          <div class="commands-header" onclick="toggleMihomoCard()">
            <h2>Mihomo config.yaml</h2>
            <span id="mihomo-arrow">‚ñº</span>
          </div>

          <div id="mihomo-body">
            <p>–§–∞–π–ª: <code>/opt/etc/mihomo/config.yaml</code></p>

            <textarea id="mihomo-editor" spellcheck="false"></textarea>

            <div id="mihomo-status" class="status"></div>

            <div class="actions">
              <button id="mihomo-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å config.yaml</button>
              <button id="mihomo-template-btn">üÜï –ù–æ–≤—ã–π config (—à–∞–±–ª–æ–Ω umarcheh001)</button>
              <button id="mihomo-restart-btn">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å xkeen</button>

              <button id="mihomo-configurator-btn"
                      data-configurator-url="{{ url_for('static', filename='mihomo-configurator.html') }}">
                üß© –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä
              </button>
            </div>

            <div class="actions mihomo-templates-row">
              <label for="mihomo-template-select">–®–∞–±–ª–æ–Ω—ã:</label>
              <select id="mihomo-template-select" class="mihomo-template-select"></select>
              <button id="mihomo-templates-refresh-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
              <button id="mihomo-template-load-btn">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä</button>
              <button id="mihomo-template-savefromeditor-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞–∫ —à–∞–±–ª–æ–Ω</button>
            </div>

            <div class="hint">
              <p>–®–∞–±–ª–æ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ <code>/opt/etc/mihomo/templates</code>. –ú–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å —Ç—É–¥–∞ —Å–≤–æ–∏ <code>.yaml</code> –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏–∑ –ø–∞–Ω–µ–ª–∏.</p>
              <p>–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –ø—Ä–∞–≤–∏–ª –∏ –ª–∏—Å—Ç–∞–º–∏:</p>
              <ul>
                <li><a href="https://github.com/Anton111111/rule-lists/releases" target="_blank" rel="noopener">Anton111111 / rule-lists</a></li>
                <li><a href="https://github.com/legiz-ru/mihomo-rule-sets" target="_blank" rel="noopener">legiz-ru / mihomo-rule-sets</a></li>
                <li><a href="https://github.com/MetaCubeX/meta-rules-dat" target="_blank" rel="noopener">MetaCubeX / meta-rules-dat</a></li>
                <li><a href="https://github.com/v2fly/domain-list-community/tree/master/data" target="_blank" rel="noopener">v2fly / domain-list-community</a></li>
              </ul>
            </div>
          </div>
        </section>
</div>

<div id="view-xkeen" class="view-section" style="display:none;">
  <!-- XKeen: –ø–æ—Ä—Ç—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è -->
      <section class="card commands-card">
        <div class="commands-header" onclick="toggleXkeenSettings()">
          <h2>–ü–æ—Ä—Ç—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è XKeen</h2>
          <span id="xkeen-arrow">‚ñº</span>
        </div>
        <div id="xkeen-body">
          <p>–§–∞–π–ª—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ <code>/opt/etc/xkeen</code>:</p>

          <h3>port_proxying.lst</h3>
          <p class="small">
            –ü–æ—Ä—Ç—ã –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏.
          </p>
          <textarea id="port-proxying-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:\n80\n443\n596:599\n–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø–æ—Ä—Ç –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤."></textarea>
          <div class="actions">
            <button id="port-proxying-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å port_proxying.lst</button>
          </div>
          <div id="port-proxying-status" class="status"></div>

          <hr>

          <h3>port_exclude.lst</h3>
          <p class="small">
            –ü–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.<br>
            <strong>–í–∞–∂–Ω–æ:</strong> –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º—ã—Ö –ø–æ—Ä—Ç–æ–≤ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–ª—å–∑—è,
            –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ—Ä—Ç–æ–≤ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.
          </p>
          <textarea id="port-exclude-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ü–æ—Ä—Ç—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.\n–ù–∞–ø—Ä–∏–º–µ—Ä:\n22\n25\n80:89"></textarea>
          <div class="actions">
            <button id="port-exclude-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å port_exclude.lst</button>
          </div>
          <div id="port-exclude-status" class="status"></div>

          <hr>

          <h3>ip_exclude.lst</h3>
          <p class="small">
            IP –∏ –ø–æ–¥—Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ).
          </p>
          <textarea id="ip-exclude-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:\n192.168.0.0/16\n2001:db8::/32"></textarea>
          <div class="actions">
            <button id="ip-exclude-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ip_exclude.lst</button>
          </div>
          <div id="ip-exclude-status" class="status"></div>
        </div>
      </section>
</div>

<div id="view-commands" class="view-section" style="display:none;">
  <!-- XKeen commands -->
<section class="card commands-card">
  <div class="commands-header" onclick="toggleCommands()">
    <h2>–ö–û–ú–ê–ù–î–´ XKeen</h2>
    <span id="commands-arrow">‚ñº</span>
  </div>

  <div id="commands-body" style="display: none;">
  {% for group in command_groups %}
    <div class="command-group">
      <div class="command-group-title">{{ group.title }}</div>
      <ul class="command-list">
        {% for cmd in group['items'] %}
          <li class="command-item"
              data-flag="{{ cmd.flag }}"
              data-label="xkeen {{ cmd.flag }}"
              data-command="{{ (cmd.flag ~ ' ' ~ cmd.desc)|lower }}">
            <div class="command-item-top">
              <span class="command-item-icon">‚ñ∂</span>
              <span class="command-item-code"><code>xkeen {{ cmd.flag }}</code></span>
            </div>
            <div class="command-item-desc">{{ cmd.desc }}</div>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
  </div>
</section>
  <!-- Restart log -->
    <section class="card log-card">
      <div class="log-header-row">
        <h2>–ñ—É—Ä–Ω–∞–ª</h2>
        <div class="log-header-actions">
          <button type="button" class="btn-secondary log-btn" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button type="button" class="btn-secondary log-btn" onclick="copyLog()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
      <pre id="restart-log" class="log-block"></pre>
    </section>
</div>



    <!-- –ú–∏–Ω–∏-—Ç–µ—Ä–º–∏–Ω–∞–ª XKeen -->
    <div id="terminal-overlay" class="terminal-overlay" style="display:none;">
      <div class="terminal-window">
        <div class="terminal-header">
          <span>–¢–µ—Ä–º–∏–Ω–∞–ª XKeen</span>
          <button type="button" class="terminal-close" onclick="hideTerminal()">√ó</button>
        </div>
        <input id="terminal-command" class="terminal-command" type="text" readonly>
        <pre id="terminal-output" class="terminal-output"></pre>
        <div class="terminal-input-row">
          <input id="terminal-input"
                 class="terminal-input"
                 type="text"
                 placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: yes). –ü—É—Å—Ç–æ ‚Äî –ø—Ä–æ—Å—Ç–æ Enter.">
          <button type="button" class="terminal-send" onclick="sendTerminalInput()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>


    <footer>
      <small>Xkeen UI ‚Äî /opt/etc/xray/configs/03_inbounds.json, 04_outbounds.json, 05_routing.json</small>
    </footer>
  </div>

  <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
