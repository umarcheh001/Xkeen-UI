<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Xkeen UI ‚Äî Routing / Inbounds / Outbounds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-token" content="{{ csrf_token }}">

  <!-- CodeMirror & JSON lint -->

  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/codemirror.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/theme/material-darker.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/addon/lint/lint.min.css') }}">

  <script src="{{ url_for('static', filename='codemirror/codemirror.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/display/indent-guides.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/selection/active-line.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/edit/matchbrackets.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/mode/javascript/javascript.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/mode/shell/shell.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/mode/yaml/yaml.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/lint/lint.min.js') }}"></script>
  <script src="{{ url_for('static', filename='jsonlint/jsonlint.min.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/lint/json-lint.min.js') }}"></script>
  <!-- CodeMirror addons: folding, search, dialog, autoclose -->
  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/addon/fold/foldgutter.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/addon/dialog/dialog.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/addon/display/fullscreen.css') }}">

  <script src="{{ url_for('static', filename='codemirror/addon/fold/foldcode.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/fold/brace-fold.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/fold/indent-fold.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/fold/foldgutter.js') }}"></script>

  <script src="{{ url_for('static', filename='codemirror/addon/search/searchcursor.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/search/search.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/search/match-highlighter.js') }}"></script>

  <script src="{{ url_for('static', filename='codemirror/addon/dialog/dialog.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/edit/closebrackets.js') }}"></script>

  <!-- Quality-of-life addons: fullscreen, comments, trailing spaces, rulers -->
  <script src="{{ url_for('static', filename='codemirror/addon/display/fullscreen.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/comment/comment.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/comment/continuecomment.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/fold/comment-fold.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/mode/overlay.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/edit/trailingspace.js') }}"></script>
  <script src="{{ url_for('static', filename='codemirror/addon/display/rulers.js') }}"></script>



<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <!-- XTerm.js –¥–ª—è –≤–µ–±-—Ç–µ—Ä–º–∏–Ω–∞–ª–∞ XKeen (–ª–æ–∫–∞–ª—å–Ω–æ –∏–∑ static/xterm) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='xterm/xterm.css') }}">
  <script src="{{ url_for('static', filename='xterm/xterm.js') }}"></script>
  <script src="{{ url_for('static', filename='xterm/xterm-addon-fit.js') }}"></script>
  <!-- XTerm.js official addons (–ª–æ–∫–∞–ª—å–Ω–æ) -->
  <script src="{{ url_for('static', filename='xterm/xterm-addon-search.js') }}"></script>
  <script src="{{ url_for('static', filename='xterm/xterm-addon-web-links.js') }}"></script>
</head>
<body>
  <div id="global-xkeen-spinner">
    <div class="global-spinner-box">
      <div class="global-spinner-icon"></div>
      <div class="global-spinner-text" id="global-xkeen-spinner-text">
        –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º xkeen‚Ä¶
      </div>
    </div>
  </div>


  <div class="container">
    <header>
      <div class="header-main">
        <div class="header-title-group">
          <h1>Xkeen UI</h1>
          <span
            id="xkeen-service-lamp"
            class="service-status-lamp"
            data-state="pending"
            title="–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
          ></span>
          <span id="xkeen-service-text" class="service-status-text">
            –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
          </span>
        </div>

        <div class="header-center">
          <button
            id="xkeen-core-text"
            type="button"
            class="service-core-text"
          ></button>
        </div>

        <div class="header-right">
          <div class="header-actions">
            <button
              type="button"
              id="theme-toggle-btn"
              class="theme-toggle-btn theme-toggle-header"
              aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
            ></button>

            <a
              href="{{ url_for('logout') }}"
              class="service-core-text"
              title="–í—ã–π—Ç–∏ –∏–∑ –ø–∞–Ω–µ–ª–∏"
            >–í—ã–π—Ç–∏</a>
          </div>
        </div>
      </div>

      <p>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —Ä–µ–∂–∏–º inbounds –∏ VLESS outbounds –≤ –æ–¥–Ω–æ–π –ø–∞–Ω–µ–ª–∏.</p>

<div class="top-tabs">
        <button class="top-tab-btn active" data-view="routing">
          –†–æ—É—Ç–∏–Ω–≥ Xray
        </button>
        <button class="top-tab-btn" data-view="mihomo">
          –†–æ—É—Ç–∏–Ω–≥ Mihomo
        </button>
        <button class="top-tab-btn" data-view="xkeen">
          –ü–æ—Ä—Ç—ã –∏ –ò—Å–∫–ª—é—á–µ–Ω–∏—è
        </button>
        <button class="top-tab-btn" data-view="xray-logs">
          Live –ª–æ–≥–∏ Xray
        </button>
        <button class="top-tab-btn" data-view="commands">
          –ö–æ–º–∞–Ω–¥—ã
        </button>
        <button class="top-tab-btn" type="button" onclick="window.location.href='/mihomo_generator'">
          Mihomo –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä
        </button>
      </div>
    
<div class="xkeen-ctrl-row">
  <div class="xkeen-ctrl-group">
    <button id="xkeen-start-btn" class="xkeen-ctrl-btn">Start xkeen</button>
    <button id="xkeen-stop-btn" class="xkeen-ctrl-btn">Stop xkeen</button>
    <button id="xkeen-restart-btn" class="xkeen-ctrl-btn">Restart xkeen</button>
  </div>
  <div class="global-toggle-right">
    <label class="global-autorestart-toggle">
      <input type="checkbox" id="global-autorestart-xkeen" checked>
      <span>–ê–≤—Ç–æ‚Äë–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ xkeen</span>
    </label>
    <div id="last-load" class="last-load-badge"></div>
  </div>
</div>

</header>

    <div id="view-routing" class="view-section">
<!-- Routing editor + Mihomo config -->
    <div class="layout-2col">
      <div class="layout-main">

        <!-- –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –±–ª–æ–∫ routing -->
        <section class="card">
          <div class="commands-header" id="routing-header">
            <h2>–†–æ—É—Ç–∏–Ω–≥ Xray</h2>
            <span id="routing-arrow">‚ñº</span>
          </div>

          <div id="routing-body">
            <p>–§–∞–π–ª: <code>{{ routing_file }}</code></p>

            <div id="routing-help-line">üí° –°–ø—Ä–∞–≤–∫–∞</div>

            <textarea id="routing-editor" spellcheck="false"></textarea>

            <div id="routing-error" class="error"></div>

            <div class="actions">
  <button id="routing-save-btn">üíæ Save routing</button>
  <button id="routing-format-btn">‚ú® Format JSON</button>
  <button id="routing-backup-btn">üì¶ Backup</button>
  <button id="routing-restore-auto-btn">‚è™ Restore autobackup</button>
  <button id="routing-export-local-btn">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç</button>
  <button id="routing-import-local-btn">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç</button>
</div>

<input type="file"
       id="local-config-file-input"
       accept="application/json"
       style="display:none">


            <div class="actions">
              <button id="github-export-btn">‚¨ÜÔ∏è –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä–∏–π</button>
              <button id="github-open-catalog-btn">üìÇ –ö–∞—Ç–∞–ª–æ–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</button>
            </div>

            <div id="routing-status" class="status"></div>
          </div>
</section>

        

      </div>

      <div class="layout-side">


    <!-- Inbounds mode -->
    <section class="card">
      <div class="commands-header" id="inbounds-header">
        <h2>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã inbounds (03_inbounds.json)</h2>
        <span id="inbounds-arrow">‚ñº</span>
      </div>

      <div id="inbounds-body" style="display:none;">
      <p>–§–∞–π–ª: <code>{{ inbounds_file }}</code></p>

      <div class="inbounds-modes">
        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="mixed">
          <div>
            <strong>Mixed</strong><br>
            <small>UDP —á–µ—Ä–µ–∑ TProxy, TCP —á–µ—Ä–µ–∑ Redirect. –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º).</small>
          </div>
        </label>

        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="tproxy">
          <div>
            <strong>TProxy</strong><br>
            <small>TCP+UDP —á–µ—Ä–µ–∑ TProxy. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –Ω–æ —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –∏ —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–∏–π.</small>
          </div>
        </label>

        <label class="mode-item">
          <input type="radio" name="inbounds_mode" value="redirect">
          <div>
            <strong>Redirect</strong><br>
            <small>–¢–æ–ª—å–∫–æ TCP —á–µ—Ä–µ–∑ Redirect. –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–≥—Ä –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.</small>
          </div>
        </label>
      </div>

      <label class="toggle">
        <input type="checkbox" id="inbounds-autorestart" checked>
        –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å xkeen –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞
      </label>

      <div class="actions">
        <button id="inbounds-open-editor-btn">üìù –û—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ</button>
        <button id="inbounds-save-btn">üíæ Save inbounds</button>
        <button id="inbounds-backup-btn">üì¶ Backup 03_inbounds.json</button>
        <button id="inbounds-restore-auto-btn">‚è™ Restore inbounds</button>
      </div>

      <div id="inbounds-status" class="status"></div>
      </div>
    </section>

    <!-- Outbounds VLESS editor -->
    <section class="card">
      <div class="commands-header" id="outbounds-header">
        <h2>–ü—Ä–æ–∫—Å–∏ (04_outbounds.json)</h2>
        <span id="outbounds-arrow">‚ñº</span>
      </div>

      <div id="outbounds-body" style="display:none;">
      <p>–§–∞–π–ª: <code>{{ outbounds_file }}</code></p>
      <p>–£–∫–∞–∂–∏ VLESS —Å—Å—ã–ª–∫—É, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω –∫–æ–Ω—Ñ–∏–≥ outbounds.</p>

      <input id="outbounds-url" type="text" placeholder="vless://uuid@host:port?encryption=none&flow=xtls-rprx-vision&security=reality&pbk=...&sni=...&fp=chrome&sid=...&spx=%2F">

      <div class="actions">
        <button id="outbounds-open-editor-btn">üìù –û—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ</button>
        <button id="outbounds-save-btn">üíæ Save VLESS</button>
        <button id="outbounds-backup-btn">üì¶ Backup 04_outbounds.json</button>
        <button id="outbounds-restore-auto-btn">‚è™ Restore outbounds</button>
      </div>

      <div id="outbounds-status" class="status"></div>
      </div>
    </section>

    <!-- Backups list -->
    <section class="card">
      <h2>–ë—ç–∫–∞–ø—ã Xray –∫–æ–Ω—Ñ–∏–≥–æ–≤ (routing / inbounds / outbounds)</h2>
      <p>–ö–∞—Ç–∞–ª–æ–≥ –±—ç–∫–∞–ø–æ–≤: <code>{{ backup_dir }}</code></p>

      <table id="backups-table">
        <thead>
          <tr>
            <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
            <th>–†–∞–∑–º–µ—Ä</th>
            <th>–°–æ–∑–¥–∞–Ω</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <div id="backups-status" class="status"></div>

      <div class="hint">
        <a href="/backups">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –±—ç–∫–∞–ø–æ–≤ ‚Üí</a>
      </div>
    </section>

    <!-- Help block -->
    <section class="card">
      <h2>–°–ø—Ä–∞–≤–∫–∞ –∏ —Å—Å—ã–ª–∫–∏</h2>
      <ul class="links">
        <li><a href="https://github.com/Corvus-Malus/XKeen" target="_blank" rel="noopener">GitHub Corvus-Malus/XKeen</a></li>
        <li><a href="https://jameszero.net/faq-xkeen.htm" target="_blank" rel="noopener">FAQ –ø–æ XKeen (jameszero.net)</a></li>
        <li><a href="https://t.me/c/2138190368/23" target="_blank" rel="noopener">Telegram —á–∞—Ç XKeen</a></li>
        <li><a href="https://github.com/jameszeroX/XKeen" target="_blank" rel="noopener">GitHub jameszeroX/XKeen</a></li>
        <li><a href="https://github.com/jameszeroX/XKeen/tree/main/test" target="_blank" rel="noopener">XKeen beta</a></li>
      </ul>
    </section>




    




      

      </div>
    </div>
</div>

<div id="view-mihomo" class="view-section" style="display:none;">
  <section class="card">
    <div class="commands-header" onclick="toggleMihomoCard()">
      <h2>–†–æ—É—Ç–∏–Ω–≥ Mihomo</h2>
      <span id="mihomo-arrow">‚ñº</span>
    </div>

    <div id="mihomo-body">
      <p class="small">
        –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª: <code>/opt/etc/mihomo/config.yaml</code>
      </p>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä config.yaml -->
      <textarea id="mihomo-editor" spellcheck="false"></textarea>
      <div id="mihomo-status" class="status"></div>

      <!-- –®–∞–±–ª–æ–Ω—ã config.yaml -->
      <div class="actions mihomo-templates-row">
        <select id="mihomo-template-select" class="mihomo-template-select">
          <option value="">‚Äî –≤—ã–±–µ—Ä–∏ —à–∞–±–ª–æ–Ω ‚Äî</option>
        </select>

        <button id="mihomo-template-load-btn"
                type="button"
                title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω">
          üìÇ –®–∞–±–ª–æ–Ω
        </button>

        <button id="mihomo-load-btn"
                title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–π config.yaml">
          üì• –ö–æ–Ω—Ñ–∏–≥
        </button>
        <button id="mihomo-save-btn"
                title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (–∞–≤—Ç–æ‚Äë–±—ç–∫–∞–ø, –∞–≤—Ç–æ‚Äë–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ –≥–∞–ª–∫–µ)">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
        <button id="mihomo-validate-btn"
                type="button"
                title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å config.yaml —á–µ—Ä–µ–∑ mihomo (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)">
          ü©∫ –ü—Ä–æ–≤–µ—Ä–∫–∞
        </button>
        <button id="mihomo-save-restart-btn"
                title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å mihomo">
          üíæüí• –†–µ—Å—Ç–∞—Ä—Ç
        </button>
      </div>

      <hr>

      
      
<!-- –ü—Ä–æ—Ñ–∏–ª–∏ –∏ –±—ç–∫–∞–ø—ã Mihomo -->
      <div class="commands-header" id="mihomo-profiles-link" style="cursor:pointer;">
        <h3>üóÇÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏ –∏ –±—ç–∫–∞–ø—ã Mihomo</h3>
        <span id="mihomo-profiles-arrow">‚ñº</span>
      </div>

      <div id="mihomo-profiles-panel" style="display:none; margin-top:8px;">
        <div class="mihomo-grid">
          <div class="mihomo-column">
            <h4>–ü—Ä–æ—Ñ–∏–ª–∏</h4>
            <div class="actions">
              <button id="mihomo-refresh-profiles-btn" class="icon-btn">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
              </button>
            </div>
            <table class="xkeen-table">
              <thead>
                <tr>
                  <th>–ü—Ä–æ—Ñ–∏–ª—å</th>
                  <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                  <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="mihomo-profiles-list"></tbody>
            </table>

            <h5 style="margin-top:12px;">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h5>
            <input id="mihomo-new-profile-name"
                   class="xkeen-input"
                   type="text"
                   placeholder="–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è (–±–µ–∑ .yaml)">
            <button id="mihomo-save-profile-btn"
                    title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π config.yaml –∫–∞–∫ –ø—Ä–æ—Ñ–∏–ª—å">
              üíæ –ü—Ä–æ—Ñ–∏–ª—å
            </button>
          </div>

          <div class="mihomo-column">
            <h4>–ë—ç–∫–∞–ø—ã</h4>
            <div class="actions">
              <button id="mihomo-refresh-backups-btn" class="icon-btn">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
              </button>
            </div>
            <div class="small" style="margin-top:6px;">
              <label>
                <input type="checkbox" id="mihomo-backups-active-only" checked>
                –¢–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
              </label>
              <span id="mihomo-backups-active-profile-label" style="margin-left:8px;"></span>
            </div>
            <div class="small" style="margin-top: 6px;">
              <label>
                –û—Å—Ç–∞–≤–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ
                <input
                  id="mihomo-backups-clean-limit"
                  class="xkeen-input"
                  type="number"
                  min="0"
                  value="5"
                  style="width: 64px; margin: 0 4px;"
                >
                –±—ç–∫–∞–ø–æ–≤
              </label>
              <button id="mihomo-backups-clean-btn" class="icon-btn" title="–û—á–∏—Å—Ç–∏—Ç—å –±—ç–∫–∞–ø—ã">üßπ</button>
              <span class="hint">
                0 ‚Äî —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –±—ç–∫–∞–ø—ã (—Å —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è).
              </span>
            </div>
            <table class="xkeen-table">
              <thead>
                <tr>
                  <th>–§–∞–π–ª</th>
                  <th>–ü—Ä–æ—Ñ–∏–ª—å</th>
                  <th>–°–æ–∑–¥–∞–Ω</th>
                  <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="mihomo-backups-list"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
<div id="view-xkeen" class="view-section" style="display:none;">
  <!-- XKeen: –ø–æ—Ä—Ç—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è -->
      <section class="card commands-card">
        <div class="commands-header" onclick="toggleXkeenSettings()">
          <h2>–ü–æ—Ä—Ç—ã –∏ –ò—Å–∫–ª—é—á–µ–Ω–∏—è</h2>
          <span id="xkeen-arrow">‚ñº</span>
        </div>
        <div id="xkeen-body">
          <p>–§–∞–π–ª—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ <code>/opt/etc/xkeen</code>:</p>

          <h3>port_proxying.lst</h3>
          <p class="small">
            –ü–æ—Ä—Ç—ã –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏.
          </p>
          <textarea id="port-proxying-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:\n80\n443\n596:599\n–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø–æ—Ä—Ç –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤."></textarea>
          <div class="actions">
            <button id="port-proxying-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å port_proxying.lst</button>
          </div>
          <div id="port-proxying-status" class="status"></div>

          <hr>

          <h3>port_exclude.lst</h3>
          <p class="small">
            –ü–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.<br>
            <strong>–í–∞–∂–Ω–æ:</strong> –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º—ã—Ö –ø–æ—Ä—Ç–æ–≤ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–ª—å–∑—è,
            –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ—Ä—Ç–æ–≤ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.
          </p>
          <textarea id="port-exclude-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ü–æ—Ä—Ç—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è.\n–ù–∞–ø—Ä–∏–º–µ—Ä:\n22\n25\n80:89"></textarea>
          <div class="actions">
            <button id="port-exclude-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å port_exclude.lst</button>
          </div>
          <div id="port-exclude-status" class="status"></div>

          <hr>

          <h3>ip_exclude.lst</h3>
          <p class="small">
            IP –∏ –ø–æ–¥—Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ).
          </p>
          <textarea id="ip-exclude-editor"
                    class="xkeen-textarea"
                    spellcheck="false"
                    rows="8"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:\n192.168.0.0/16\n2001:db8::/32"></textarea>
          <div class="actions">
            <button id="ip-exclude-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ip_exclude.lst</button>
          </div>
          <div id="ip-exclude-status" class="status"></div>
        </div>
      </section>
</div>

<div id="view-commands" class="view-section" style="display:none;">
  <!-- XKeen commands -->
<section class="card commands-card">
  <div class="commands-header">
    <h2>–ö–æ–º–∞–Ω–¥—ã</h2>
    <button type="button" class="btn-secondary" id="terminal-open-shell-btn">–û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª</button>
    <button type="button" class="btn-secondary btn-interactive-shell" id="terminal-open-pty-btn" title="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ (PTY)">Interactive Shell</button>
  </div>

  <div id="commands-body">
  {% for group in command_groups %}
    <div class="command-group">
      <div class="command-group-title">{{ group.title }}</div>
      <ul class="command-list">
        {% for cmd in group['items'] %}
          <li class="command-item"
              data-flag="{{ cmd.flag }}"
              data-label="xkeen {{ cmd.flag }}"
              data-tooltip="{{ cmd.desc }}">
            <span class="command-item-icon">‚ñ∂</span>
            <span class="command-item-code"><code>xkeen {{ cmd.flag }}</code></span>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
  </div>
</section>
  <!-- Restart log -->
    <section class="card log-card">
      <div class="log-header-row">
        <h2>–ñ—É—Ä–Ω–∞–ª</h2>
        <div class="log-header-actions">
          <button type="button" class="btn-secondary log-btn" id="restart-log-clear-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button type="button" class="btn-secondary log-btn" id="restart-log-copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
      <pre id="restart-log" class="log-block"></pre>
    </section>
</div>




    <div id="view-xray-logs" class="view-section" style="display:none;">
      <section class="card log-card">
        <div class="log-header-row">
          <h2>Live –ª–æ–≥–∏ Xray <span id="xray-log-lamp" class="xray-log-lamp" data-state="unknown" title="–°—Ç–∞—Ç—É—Å –ª–æ–≥–æ–≤ Xray –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"></span></h2>
          <div class="log-header-actions">
            <select id="xray-log-file" class="xray-log-select" onchange="xrayLogChangeFile()">
              <option value="error">error.log</option>
              <option value="access">access.log</option>
            </select>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsView()" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏" aria-label="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏">üîç</button>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsEnable()" title="–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏" aria-label="–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏">‚ñ∂</button>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsDisable()" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏" aria-label="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏">‚èπ</button>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsClearScreen()" title="–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª">üßπ</button>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsClear()" title="–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥—Ñ–∞–π–ª—ã" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥—Ñ–∞–π–ª—ã">üóë</button>
            <button type="button" class="btn-secondary log-btn icon-only" onclick="xrayLogsCopy()" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
          </div>
        </div>
        <div class="log-filter-row">
          <input
            id="xray-log-filter"
            type="text"
            class="xray-log-filter"
            placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –ª–æ–≥–∞–º (–ø—Ä–∏–º–µ—Ä: error xray)"
          />
          <button
            id="xray-log-filter-clear"
            type="button"
            class="btn-secondary log-btn"
            title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"
            aria-label="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä"
          >
            ‚úñ
          </button>
        </div>


        <pre id="xray-log-output" class="log-block xray-log-block"></pre>
        <div id="xray-log-status" class="status"></div>
      </section>
    </div>

    <!-- –ú–∏–Ω–∏-—Ç–µ—Ä–º–∏–Ω–∞–ª XKeen -->
    <div id="terminal-overlay" class="terminal-overlay" style="display:none;">
      <div class="terminal-window">
        <div class="terminal-header">
	          <div class="terminal-header-left">
	            <span>–¢–µ—Ä–º–∏–Ω–∞–ª XKeen</span>
	            <span id="terminal-conn-lamp" class="service-status-lamp terminal-conn-lamp" data-state="stopped" title="–¢–µ—Ä–º–∏–Ω–∞–ª: –æ—Ç–∫–ª—é—á–µ–Ω–æ" aria-label="–°—Ç–∞—Ç—É—Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞"></span>
	            <span id="terminal-uptime" class="terminal-uptime" title="–ê–ø—Ç–∞–π–º">00:00</span>
	          </div>
	          <div class="terminal-toolbar" aria-label="Terminal toolbar">
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-fullscreen" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω / –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º" aria-label="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω / –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º">‚õ∂</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-reconnect" title="–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" aria-label="–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è">üîå</button>
	            <button type="button" class="terminal-tool-btn terminal-tool-btn-danger" id="terminal-btn-stop-retry" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" aria-label="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-new-session" title="–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è" aria-label="–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è">‚ûï</button>
	            <button type="button" class="terminal-tool-btn terminal-tool-btn-kbd" id="terminal-btn-ctrlc" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å Ctrl+C" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å Ctrl+C">^C</button>
	            <button type="button" class="terminal-tool-btn terminal-tool-btn-kbd" id="terminal-btn-ctrld" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å Ctrl+D" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å Ctrl+D">^D</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-minimize" title="–°–≤–µ—Ä–Ω—É—Ç—å (—Å–∫—Ä—ã—Ç—å –æ–∫–Ω–æ, –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞—è WS)" aria-label="–°–≤–µ—Ä–Ω—É—Ç—å">üóï</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-detach" title="–û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è (–æ—Å—Ç–∞–≤–∏—Ç—å PTY –∂–∏–≤—ã–º)" aria-label="–û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è">‚è∏</button>
	            <button type="button" class="terminal-tool-btn terminal-tool-btn-danger" id="terminal-btn-kill" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å PTY-—Å–µ—Å—Å–∏—é" aria-label="–ó–∞–≤–µ—Ä—à–∏—Ç—å PTY">‚èª</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-signals" title="–°–∏–≥–Ω–∞–ª—ã (SIG*)" aria-label="–°–∏–≥–Ω–∞–ª—ã">‚ò†</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-retry-now" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" aria-label="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å">‚Üª</button>
	            <button type="button" class="terminal-tool-btn" id="terminal-btn-ssh" title="–ü—Ä–æ—Ñ–∏–ª–∏ SSH" aria-label="–ü—Ä–æ—Ñ–∏–ª–∏ SSH">SSH</button>
		            <button type="button" class="terminal-tool-btn" id="terminal-history-btn" title="–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥" aria-label="–ò—Å—Ç–æ—Ä–∏—è">‚åö</button>

	            <div id="terminal-signals-menu" class="terminal-signals-menu hidden" role="menu" aria-label="–ú–µ–Ω—é —Å–∏–≥–Ω–∞–ª–æ–≤">
	              <button type="button" class="terminal-signals-item" data-terminal-signal="INT" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å SIGINT">SIGINT</button>
	              <button type="button" class="terminal-signals-item" data-terminal-signal="TERM" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å SIGTERM">SIGTERM</button>
	              <button type="button" class="terminal-signals-item" data-terminal-signal="HUP" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å SIGHUP">SIGHUP</button>
	              <button type="button" class="terminal-signals-item terminal-tool-btn-danger" data-terminal-signal="KILL" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å SIGKILL">SIGKILL</button>
	              <button type="button" class="terminal-signals-item" data-terminal-signal="QUIT" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å SIGQUIT">SIGQUIT</button>
	            </div>
            <button type="button" class="terminal-close" id="terminal-btn-close" title="–ó–∞–∫—Ä—ã—Ç—å" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
	          </div>
        </div>
        <input id="terminal-command"
               class="terminal-command"
               type="text"
               placeholder="–ö–æ–º–∞–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ls -la /)">
	        <div class="terminal-search-row" id="terminal-search-row" aria-label="Terminal search">
	          <input id="terminal-search-input"
	                 class="terminal-search-input"
	                 type="text"
	                 placeholder="–ü–æ–∏—Å–∫ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (Ctrl+F / F3)"
	                 autocomplete="off"
	                 spellcheck="false">
	          <button type="button" class="terminal-search-btn" id="terminal-search-prev" title="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ (Shift+F3)" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ">‚Üë</button>
	          <button type="button" class="terminal-search-btn" id="terminal-search-next" title="–°–ª–µ–¥—É—é—â–µ–µ (F3 / Enter)" aria-label="–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ">‚Üì</button>
	          <span id="terminal-search-counter" class="terminal-search-counter" title="–°–æ–≤–ø–∞–¥–µ–Ω–∏—è" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π">0/0</span>
	          <button type="button" class="terminal-search-btn" id="terminal-search-clear" title="–û—á–∏—Å—Ç–∏—Ç—å" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">√ó</button>
	        </div>
        <pre id="terminal-output" class="terminal-output"></pre>
        <div class="terminal-footer" aria-label="Terminal footer toolbar">
          <div class="terminal-footer-group" aria-label="–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
            <span class="terminal-footer-label">–í–∏–¥</span>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-font-dec" title="–®—Ä–∏—Ñ—Ç ‚àí" aria-label="–®—Ä–∏—Ñ—Ç –º–µ–Ω—å—à–µ">A‚àí</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-font-inc" title="–®—Ä–∏—Ñ—Ç +" aria-label="–®—Ä–∏—Ñ—Ç –±–æ–ª—å—à–µ">A+</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-cursorblink" title="–ú–∏–≥–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞" aria-label="–ú–∏–≥–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞">‚ñÆ</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-ansi" title="ANSI-—Ñ–∏–ª—å—Ç—Ä (—Å–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å ANSI-–∫–æ–¥—ã)" aria-label="ANSI-—Ñ–∏–ª—å—Ç—Ä">ANSI</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-loghl" title="–ü–æ–¥—Å–≤–µ—Ç–∫–∞ WARN/ERR" aria-label="–ü–æ–¥—Å–≤–µ—Ç–∫–∞ WARN/ERR">W/E</button>
<button type="button" class="terminal-tool-btn" id="terminal-btn-follow" title="–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞: –í–ö–õ" aria-label="–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞">‚á£ Follow</button>
<button type="button" class="terminal-tool-btn" id="terminal-btn-bottom" title="–í –∫–æ–Ω–µ—Ü" aria-label="–í –∫–æ–Ω–µ—Ü">‚Üì bottom</button>
          </div>
	        <div class="terminal-footer-group" id="terminal-buffer-group" aria-label="–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞">
            <span class="terminal-footer-label">–ë—É—Ñ–µ—Ä</span>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-copy" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-copyall" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±—É—Ñ–µ—Ä" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±—É—Ñ–µ—Ä">üìã All</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-download" title="–°–∫–∞—á–∞—Ç—å –≤—ã–≤–æ–¥ (.txt)" aria-label="–°–∫–∞—á–∞—Ç—å –≤—ã–≤–æ–¥">‚¨áÔ∏è .txt</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-paste" title="–í—Å—Ç–∞–≤–∏—Ç—å" aria-label="–í—Å—Ç–∞–≤–∏—Ç—å">üì•</button>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-clear" title="–û—á–∏—Å—Ç–∏—Ç—å" aria-label="–û—á–∏—Å—Ç–∏—Ç—å">üßπ</button>
          </div>

          <div class="terminal-footer-group terminal-footer-group-commands" id="terminal-commands-group" aria-label="–ö–æ–º–∞–Ω–¥—ã">
            <span class="terminal-footer-label">–ö–æ–º–∞–Ω–¥—ã</span>
            <button type="button" class="terminal-tool-btn" id="terminal-btn-commands" title="–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã" aria-label="–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã">‚ãØ –ö–æ–º–∞–Ω–¥—ã</button>
            <div id="terminal-commands-menu" class="terminal-commands-menu hidden" role="menu" aria-label="–ú–µ–Ω—é –∫–æ–º–∞–Ω–¥">
              <div class="terminal-commands-head">
                <div class="terminal-commands-title">–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã</div>
                <div class="terminal-commands-mode" role="group" aria-label="Mode">
                  <button type="button" class="terminal-commands-mode-btn" id="terminal-qc-mode-insert" title="–í—Å—Ç–∞–≤–∏—Ç—å (lite) –∏–ª–∏ –Ω–∞–±—Ä–∞—Ç—å –≤ PTY">Insert</button>
                  <button type="button" class="terminal-commands-mode-btn" id="terminal-qc-mode-run" title="–í—ã–ø–æ–ª–Ω–∏—Ç—å (PTY –∏–ª–∏ lite)">Run</button>
                </div>
              </div>
              <div class="terminal-commands-list" id="terminal-commands-list"></div>
              <div class="terminal-commands-hint">–ö–ª–∏–∫ ‚Äî –ø–æ —Ä–µ–∂–∏–º—É. Ctrl/‚åò+–∫–ª–∏–∫ ‚Äî Run, Shift+–∫–ª–∏–∫ ‚Äî Insert.</div>
            </div>
          </div>
        </div>
        <div class="terminal-input-row">
          <input id="terminal-input"
                 class="terminal-input"
                 type="text"
                 placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: yes). –ü—É—Å—Ç–æ ‚Äî –ø—Ä–æ—Å—Ç–æ Enter.">
          <button type="button" class="terminal-send" id="terminal-send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- History drawer for terminal commands -->
    <div id="terminal-history-modal" class="modal modal-drawer hidden" aria-label="–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞">
      <div class="modal-content terminal-history-content">
        <div class="modal-header">
          <span class="modal-title">–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥</span>
          <button type="button" class="modal-close" id="terminal-history-close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div class="modal-body">
          <input id="terminal-history-filter" class="terminal-history-filter" type="text" placeholder="–§–∏–ª—å—Ç—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: iptables, log, ping)" autocomplete="off" spellcheck="false">
          <div id="terminal-history-list" class="terminal-history-list" role="list"></div>
          <div class="terminal-history-hint">–ö–ª–∏–∫ ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–æ–ª–µ –∫–æ–º–∞–Ω–¥—ã. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å.</div>
        </div>
	        <div class="modal-actions">
	          <!-- In the history drawer, action buttons should share the same sizing/style.
	               `terminal-tool-btn` is a compact toolbar style, so we keep only the danger palette here. -->
	          <button type="button" id="terminal-history-clear-btn" class="terminal-tool-btn-danger" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
          <button type="button" id="terminal-history-insert-btn" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É –≤ –ø–æ–ª–µ –∫–æ–º–∞–Ω–¥—ã">–í—Å—Ç–∞–≤–∏—Ç—å</button>
          <button type="button" id="terminal-history-run-btn" title="–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>





    
    <div id="core-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">–í—ã–±–æ—Ä —è–¥—Ä–∞ XKeen</span>
          <button type="button" class="modal-close" id="core-modal-close-btn">√ó</button>
        </div>
        <div class="modal-body">
          <p class="modal-description">
            –í—ã–±–µ—Ä–∏—Ç–µ —è–¥—Ä–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ä–≤–∏—Å–æ–º xkeen.
            –ü—Ä–∏ —Å–º–µ–Ω–µ —è–¥—Ä–∞ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.
          </p>
          <div class="core-select-row">
            <button type="button" class="core-option" data-core="xray">xray</button>
            <button type="button" class="core-option" data-core="mihomo">mihomo</button>
          </div>
          <p id="core-modal-status" class="modal-hint" style="margin-top: 8px; font-size: 0.85rem; color: #9ca3af;"></p>
        </div>
        <div class="modal-actions">
          <button id="core-modal-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
          <button id="core-modal-confirm-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Shared confirm modal (replaces browser confirm alerts) -->
    <div id="confirm-modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title" id="confirm-modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
          <button type="button" class="modal-close" id="confirm-modal-close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div class="modal-body">
          <p id="confirm-modal-message" class="modal-description"></p>
        </div>
        <div class="modal-actions">
          <button type="button" id="confirm-modal-cancel-btn">–û—Ç–º–µ–Ω–∏—Ç—å</button>
          <button type="button" id="confirm-modal-ok-btn" class="btn-danger">OK</button>
        </div>
      </div>
    </div>

<div id="github-export-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">–í—ã–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</span>
          <button type="button" class="modal-close" id="github-export-cancel-btn-header">√ó</button>
        </div>
        <div class="modal-body">
          <div class="github-export-form">
            <input id="github-export-tag-input" type="text" placeholder="–¢—ç–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
            <textarea id="github-export-desc-input" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button id="github-export-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
          <button id="github-export-confirm-btn">–í—ã–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
      </div>
    </div>


    <div id="github-catalog-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">–ö–∞—Ç–∞–ª–æ–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</span>
          <button type="button" class="modal-close" id="github-catalog-close-btn-header">√ó</button>
        </div>
        <div class="modal-body">
          <div id="github-catalog-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <div class="modal-actions">
          <button id="github-catalog-close-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
          <a id="github-repo-link" href="{{ github_repo_url }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub</a>
        </div>
      </div>
    </div>


    <div id="toast-container"></div>

    <footer>
      <small>Xkeen UI ‚Äî /opt/etc/xray/configs/03_inbounds.json, 04_outbounds.json, 05_routing.json</small>
    </footer>
  </div>

  <script>
	    window.XKEEN_GITHUB_REPO_URL = "{{ github_repo_url|e }}";
	    // Files shown in UI (used by last-load badge and other helpers)
	    window.XKEEN_FILES = {
	      routing: "{{ routing_file|e }}",
	      inbounds: "{{ inbounds_file|e }}",
	      outbounds: "{{ outbounds_file|e }}",
	      mihomo: "/opt/etc/mihomo/config.yaml",
	    };
  </script>
  <!-- Modularization scaffold (no behavior changes yet) -->
  <script src="{{ url_for('static', filename='js/00_state.js') }}"></script>
  <script src="{{ url_for('static', filename='js/01_bootstrap.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/toast.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/confirm_modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/theme.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/ui/last_activity.js') }}"></script>
  <script src="{{ url_for('static', filename='js/util/helpers.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/codemirror_toolbar.js') }}"></script>
  <script src="{{ url_for('static', filename='js/util/tab_id.js') }}"></script>
  <script src="{{ url_for('static', filename='js/util/ansi.js') }}"></script>
    <script src="{{ url_for('static', filename='js/util/command_job.js') }}"></script>
<script src="{{ url_for('static', filename='js/ui/spinner_fetch.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ui/json_editor_modal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/backups.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/routing.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/local_io.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/github.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/service_status.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/xray_logs.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/restart_log.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/mihomo_panel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/commands_list.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/inbounds.js') }}"></script>
  <script src="{{ url_for('static', filename='js/features/outbounds.js') }}"></script>
    <script src="{{ url_for('static', filename='js/features/xkeen_texts.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/_core.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/capabilities.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/pty.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/lite_runner.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/search.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/history.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/quick_commands.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/chrome.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/terminal.js') }}"></script>
  <script src="{{ url_for('static', filename='js/terminal/xray_tail.js') }}"></script>
  <script src="{{ url_for('static', filename='js/pages/panel.init.js') }}"></script>
  <script src="{{ url_for('static', filename='main.js') }}"></script>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–π JSON-—Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è 03_inbounds.json / 04_outbounds.json -->
    <div id="json-editor-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title" id="json-editor-title">–†–µ–¥–∞–∫—Ç–æ—Ä JSON</span>
          <button type="button" class="modal-close" id="json-editor-close-btn">√ó</button>
        </div>
        <div class="modal-body">
          <p id="json-editor-file-label"></p>
          <textarea id="json-editor-textarea" spellcheck="false"></textarea>
          <div id="json-editor-error" class="error"></div>
        </div>
        <div class="modal-actions">
          <button id="json-editor-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="json-editor-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>


<div id="mihomo-validation-modal" class="modal hidden" onclick="if (event.target === this) hideMihomoValidationModal();">
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-title">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Mihomo</span>
      <button type="button" class="modal-close" onclick="hideMihomoValidationModal()">√ó</button>
    </div>
    <div id="mihomo-validation-modal-body" class="modal-body modal-body-logs"></div>
  </div>
</div>

<div id="ssh-modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="SSH profiles">
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-title">SSH –ø—Ä–æ—Ñ–∏–ª–∏</span>
      <button type="button" class="modal-close" id="ssh-modal-close-btn" aria-label="Close">√ó</button>
    </div>

    <div class="modal-body">
      <div style="display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap;">
        <button type="button" id="ssh-add-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        <button type="button" id="ssh-delete-selected-btn" disabled>üóë –£–¥–∞–ª–∏—Ç—å</button>
        <button type="button" id="ssh-export-btn">üì§ Export</button>
        <button type="button" id="ssh-import-btn">üì• Import</button>
      </div>

      <div id="ssh-profiles-list" style="display:flex; flex-direction:column; gap:8px;"></div>

      <hr style="border:0; border-top:1px solid #334155; margin:12px 0;">

      <div style="display:flex; flex-direction:column; gap:8px;">
        <label style="opacity:.85;">–ö–æ–º–∞–Ω–¥–∞ (–±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ PTY)</label>
        <input id="ssh-command-preview" class="terminal-input" style="width:100%;" placeholder="ssh user@host -p 22" />
        <div style="display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;">
          <button type="button" id="ssh-copy-preview-btn">üìã Copy</button>
          <button type="button" id="ssh-run-preview-btn">‚ñ∂ Run</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SSH profile editor (no browser prompts/alerts) -->
<div id="ssh-edit-modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="SSH profile editor">
  <div class="modal-content" style="max-width:640px;">
    <div class="modal-header">
      <span class="modal-title" id="ssh-edit-title">SSH –ø—Ä–æ—Ñ–∏–ª—å</span>
      <button type="button" class="modal-close" id="ssh-edit-close-btn" aria-label="Close">√ó</button>
    </div>

    <div class="modal-body">
      <div class="ssh-form-grid">
        <label for="ssh-edit-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input id="ssh-edit-name" class="terminal-input" placeholder="–ù–∞–ø—Ä. –î–æ–º–∞—à–Ω–∏–π —Ä–æ—É—Ç–µ—Ä" />

        <label for="ssh-edit-host">Host *</label>
        <input id="ssh-edit-host" class="terminal-input" placeholder="IP –∏–ª–∏ DNS" />

        <label for="ssh-edit-user">User</label>
        <input id="ssh-edit-user" class="terminal-input" placeholder="root" />

        <label for="ssh-edit-port">Port</label>
        <input id="ssh-edit-port" class="terminal-input" placeholder="22" inputmode="numeric" />

        <label for="ssh-edit-key">Key path</label>
        <input id="ssh-edit-key" class="terminal-input" placeholder="/opt/home/user/.ssh/id_ed25519" />

        <label for="ssh-edit-jump">ProxyJump</label>
        <input id="ssh-edit-jump" class="terminal-input" placeholder="user@jump-host" />
      </div>
      <div id="ssh-edit-error" class="error"></div>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" id="ssh-edit-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button type="button" id="ssh-edit-delete-btn">üóë –£–¥–∞–ª–∏—Ç—å</button>
        <button type="button" class="btn-primary" id="ssh-edit-save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<!-- Small confirm modal for delete -->
<div id="ssh-confirm-modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Confirm">
  <div class="modal-content" style="max-width:420px;">
    <div class="modal-header">
      <span class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
      <button type="button" class="modal-close" id="ssh-confirm-close-btn" aria-label="Close">√ó</button>
    </div>
    <div class="modal-body">
      <div id="ssh-confirm-text" style="white-space:pre-wrap;"></div>
    </div>
    <div class="modal-actions" style="justify-content:flex-end;">
      <button type="button" class="btn-secondary" id="ssh-confirm-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
      <button type="button" id="ssh-confirm-ok" class="btn-primary">OK</button>
    </div>
  </div>
</div>

</body>
</html>
